<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.15.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ACP - Autonomous Command Protocol: Autonomous Command Protocol (ACP) v0.3 — Complete Specification</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">ACP - Autonomous Command Protocol<span id="projectnumber">&#160;v0.3.0</span>
   </div>
   <div id="projectbrief">Portable C99 framing library with COBS, CRC16, and HMAC-SHA256 authentication</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.15.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('md_acp__comm__spec__v0-3.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Autonomous Command Protocol (ACP) v0.3 — Complete Specification </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md28"></a></p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md29"></a>
Executive Summary</h1>
<p>The Autonomous Command Protocol (ACP) v0.3 is a secure, lightweight binary communication protocol designed for embedded systems, IoT devices, and distributed applications. ACP provides authenticated message exchange with integrity validation, replay protection, and efficient framing suitable for resource-constrained environments.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md30"></a>
Design Principles</h1>
<ul>
<li><b>Security First</b>: HMAC-SHA256 authentication with constant-time verification</li>
<li><b>Embedded Ready</b>: Zero-heap operation by default, minimal resource requirements <br  />
</li>
<li><b>Platform Agnostic</b>: C99 standard compliance, cross-platform portability</li>
<li><b>Deterministic</b>: Predictable performance, bounded memory usage</li>
<li><b>Extensible</b>: Version negotiation and feature detection support</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md31"></a>
Key Features</h1>
<ul>
<li><b>COBS Framing</b>: Consistent Overhead Byte Stuffing for reliable delimiter-based framing</li>
<li><b>CRC16 Integrity</b>: CRC16-CCITT validation for corruption detection</li>
<li><b>HMAC Authentication</b>: Optional HMAC-SHA256 with 16-byte truncation</li>
<li><b>Replay Protection</b>: Session-based sequence number enforcement <br  />
</li>
<li><b>Command Enforcement</b>: Mandatory authentication for command frames</li>
<li><b>Cross-Platform</b>: Linux, macOS, Windows, and embedded system support</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md32"></a>
Protocol Architecture</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md33"></a>
Wire Format</h2>
<p>ACP v0.3 uses Consistent Overhead Byte Stuffing (COBS) for reliable framing:</p>
<div class="fragment"><div class="line">COBS_FRAME[CRC16 | PAYLOAD] | DELIMITER</div>
</div><!-- fragment --><p>Where:</p>
<ul>
<li><b>COBS_FRAME</b>: COBS-encoded packet containing CRC16 + PAYLOAD</li>
<li><b>CRC16</b>: 2-byte CRC16-CCITT checksum (big-endian) of PAYLOAD</li>
<li><b>PAYLOAD</b>: Message content (telemetry data or authenticated command)</li>
<li><b>DELIMITER</b>: Single 0x00 byte marking frame boundary</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md34"></a>
COBS Encoding Properties</h2>
<ul>
<li><b>Zero Elimination</b>: No 0x00 bytes within encoded frame</li>
<li><b>Overhead</b>: Maximum 1 byte per 254 bytes + 1 byte total</li>
<li><b>Self-Synchronizing</b>: Frame boundaries are unambiguous</li>
<li><b>Corruption Detection</b>: Encoding errors are detectable</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md35"></a>
CRC16 Implementation</h2>
<p>ACP uses CRC16-CCITT (polynomial 0x1021) with:</p>
<ul>
<li><b>Initial Value</b>: 0xFFFF</li>
<li><b>Final XOR</b>: 0x0000</li>
<li><b>Bit Order</b>: MSB first</li>
<li><b>Byte Order</b>: Big-endian on wire</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md36"></a>
Frame Types</h2>
<p>ACP defines two primary frame types:</p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md37"></a>
Telemetry Frames</h3>
<div class="fragment"><div class="line">| CRC16 | PAYLOAD_DATA |</div>
</div><!-- fragment --><ul>
<li><b>CRC16</b>: Integrity checksum of PAYLOAD_DATA</li>
<li><b>PAYLOAD_DATA</b>: Raw telemetry data (application-defined format)</li>
<li><b>Authentication</b>: Not required (telemetry is read-only)</li>
</ul>
<h3 class="doxsection"><a class="anchor" id="autotoc_md38"></a>
Command Frames</h3>
<div class="fragment"><div class="line">| CRC16 | HMAC_TAG | SEQUENCE | PAYLOAD_DATA |</div>
</div><!-- fragment --><ul>
<li><b>CRC16</b>: Integrity checksum of (HMAC_TAG + SEQUENCE + PAYLOAD_DATA)</li>
<li><b>HMAC_TAG</b>: 16-byte HMAC-SHA256 authentication tag</li>
<li><b>SEQUENCE</b>: 4-byte sequence number (big-endian, replay protection)</li>
<li><b>PAYLOAD_DATA</b>: Command data (application-defined format)</li>
<li><b>Authentication</b>: Mandatory for all command frames</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md39"></a>
Session Management</h2>
<ul>
<li><b>Keystore Integration</b>: Shared keys managed through platform keystore</li>
<li><b>Sequence Numbers</b>: Monotonic counters prevent replay attacks</li>
<li><b>Constant-Time Verification</b>: HMAC validation uses timing-safe comparison</li>
<li><b>Command Enforcement</b>: All command frames must include valid authentication</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md40"></a>
Implementation Guidelines</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md41"></a>
Payload Format</h2>
<p>ACP is payload-agnostic. Applications define their own data formats within the PAYLOAD_DATA field. Common approaches include:</p>
<ul>
<li><b>Binary Structs</b>: Fixed-size C structures (ensure portable packing)</li>
<li><b>TLV Encoding</b>: Type-Length-Value for extensible messages</li>
<li><b>Protocol Buffers</b>: For complex, versioned message schemas</li>
<li><b>JSON</b>: For human-readable debugging (though bandwidth-intensive)</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md42"></a>
Error Handling</h2>
<p>Implementations should handle:</p>
<ul>
<li><b>CRC Mismatches</b>: Discard corrupted frames silently</li>
<li><b>COBS Decoding Errors</b>: Reset framing state and resynchronize <br  />
</li>
<li><b>HMAC Failures</b>: Log authentication errors, reject commands</li>
<li><b>Sequence Violations</b>: Detect replay attempts, maintain session state</li>
<li><b>Buffer Overflows</b>: Validate frame sizes against available memory</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md43"></a>
Performance Considerations</h2>
<ul>
<li><b>Zero-Copy Operation</b>: Process frames in-place when possible</li>
<li><b>Bounded Memory</b>: All operations use stack allocation by default</li>
<li><b>Constant-Time Crypto</b>: HMAC verification prevents timing attacks</li>
<li><b>Incremental Processing</b>: Handle partial frames for streaming interfaces</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md44"></a>
Security Model</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md45"></a>
Authentication Architecture</h2>
<p>ACP implements defense-in-depth security:</p>
<ol type="1">
<li><b>Transport Security</b>: CRC16 ensures data integrity</li>
<li><b>Application Security</b>: HMAC-SHA256 provides authentication <br  />
</li>
<li><b>Replay Protection</b>: Sequence numbers prevent message replay</li>
<li><b>Access Control</b>: Commands require authentication, telemetry does not</li>
</ol>
<h2 class="doxsection"><a class="anchor" id="autotoc_md46"></a>
Cryptographic Specifications</h2>
<ul>
<li><b>Algorithm</b>: HMAC-SHA256 per RFC 2104</li>
<li><b>Key Size</b>: 256-bit (32 bytes) shared secret</li>
<li><b>Tag Size</b>: 128-bit (16 bytes) truncated output</li>
<li><b>Verification</b>: Constant-time comparison prevents timing attacks</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md47"></a>
Threat Model</h2>
<p>ACP protects against:</p>
<ul>
<li><b>Data Corruption</b>: CRC16 detects transmission errors</li>
<li><b>Command Injection</b>: HMAC authentication validates command source</li>
<li><b>Replay Attacks</b>: Sequence numbers ensure message freshness</li>
<li><b>Eavesdropping</b>: Telemetry remains readable (by design)</li>
</ul>
<p>ACP does not protect against:</p>
<ul>
<li><b>Key Compromise</b>: Shared keys must be managed securely</li>
<li><b>Traffic Analysis</b>: Frame timing and sizes are observable</li>
<li><b>Side-Channel Attacks</b>: Implementation must use constant-time operations</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md48"></a>
API Reference</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md49"></a>
Core Functions</h2>
<div class="fragment"><div class="line"><span class="comment">// Frame processing</span></div>
<div class="line"><span class="keywordtype">int</span> <a class="code hl_function" href="acp__framer_8c.html#a6df8c96cca60a0d795b251e27cb97fda">acp_frame_encode</a>(<span class="keyword">const</span> uint8_t *payload, <span class="keywordtype">size_t</span> payload_len, </div>
<div class="line">                     uint8_t *output, <span class="keywordtype">size_t</span> output_size, <span class="keywordtype">size_t</span> *output_len);</div>
<div class="line"><span class="keywordtype">int</span> <a class="code hl_function" href="acp__framer_8c.html#a7ff2fcea530d2699452c229b2d265fd0">acp_frame_decode</a>(<span class="keyword">const</span> uint8_t *input, <span class="keywordtype">size_t</span> input_len,</div>
<div class="line">                     uint8_t *payload, <span class="keywordtype">size_t</span> payload_size, <span class="keywordtype">size_t</span> *payload_len);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Authentication  </span></div>
<div class="line"><span class="keywordtype">int</span> acp_auth_set_key(<span class="keyword">const</span> uint8_t *key, <span class="keywordtype">size_t</span> key_len);</div>
<div class="line"><span class="keywordtype">int</span> acp_auth_sign_command(<span class="keyword">const</span> uint8_t *payload, <span class="keywordtype">size_t</span> payload_len,</div>
<div class="line">                          uint32_t sequence, uint8_t *output, <span class="keywordtype">size_t</span> output_size);</div>
<div class="line"><span class="keywordtype">int</span> acp_auth_verify_command(<span class="keyword">const</span> uint8_t *frame, <span class="keywordtype">size_t</span> frame_len,</div>
<div class="line">                            uint32_t expected_sequence);</div>
<div class="ttc" id="aacp__framer_8c_html_a6df8c96cca60a0d795b251e27cb97fda"><div class="ttname"><a href="acp__framer_8c.html#a6df8c96cca60a0d795b251e27cb97fda">acp_frame_encode</a></div><div class="ttdeci">int acp_frame_encode(const acp_frame_t *frame, uint8_t *output, size_t output_size, size_t *bytes_written)</div><div class="ttdoc">Encode ACP frame to wire format.</div><div class="ttdef"><b>Definition</b> <a href="acp__framer_8c_source.html#l00046">acp_framer.c:46</a></div></div>
<div class="ttc" id="aacp__framer_8c_html_a7ff2fcea530d2699452c229b2d265fd0"><div class="ttname"><a href="acp__framer_8c.html#a7ff2fcea530d2699452c229b2d265fd0">acp_frame_decode</a></div><div class="ttdeci">int acp_frame_decode(const uint8_t *input, size_t input_size, acp_frame_t *frame, size_t *bytes_consumed)</div><div class="ttdoc">Decode wire format to ACP frame.</div><div class="ttdef"><b>Definition</b> <a href="acp__framer_8c_source.html#l00131">acp_framer.c:131</a></div></div>
</div><!-- fragment --><div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code hl_function" href="acp__protocol_8h.html#ab898071398b359603a35c202e9c65f3b">__attribute__</a>((packed)) {</div>
<div class="line"><span class="preprocessor">  ### Return Values</span></div>
<div class="line"> </div>
<div class="line">All ACP functions <span class="keywordflow">return</span> standard error codes:</div>
<div class="ttc" id="aacp__protocol_8h_html_ab898071398b359603a35c202e9c65f3b"><div class="ttname"><a href="acp__protocol_8h.html#ab898071398b359603a35c202e9c65f3b">__attribute__</a></div><div class="ttdeci">struct __attribute__((packed))</div><div class="ttdoc">Base wire frame header structure (always present).</div><div class="ttdef"><b>Definition</b> <a href="acp__protocol_8h_source.html#l00001">acp_protocol.h:119</a></div></div>
</div><!-- fragment --><p> c typedef enum { ACP_OK = 0, // Success ACP_ERR_INVALID_ARG, // Invalid function argument ACP_ERR_BUFFER_SIZE, // Insufficient buffer space ACP_ERR_CRC_MISMATCH, // CRC validation failed ACP_ERR_AUTH_FAILED, // HMAC authentication failed ACP_ERR_DECODE_ERROR, // COBS decoding error ACP_ERR_SEQUENCE, // Sequence number violation ACP_ERR_NOT_INITIALIZED // Authentication not configured } <a class="el" href="acp__protocol_8h.html#a4b24e1ecae6883bbd866c7d6967cbabf" title="ACP result/error code enumeration.">acp_result_t</a>; </p><div class="fragment"><div class="line">## Conformance Requirements</div>
<div class="line"> </div>
<div class="line">### Frame Processing</div>
<div class="line"> </div>
<div class="line">Conformant implementations must:</div>
<div class="line"> </div>
<div class="line">- **COBS Encoding**: Use RFC-compliant COBS for all frames</div>
<div class="line">- **CRC16 Validation**: Compute CRC16-CCITT over payload data</div>
<div class="line">- **Zero Delimiter**: Terminate all frames with single 0x00 byte</div>
<div class="line">- **Buffer Management**: Handle frames up to 254 bytes payload</div>
<div class="line">- **Error Recovery**: Resynchronize on invalid frames</div>
<div class="line"> </div>
<div class="line">### Authentication</div>
<div class="line"> </div>
<div class="line">For command processing:</div>
<div class="line"> </div>
<div class="line">- **HMAC-SHA256**: Implement per RFC 2104 specification</div>
<div class="line">- **16-Byte Tags**: Truncate HMAC output to 128 bits</div>
<div class="line">- **Sequence Enforcement**: Reject out-of-order messages</div>
<div class="line">- **Constant-Time Verification**: Prevent timing attack vectors</div>
<div class="line">- **Key Management**: Integrate with platform keystore</div>
<div class="line"> </div>
<div class="line">### Platform Integration</div>
<div class="line"> </div>
<div class="line">Implementations should provide:</div>
<div class="line"> </div>
<div class="line">- **Cross-Platform Builds**: Support major operating systems</div>
<div class="line">- **Embedded Compatibility**: Function in resource-constrained environments</div>
<div class="line">- **Zero-Heap Operation**: Use stack allocation by default</div>
<div class="line">- **Thread Safety**: Provide synchronization primitives</div>
<div class="line">- **Logging Integration**: Support platform-specific logging</div>
<div class="line"> </div>
<div class="line">## Reference Implementation</div>
<div class="line"> </div>
<div class="line">The reference implementation provides:</div>
<div class="line"> </div>
<div class="line">- **Complete C99 Library**: Full protocol implementation</div>
<div class="line">- **Cross-Platform Support**: Linux, macOS, Windows, embedded</div>
<div class="line">- **Comprehensive Tests**: Unit tests and integration validation</div>
<div class="line">- **Example Applications**: Telemetry sender/receiver demos</div>
<div class="line">- **Documentation**: API reference and integration guides</div>
<div class="line">- **Build Systems**: CMake and Make support with installation</div>
<div class="line"> </div>
<div class="line">## Version History</div>
<div class="line"> </div>
<div class="line">### v0.3 (Current)</div>
<div class="line"> </div>
<div class="line">- COBS framing with 0x00 delimiters</div>
<div class="line">- CRC16-CCITT integrity validation  </div>
<div class="line">- HMAC-SHA256 authentication with 16-byte tags</div>
<div class="line">- Sequence-based replay protection</div>
<div class="line">- Command frame enforcement</div>
<div class="line">- Cross-platform build system</div>
<div class="line"> </div>
<div class="line">### Previous Versions</div>
<div class="line"> </div>
<div class="line">- **v0.2**: SYNC-byte framing with length headers</div>
<div class="line">- **v0.1**: Basic binary protocol without authentication</div>
<div class="line"> </div>
<div class="line">## Implementation Resources</div>
<div class="line"> </div>
<div class="line">### Library Structure</div>
</div><!-- fragment --><p> text <a class="el" href="acp__framer_8c.html" title="ACP frame encoding and decoding implementation.">acp_framer.c</a> - COBS encoding/decoding and frame processing <a class="el" href="acp__crypto_8c.html" title="ACP cryptographic functions - SHA-256 and HMAC-SHA256.">acp_crypto.c</a> - HMAC-SHA256 authentication and verification <br  />
 <a class="el" href="acp__session_8c.html" title="ACP Session Management - Authentication and Replay Protection.">acp_session.c</a> - Session management and sequence tracking <a class="el" href="acp__constants_8c.html" title="ACP protocol constants and lookup tables.">acp_constants.c</a> - Protocol constants and configuration <a class="el" href="acp__nvs_8c.html" title="Non-volatile storage (keystore) implementation for ACP.">acp_nvs.c</a> - Non-volatile storage abstraction </p><div class="fragment"><div class="line">### Platform Headers</div>
</div><!-- fragment --><p> text <a class="el" href="acp__platform__keystore_8h.html" title="ACP Platform Keystore Interface.">acp_platform_keystore.h</a> - Keystore integration interface <a class="el" href="acp__platform__time_8h.html" title="ACP Platform Time Interface.">acp_platform_time.h</a> - Time/timestamp services <a class="el" href="acp__platform__mutex_8h.html" title="ACP Platform Mutex Interface.">acp_platform_mutex.h</a> - Thread synchronization primitives <br  />
 <a class="el" href="acp__platform__log_8h_source.html">acp_platform_log.h</a> - Logging and debug output ```</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md50"></a>
Testing</h2>
<p>The reference implementation includes comprehensive test coverage:</p>
<ul>
<li><b>Unit Tests</b>: Individual component validation</li>
<li><b>Integration Tests</b>: End-to-end protocol operation</li>
<li><b>Conformance Tests</b>: Standards compliance verification</li>
<li><b>Platform Tests</b>: Cross-platform compatibility</li>
<li><b>Security Tests</b>: Authentication and replay protection</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md51"></a>
Build Requirements</h2>
<ul>
<li><b>C99 Compiler</b>: GCC, Clang, or MSVC</li>
<li><b>CMake 3.10+</b>: Cross-platform build system</li>
<li><b>Standard Library</b>: No external dependencies</li>
<li><b>Platform Layer</b>: Implementation-specific keystore/logging</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md52"></a>
Conclusion</h1>
<p>ACP v0.3 provides a production-ready protocol for secure embedded communication. The combination of COBS framing, CRC16 integrity, and HMAC authentication delivers reliable message exchange suitable for safety-critical applications while maintaining compatibility with resource-constrained environments.</p>
<p>For implementation guidance, API documentation, and integration examples, refer to the reference implementation repository and accompanying documentation suite. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on <span class="timestamp"></span> for ACP - Autonomous Command Protocol by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.15.0 </li>
  </ul>
</div>
</body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.15.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ACP - Autonomous Command Protocol: Enhanced AI Model Chat Tool Support</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">ACP - Autonomous Command Protocol<span id="projectnumber">&#160;v0.3.0</span>
   </div>
   <div id="projectbrief">Portable C99 framing library with COBS, CRC16, and HMAC-SHA256 authentication</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.15.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('md__2_users_2paulzanna_2_github_2_eunice_2docs_2_m_c_p_2enhanced__tool__support.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Enhanced AI Model Chat Tool Support </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md2028"></a></p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md2029"></a>
Overview</h1>
<p>This document describes the enhanced tool support for the <span class="tt">ai_model_chat</span> tool provided by the network service, including the common format for prompt configurations and schema management.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md2030"></a>
What Was Implemented</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md2031"></a>
1. Enhanced Network Service Tool Support</h2>
<p><b>File: <span class="tt">network/src/network_tools.py</span></b></p>
<ul>
<li>Added comprehensive tool definitions for OpenAI, Anthropic, and XAI providers</li>
<li>Enhanced <span class="tt">ai_model_chat</span> function to support:<ul>
<li>Custom tool definitions</li>
<li>Tool choice settings (auto, none, specific tool)</li>
<li>Literature search tool in addition to Google search</li>
<li>Proper tool call execution and result handling</li>
</ul>
</li>
</ul>
<p><b>File: <span class="tt">network/src/mcp_server.py</span></b></p>
<ul>
<li>Updated MCP server to expose the enhanced <span class="tt">ai_model_chat</span> function with new parameters:<ul>
<li><span class="tt">enable_tools</span>: Boolean to enable/disable tool calling</li>
<li><span class="tt">tools</span>: Optional custom tool definitions</li>
<li><span class="tt">tool_choice</span>: Control tool selection behavior</li>
</ul>
</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md2032"></a>
2. Common Prompt Format</h2>
<p><b>File: <span class="tt">research-manager/prompts/common_format.json</span></b></p>
<ul>
<li>Defines a unified format specification for AI model chat requests</li>
<li>Includes standard tool definitions for Google search and literature search</li>
<li>Provides schema for consistent prompt configuration</li>
</ul>
<p><b>Common Format Structure:</b></p>
<div class="fragment"><div class="line">{</div>
<div class="line">  &quot;id&quot;: &quot;unique_identifier&quot;,</div>
<div class="line">  &quot;description&quot;: &quot;description of the prompt&quot;,</div>
<div class="line">  &quot;agent_type&quot;: &quot;ai_service&quot;,</div>
<div class="line">  &quot;model&quot;: &quot;model_name&quot;,</div>
<div class="line">  &quot;provider&quot;: &quot;openai|anthropic|xai&quot;,</div>
<div class="line">  &quot;temperature&quot;: 0.7,</div>
<div class="line">  &quot;max_tokens&quot;: 1000,</div>
<div class="line">  &quot;tool_choice&quot;: &quot;auto|none|specific_tool&quot;,</div>
<div class="line">  &quot;enable_tools&quot;: true,</div>
<div class="line">  &quot;system_prompt&quot;: &quot;system instructions&quot;,</div>
<div class="line">  &quot;user_prompt_template&quot;: &quot;template with {placeholders}&quot;,</div>
<div class="line">  &quot;tools&quot;: [...],</div>
<div class="line">  &quot;response_format&quot;: {...},</div>
<div class="line">  &quot;output_contract&quot;: {...}</div>
<div class="line">}</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="autotoc_md2033"></a>
3. Updated Prompt Files</h2>
<p><b>File: <span class="tt">research-manager/prompts/create_research_plan.json</span></b></p>
<ul>
<li>Converted to use the common format</li>
<li>Added Google search tool support</li>
<li>Enhanced with proper schema reference</li>
</ul>
<p><b>File: <span class="tt">research-manager/prompts/perform_literature_search.json</span></b></p>
<ul>
<li>Converted to use the common format</li>
<li>Includes both Google search and literature search tools</li>
<li>References external schema file for response validation</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md2034"></a>
4. Schema Management</h2>
<p><b>File: <span class="tt">research-manager/prompts/literature_search_results_v2.schema.json</span></b></p>
<ul>
<li>Extracted complex response schema into separate file</li>
<li>Enhanced with additional metadata fields</li>
<li>Includes comprehensive validation rules</li>
</ul>
<p><b>Schema Features:</b></p>
<ul>
<li>Structured query tracking</li>
<li>Paper metadata with multiple identifiers (DOI, PMID, OpenAlex ID)</li>
<li>Relevance scoring and citation tracking</li>
<li>Research gap identification</li>
<li>Search metadata and strategy documentation</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md2035"></a>
5. Utility Functions</h2>
<p><b>File: <span class="tt">research-manager/src/prompt_utils.py</span></b></p>
<ul>
<li>Common format loading and validation</li>
<li>Schema reference resolution</li>
<li>MCP request building utilities</li>
<li>Response parsing and validation</li>
<li>Convenience functions for specific prompt types</li>
</ul>
<p><b>Key Functions:</b></p>
<ul>
<li><span class="tt">load_prompt_config()</span>: Load and validate prompt configurations</li>
<li><span class="tt">resolve_schema_reference()</span>: Resolve external schema references</li>
<li><span class="tt">build_mcp_chat_request()</span>: Build MCP requests from common format</li>
<li><span class="tt">validate_response_against_schema()</span>: Validate responses against schemas</li>
<li><span class="tt">format_structured_response()</span>: Parse structured response content</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md2036"></a>
6. Testing Infrastructure</h2>
<p><b>File: <span class="tt">research-manager/src/test_tool_support.py</span></b></p>
<ul>
<li>Comprehensive test suite for enhanced tool support</li>
<li>Configuration loading and validation tests</li>
<li>Schema resolution and validation tests</li>
<li>MCP request building tests</li>
<li>Response processing simulation</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md2037"></a>
Tool Support Matrix</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Provider  </th><th class="markdownTableHeadNone">Google Search  </th><th class="markdownTableHeadNone">Literature Search  </th><th class="markdownTableHeadNone">Built-in Search  </th><th class="markdownTableHeadNone">Notes  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">OpenAI  </td><td class="markdownTableBodyNone">✅ Function  </td><td class="markdownTableBodyNone">✅ Function  </td><td class="markdownTableBodyNone">❌  </td><td class="markdownTableBodyNone">Full tool calling support  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Anthropic  </td><td class="markdownTableBodyNone">✅ Tool Use  </td><td class="markdownTableBodyNone">✅ Tool Use  </td><td class="markdownTableBodyNone">❌  </td><td class="markdownTableBodyNone">Anthropic tool format  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">XAI  </td><td class="markdownTableBodyNone">✅ External  </td><td class="markdownTableBodyNone">✅ External  </td><td class="markdownTableBodyNone">✅ Built-in  </td><td class="markdownTableBodyNone">Hybrid approach  </td></tr>
</table>
<h1 class="doxsection"><a class="anchor" id="autotoc_md2038"></a>
Usage Examples</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md2039"></a>
Creating a Research Plan Request</h2>
<div class="fragment"><div class="line"><span class="keyword">from</span> prompt_utils <span class="keyword">import</span> create_research_plan_request</div>
<div class="line"> </div>
<div class="line">request = create_research_plan_request(</div>
<div class="line">    topic_title=<span class="stringliteral">&quot;Machine Learning in Drug Discovery&quot;</span>,</div>
<div class="line">    topic_description=<span class="stringliteral">&quot;Investigating ML applications in pharmaceutical research&quot;</span></div>
<div class="line">)</div>
<div class="line"><span class="comment"># request is ready to send to ai_model_chat MCP function</span></div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="autotoc_md2040"></a>
Creating a Literature Search Request</h2>
<div class="fragment"><div class="line"><span class="keyword">from</span> prompt_utils <span class="keyword">import</span> create_literature_search_request</div>
<div class="line"> </div>
<div class="line">request = create_literature_search_request(research_plan_json)</div>
<div class="line"><span class="comment"># Includes tools for both Google and academic database search</span></div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="autotoc_md2041"></a>
Direct MCP Usage</h2>
<div class="fragment"><div class="line"><span class="comment"># Enhanced ai_model_chat with tools</span></div>
<div class="line">result = await mcp_client.call_tool(<span class="stringliteral">&quot;ai_model_chat&quot;</span>, {</div>
<div class="line">    <span class="stringliteral">&quot;messages&quot;</span>: [{<span class="stringliteral">&quot;role&quot;</span>: <span class="stringliteral">&quot;user&quot;</span>, <span class="stringliteral">&quot;content&quot;</span>: <span class="stringliteral">&quot;Search for papers on quantum computing&quot;</span>}],</div>
<div class="line">    <span class="stringliteral">&quot;model&quot;</span>: <span class="stringliteral">&quot;gpt-4o&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;provider&quot;</span>: <span class="stringliteral">&quot;openai&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;enable_tools&quot;</span>: <span class="keyword">True</span>,</div>
<div class="line">    <span class="stringliteral">&quot;tools&quot;</span>: [...],  <span class="comment"># Custom tool definitions</span></div>
<div class="line">    <span class="stringliteral">&quot;tool_choice&quot;</span>: <span class="stringliteral">&quot;auto&quot;</span></div>
<div class="line">})</div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="autotoc_md2042"></a>
Schema Validation</h1>
<p>The system now supports automatic schema validation for structured responses:</p>
<ol type="1">
<li><b>External Schema Files</b>: Complex schemas are stored in separate <span class="tt">.schema.json</span> files</li>
<li><b>Reference Resolution</b>: Schema references are automatically resolved at runtime</li>
<li><b>Response Validation</b>: Responses are validated against schemas when available</li>
<li><b>Error Handling</b>: Graceful handling of validation failures with detailed error messages</li>
</ol>
<h1 class="doxsection"><a class="anchor" id="autotoc_md2043"></a>
Benefits</h1>
<ol type="1">
<li><b>Consistency</b>: Common format ensures consistent prompt configurations across the system</li>
<li><b>Maintainability</b>: External schema files make schema management easier</li>
<li><b>Flexibility</b>: Support for multiple AI providers with provider-specific tool formats</li>
<li><b>Validation</b>: Automatic schema validation ensures response quality</li>
<li><b>Extensibility</b>: Easy to add new tools and providers</li>
<li><b>Testing</b>: Comprehensive test suite ensures reliability</li>
</ol>
<h1 class="doxsection"><a class="anchor" id="autotoc_md2044"></a>
Next Steps</h1>
<ol type="1">
<li><b>Integration Testing</b>: Test with real MCP clients and network service deployment</li>
<li><b>Provider Testing</b>: Validate tool calling with actual API endpoints</li>
<li><b>Performance</b>: Monitor tool calling performance and optimize if needed</li>
<li><b>Documentation</b>: Add API documentation for new parameters</li>
<li><b>Monitoring</b>: Add logging and metrics for tool usage tracking</li>
</ol>
<h1 class="doxsection"><a class="anchor" id="autotoc_md2045"></a>
Migration Guide</h1>
<p>For existing prompt files:</p>
<ol type="1">
<li>Convert to common format structure</li>
<li>Extract complex schemas to separate files</li>
<li>Update references to use schema files</li>
<li>Test with the new utility functions</li>
<li>Validate enhanced tool support works as expected</li>
</ol>
<p>The enhanced tool support maintains backward compatibility while providing significant new capabilities for research workflows. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on <span class="timestamp"></span> for ACP - Autonomous Command Protocol by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.15.0 </li>
  </ul>
</div>
</body>
</html>

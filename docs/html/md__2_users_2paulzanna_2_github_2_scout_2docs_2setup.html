<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.15.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ACP - Autonomous Command Protocol: Setup</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">ACP - Autonomous Command Protocol<span id="projectnumber">&#160;v0.3.0</span>
   </div>
   <div id="projectbrief">Portable C99 framing library with COBS, CRC16, and HMAC-SHA256 authentication</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.15.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('md__2_users_2paulzanna_2_github_2_scout_2docs_2setup.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Setup </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md8321"></a></p>
<p>This page describe steps absolutly required to proceed before first flight.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md8322"></a>
Connecting to Betaflight Configurator</h1>
<p>Once you download and install <a href="https://github.com/betaflight/betaflight-configurator">Betaflight configurator</a> you need to change few options first. Open configurator and go to <b>Options</b> tab, and then</p><ol type="1">
<li>Disable <span class="tt">Advanced CLI AutoComplete</span></li>
<li>Enable <span class="tt">Show all serial devices</span></li>
<li>Disable <span class="tt">Auto-Connect</span></li>
</ol>
<p><img src="/docs/images/bfc/bfc_options.png" alt="Options" class="inline"/></p>
<p>Then select your device from list and click connect.</p>
<dl class="section note"><dt>Note</dt><dd>Not all functions displayed in configurator are avalable in firmware. The rule of thumb is if you cannot change specific option in Betaflight Configurator, that means it is not supported. It usually rolls back to previous value after save.</dd>
<dd>
Leaving some tabs, especially CLI requires you to click "Disconnect" button twice, and then click "Connect" again.</dd></dl>
<h1 class="doxsection"><a class="anchor" id="autotoc_md8323"></a>
Configure wiring</h1>
<p>Go to the <span class="tt">CLI</span> tab and type <span class="tt">get pin</span>. This command will show what pins are associated to specified functions. If you wiring is diferrent, you can make some adjustments here. For more details, see <a href="/docs/cli.md#pin-functions">Pin Functions CLI Reference</a></p>
<p><img src="/docs/images/bfc/bfc_cli_pins.png" alt="CLI Pins" class="inline"/></p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md8324"></a>
Gyro calibration</h1>
<p>Go to <span class="tt">Setup tab</span>, make sure that your model is in horizontal steady state position. Then click <b>"Calibrate Accelerometer"</b> button and wait two seconds.</p>
<dl class="section attention"><dt>Attention</dt><dd>Ensure that model in preview moves exactly in the same way as yours. If it is not the case, go to the <span class="tt">Configuration</span> tab, and configure <span class="tt">Board orientation</span> or <span class="tt">Sensor Alignment</span></dd></dl>
<p><img src="/docs/images/bfc/bfc_configuration.png" alt="Sensor Alignment" class="inline"/></p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md8325"></a>
System configuration</h1>
<p>In <span class="tt">Configuration</span> tab set <span class="tt">Pid loop frequency</span>. Recomended values are 1kHz to 2kHz. Keep eye on CPU Load displayed in bottom, it shoudn't exceed 50%.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md8326"></a>
Receiver setup</h1>
<p>If you want to use Serial based receiver (SBUS,IBUS,CRSF), you need to allocate UART port for it. You can do it in <span class="tt">Ports</span> tab, by ticking switch in <span class="tt">Serial Rx</span> column.</p>
<p>Then go to the <span class="tt">Receiver</span> tab, and select <span class="tt">Receiver mode</span> and <span class="tt">Serial Receiver Provider</span>.</p>
<p>To use ESP-NOW receiver, choose "SPI Rx (e.g. built-in Rx)" receiver mode in Receiver tab. You need compatible transmitter module. Read more about ESP-FC Wireless Functions</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md8327"></a>
Motor setup</h1>
<p>In <span class="tt">Motors</span> tab you must configure</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md8328"></a>
Mixer</h2>
<p>You can select mixer type here, this configuration depends on type of aircraft you are configuring.</p>
<p><b>Important!</b> If you build multirotor, you must ensure that</p>
<ol type="1">
<li>Specified motor number is connected to specified output and placed in specified position in your aircraft according to gyro orientation, presented on a picture.</li>
<li>Specified motor is rotating in correct direction according to image.</li>
</ol>
<dl class="section attention"><dt>Attention</dt><dd>If these conditions aren't met, your quad will go crazy on the first start and may cause damage or even injury.</dd></dl>
<p>To verify that you can enable <b>test mode</b> and spin each motor selectively. To do that,</p><ol type="1">
<li>remove all propellers,</li>
<li>connect batery,</li>
<li>click "I understand the risk...",</li>
<li>move specified slider to spin motor.</li>
</ol>
<p>If you are using any analog protocol (PWM, OneShot, Multishot), you also need to calibrate your ESCs here. To do that</p><ol type="1">
<li>click "I understand the risk...",</li>
<li>move master sliders to highest value</li>
<li>connect battery</li>
<li>when escs plays calibration beeps, move master slider down to lowest value</li>
<li>escs should play confirmation beeps</li>
</ol>
<dl class="section note"><dt>Note</dt><dd>Only Quad X supported at the moment. Motor direction wizard is not supported, you must configure your ESC separately. The easiest way to change direction is swapping motor wires.</dd></dl>
<h2 class="doxsection"><a class="anchor" id="autotoc_md8329"></a>
Motor direction is reversed</h2>
<p>This option informs FC that your motors rotating in reverse order. This option desn't reverse motor direction. It has to be configured with ESC configurator or by swapping motor wires.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md8330"></a>
ESC protocol</h2>
<p>You can select here protocol according to that you ESC can handle. For multirotor it is recommended to use <span class="tt">DSHOT150</span> or <span class="tt">DSHOT300</span>. Older ESCs may not support digital protocols, in this case it is recommended to use <span class="tt">OneShot125</span> at least. <span class="tt">Brushed</span> protocol is for driving brushed motors through FET drivers.</p>
<p>It is not recomended to use <span class="tt">PWM</span> for multirotors.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md8331"></a>
Motor PWM speed separated from PID speed</h2>
<p>This option allows to separate PWM frequency. If your pid loop is set to 1k, but ESC can accept maximum 333Hz. PWM is limitted to 480Hz.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md8332"></a>
Flight modes</h1>
<p>Flight modes can be configured in <span class="tt">Modes</span> tab</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md8333"></a>
Arm</h2>
<p>It is required to enable this mode to be able to fly. Armed quad cause that motors are spinning (unless Motor stop option is enabled).</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md8334"></a>
Angle</h2>
<p>By default ACRO mode is engaged if none of flying mode is active. This mode enables self-leveling. In this case you control titlt angle of multirotor instead of rotationg rate. It affects only Roll and Pitch axes. Yaw axis behave the same way as in Acro mode.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md8335"></a>
Air mode</h2>
<p>Increases the range of control at extreme throttle positions. Recommended to enable, can be controlled by the same RC channel as Arm to get permanent behaviour. Activates, when throttle achive about 40% remains active until disarmed.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md8336"></a>
Buzzer</h2>
<p>Acitvates buzzer, for example to find lost model in high grass.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md8337"></a>
Fail safe</h2>
<p>Triggers Failsafe procedure.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md8338"></a>
Blackbox</h1>
<p>It is possible to collect flight data in two ways. Via <span class="tt">serial port</span> or with <span class="tt">onboard flash</span></p>
<p>Onboard flash allows to store about 2.5MB of data. This is equivalent of 2-3 minutes of flight. It should be enough for tuning.</p>
<p>If you need more, choose <span class="tt">Serial Port</span> and serial device like <a href="https://github.com/d-ronin/openlager">D-ronin OpenLager</a> or <a href="https://github.com/sparkfun/OpenLog">OpenLog</a>. To configure it</p><ol type="1">
<li>In <span class="tt">Ports</span> select uart to generate stream and in Peripherals column select <span class="tt">Blackbox logging</span> on free port</li>
<li>Then in <span class="tt">Blackbox</span> tab select <span class="tt">Serial Port</span> or <span class="tt">Onboard flash</span> as <span class="tt">logging device</span></li>
</ol>
<dl class="section note"><dt>Note</dt><dd>Port speed from column <span class="tt">Configuration/MSP</span> is used, and the same speed must be used in logging device, <em>(this might be subject of change in a future versions)</em>.</dd></dl>
<p>Recommended settings</p>
<ul>
<li>To log with 1k rate, you need device that is capable to receive data with 500kbps.</li>
<li>To log with 2k rate, you need 1Mbps</li>
</ul>
<p>OpenLager can handle it easily. If you plan to use OpenLog, you might need to flash <a href="https://github.com/cleanflight/blackbox-firmware">blackbox-firmware</a> to be able to handle more than 115.2kbps. Either 250kbps and 500kbps works well with modern SD cards up to 32GB size.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md8339"></a>
Limitations</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md8340"></a>
Configuration tab</h2>
<p>In Other features you can enable only <span class="tt">Dynamic Filter</span> and <span class="tt">SoftSerial</span></p>
<p><span class="tt">AirMode</span> is only available in modes tab. If you want to enable it permanently, use the same control channel as ARM.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md8341"></a>
Failsafe tab</h2>
<p>Only "Drop" Stage 2 procedule is possible</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md8342"></a>
Presets tab</h2>
<p>Presets aren't supported, do not try to apply any of them.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md8343"></a>
PID Tuning tab</h2>
<ol type="1">
<li>There is only one pid profile and one rate profile</li>
<li>Feed-forward transition has no effect</li>
<li>Iterm-rotation has no effect</li>
<li>Dynamic damping has no effect</li>
<li>Throttle boost has no effect</li>
<li>Miscellaneous settings has no effect</li>
<li>Dynamic Notch works from 1k pid loop, but is not displayed in configurator if this speed is configured, to reconfigure switch pid loop to 2k.</li>
</ol>
<p>Besides that most of Betaflight principles can be applied here according to PID and Filter tuning. But keep in mind, very aggresive tunnig tips aren't recommended to apply and might lead to diferrent results.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md8344"></a>
Receiver</h2>
<ol type="1">
<li>Not all protocols are implemented, currently only PPM, CRSF, SBUS, IBUS</li>
<li>NoOnly CRSF telemetry and and rssi_adc</li>
<li>RC deadband applies to RPY, no separate Yaw deadband</li>
</ol>
<h2 class="doxsection"><a class="anchor" id="autotoc_md8345"></a>
Modes</h2>
<p>Add range works only, no add link</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md8346"></a>
Adjustments</h2>
<p>Not implemented, for replacement you can use <a href="/docs/cli.md#scaler-configuration">pid scaler CLI</a></p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md8347"></a>
Servos</h2>
<p>Not Implemented, for replacemnt you can use <a href="/docs/cli.md#output-channel-config">output cli</a> to change output protocol and rate.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md8348"></a>
Motors</h2>
<p>No 3D features, only Quad-X Mixer</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md8349"></a>
Video transmitter</h2>
<p>Not yet implemented, work in progess</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md8350"></a>
OSD</h2>
<p>Not implemented, but MW_OSD should works via serial port and MSP protocol. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on <span class="timestamp"></span> for ACP - Autonomous Command Protocol by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.15.0 </li>
  </ul>
</div>
</body>
</html>

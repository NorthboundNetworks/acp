<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.15.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ACP - Autonomous Command Protocol: AI Coder Prompt — Eunice v0.5.9 “Synthesis Levels (UG/MSc/PhD)”</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">ACP - Autonomous Command Protocol<span id="projectnumber">&#160;v0.3.0</span>
   </div>
   <div id="projectbrief">Portable C99 framing library with COBS, CRC16, and HMAC-SHA256 authentication</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.15.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('md__2_users_2paulzanna_2_github_2_eunice_2docs_2_architecture_2coder__prompts_2eunice__v0_85_89__coder__prompt.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">AI Coder Prompt — Eunice v0.5.9 “Synthesis Levels (UG/MSc/PhD)” </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md823"></a></p>
<p><b>Date:</b> 12-08-2025 <br  />
 <b>Role:</b> Senior engineer implementing v0.5.9. Ship profile‑controlled synthesis with rigorous attribution. Small PRs, strong tests, deterministic outputs.</p>
<hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md825"></a>
0) Mission</h1>
<p>Add <b>profile‑based synthesis</b> (Undergraduate, Masters, PhD) on top of the v0.5.8 Evidence Graph. Generate structured reports whose <b>depth/rigour</b> deterministically change by profile, while preserving <b>page‑level attribution</b> to anchors.</p>
<hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md827"></a>
1) Constraints &amp; Standards</h1>
<ul>
<li>Python 3.11+, SQLAlchemy, Alembic, pytest, mypy, ruff. Keep prompts/config external.</li>
<li>Determinism: fixed seeds; cache reuse from v0.5.8; identical outputs on re‑run.</li>
<li>Evidence Graph is the single source of truth for claims/citations.</li>
<li>No embedded prompts; JSON templates/config in repo tracked with SHA256.</li>
<li>British English; SI units; Markdown reports.</li>
</ul>
<hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md829"></a>
2) Deliverables (DoD‑gated)</h1>
<ol type="1">
<li><b>Profiles</b> <span class="tt">ug|msc|phd</span> with external JSON configs (targets, thresholds, critique level).</li>
<li><b>Question Decomposer</b> that produces sub‑questions reproducibly from topic.</li>
<li><b>Argument Mapper</b> producing supports/contradicts sets per sub‑question with consensus scores.</li>
<li><b>Synthesis Engine</b> that builds structured blocks (Background, Evidence, Conflicts, Limitations, Open Questions, Next Steps) with per‑profile depth.</li>
<li><b>Outline Renderer</b> applying a profile‑specific outline template to produce <span class="tt">synthesis.json</span> and <span class="tt">report.md</span>.</li>
<li><b>Attribution Enforcement</b>: each assertion references <span class="tt">source_id#page</span> anchors (via v0.5.8 weave).</li>
<li><b>Telemetry + Manifests</b>: counts, consensus histogram, profile metadata captured.</li>
</ol>
<hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md831"></a>
3) Repository Changes</h1>
<div class="fragment"><div class="line">/eunice/synthesis/            # engine, question decomposition, argument maps</div>
<div class="line">/eunice/templates/            # outline JSON (ug/msc/phd)</div>
<div class="line">/eunice/profiles/             # profile params JSON (ug/msc/phd)</div>
<div class="line">/eunice/render/               # reuse renderer; add outline application step</div>
<div class="line">/tests/synthesis/             # unit, snapshot, property tests</div>
</div><!-- fragment --><hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md833"></a>
4) Database (Alembic)</h1>
<p>Add tables:</p><ul>
<li><span class="tt">profile(id, name, params_json)</span></li>
<li><span class="tt">outline_template(id, profile_id, name, spec_json, sha256)</span></li>
<li><span class="tt">synthesis_run(id, run_id, profile_id, questions_json, metrics_json, created_at)</span></li>
<li><span class="tt">synthesis_block(id, synthesis_run_id, section, content_json, consensus_score)</span></li>
<li><span class="tt">block_citation(id, block_id, source_id, anchor_id)</span></li>
</ul>
<p>Indexes: <span class="tt">(synthesis_run_id, section)</span>, FK constraints, <span class="tt">outline_template.sha256</span> unique.</p>
<hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md835"></a>
5) Algorithms</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md836"></a>
5.1 Question Decomposition</h2>
<ul>
<li>Input: topic description + Evidence Graph metadata (titles/keywords).</li>
<li>Output: ordered sub‑questions; deterministic with fixed prompt + seed.</li>
<li>Fallback rule‑based decomposition if LLM confidence&lt;τ.</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md837"></a>
5.2 Argument Mapping</h2>
<ul>
<li>For each sub‑question, gather claim neighbourhoods and edges <span class="tt">supports|contradicts</span>.</li>
<li><b>Consensus</b> = weighted support ratio: <br  />
 <span class="tt">consensus = Σ(w_i * 1[support]) / Σ(w_i)</span> <br  />
 where <span class="tt">w_i = anchor_confidence × source_quality × recency_factor</span>.</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md838"></a>
5.3 Depth Control (Profiles)</h2>
<ul>
<li>UG: 10–20 sources, minimal stats, light critique.</li>
<li>MSc: 20–40 sources, method summary, basic stats.</li>
<li>PhD: 40+ sources, strong method critique, limitations mandatory.</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md839"></a>
5.4 Conflict Surfacing</h2>
<ul>
<li>If contradict weight / total weight ≥ τ_conflict → mandatory <b>Conflicts</b> section.</li>
</ul>
<hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md841"></a>
6) Interfaces</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md842"></a>
6.1 CLI</h2>
<ul>
<li><span class="tt">eunice synthesise --run &lt;run_id&gt; --profile ug</span></li>
<li><span class="tt">eunice outline validate --template templates/ug.json</span></li>
<li><span class="tt">eunice render --profile ug</span></li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md843"></a>
6.2 Internal FastAPI</h2>
<div class="fragment"><div class="line">POST /synthesis/run     -&gt; {run_id, profile} -&gt; {synthesis_run_id}</div>
<div class="line">GET  /synthesis/{id}    -&gt; {blocks, metrics}</div>
</div><!-- fragment --><hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md845"></a>
7) Config &amp; Templates</h1>
<div class="fragment"><div class="line">/profiles/ug.json</div>
<div class="line">/profiles/msc.json</div>
<div class="line">/profiles/phd.json</div>
<div class="line">/templates/ug_outline.json</div>
<div class="line">/templates/msc_outline.json</div>
<div class="line">/templates/phd_outline.json</div>
</div><!-- fragment --><p> Template schema snippet: </p><div class="fragment"><div class="line">{</div>
<div class="line">  &quot;name&quot;: &quot;phd_outline&quot;,</div>
<div class="line">  &quot;sections&quot;: [</div>
<div class="line">    {&quot;id&quot;:&quot;background&quot;,&quot;min_words&quot;:400},</div>
<div class="line">    {&quot;id&quot;:&quot;current_evidence&quot;,&quot;min_words&quot;:1200},</div>
<div class="line">    {&quot;id&quot;:&quot;conflicts&quot;,&quot;required&quot;: true},</div>
<div class="line">    {&quot;id&quot;:&quot;limitations&quot;,&quot;required&quot;: true},</div>
<div class="line">    {&quot;id&quot;:&quot;open_questions&quot;},</div>
<div class="line">    {&quot;id&quot;:&quot;next_steps&quot;}</div>
<div class="line">  ]</div>
<div class="line">}</div>
</div><!-- fragment --><hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md847"></a>
8) Tests (pytest)</h1>
<ul>
<li><b>Snapshot per profile:</b> generated <span class="tt">report.md</span> &amp; <span class="tt">synthesis.json</span> stable across runs.</li>
<li><b>Attribution check:</b> every citation maps to valid <span class="tt">source_id#page</span>.</li>
<li><b>Consensus sanity:</b> curated conflicting inputs → Conflicts section appears.</li>
<li><b>Depth windows:</b> UG/MSc/PhD differ as per targets; enforce via assertions.</li>
<li><b>Determinism:</b> repeat run → byte‑identical outputs (after cache warm).</li>
</ul>
<hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md849"></a>
9) CI Gates (fail if below)</h1>
<ul>
<li>100% of blocks contain attributions where applicable.</li>
<li>Profile deltas present (e.g., section counts/lengths differ as configured).</li>
<li>Deterministic snapshot tests pass.</li>
</ul>
<hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md851"></a>
10) Work Plan (PRs)</h1>
<p><b>PR1:</b> DB migrations + profile/template loaders + schema validation <br  />
 <b>PR2:</b> Question Decomposer (deterministic) + tests <br  />
 <b>PR3:</b> Argument Mapper + consensus scoring + tests <br  />
 <b>PR4:</b> Synthesis Engine + block generation + tests <br  />
 <b>PR5:</b> Outline Renderer + report integration + snapshot tests <br  />
 <b>PR6:</b> Attribution enforcement + broken‑link detector reuse <br  />
 <b>PR7:</b> Telemetry/manifest updates + CLI wiring</p>
<hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md853"></a>
11) Telemetry &amp; Artefacts</h1>
<ul>
<li>Metrics: sources cited, consensus histogram, conflicts triggered, tokens used.</li>
<li>Artefacts: <span class="tt">synthesis.json</span>, <span class="tt">outline_applied.json</span>, <span class="tt">report.md</span>, updated <span class="tt">run_manifest.json</span>.</li>
</ul>
<hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md855"></a>
12) Edge Cases</h1>
<ul>
<li>Sparse evidence → fall back to UG minimal narrative with explicit “insufficient evidence” notice.</li>
<li>Highly contradictory evidence → split by methodology subgroup; document separately.</li>
<li>Duplicate claims across sources → collapse at synthesis time using canonical source.</li>
</ul>
<hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md857"></a>
13) Runbook</h1>
<ol type="1">
<li>Create branch <span class="tt">feature/v0.5.9-synthesis-levels</span>.</li>
<li>Apply migrations; seed default profiles/outlines.</li>
<li>Implement PRs sequentially; ensure CI green.</li>
<li>Validate on golden topics; update snapshots.</li>
<li>Document profile knobs in <span class="tt">/profiles/*.json</span>.</li>
</ol>
<hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md859"></a>
14) Definition of Done</h1>
<ul>
<li>Three profiles produce measurably different, deterministic outputs.</li>
<li>All assertions attributed to anchored sources.</li>
<li>CI snapshot and attribution tests pass; artefacts published. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on <span class="timestamp"></span> for ACP - Autonomous Command Protocol by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.15.0 </li>
  </ul>
</div>
</body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.15.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ACP - Autonomous Command Protocol: QuickStart: SCP v1.1 Implementation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">ACP - Autonomous Command Protocol<span id="projectnumber">&#160;v0.3.0</span>
   </div>
   <div id="projectbrief">Portable C99 framing library with COBS, CRC16, and HMAC-SHA256 authentication</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.15.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('md__2_users_2paulzanna_2_github_2_scout_2specs_2003-gcs-comm-interface_2quickstart.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">QuickStart: SCP v1.1 Implementation </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md8815"></a></p>
<p><b>Date</b>: 2025-10-26 <br  />
 <b>Feature</b>: Secure Control Protocol (SCP) v1.1 Implementation</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md8816"></a>
Development Setup</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md8817"></a>
Prerequisites</h2>
<ul>
<li>ESP-IDF 5.x development environment</li>
<li>PlatformIO with ESP32-S3 platform support</li>
<li>Unity test framework for embedded testing</li>
<li>Python 3.8+ for GCS simulator and testing tools</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md8818"></a>
Build Environment</h2>
<div class="fragment"><div class="line"># Clone Scout repository and checkout feature branch</div>
<div class="line">git clone &lt;repo_url&gt; scout</div>
<div class="line">cd scout</div>
<div class="line">git checkout 003-gcs-comm-interface</div>
<div class="line"> </div>
<div class="line"># Install development dependencies</div>
<div class="line">./setup-dev.sh</div>
<div class="line"> </div>
<div class="line"># Build firmware with SCP support</div>
<div class="line">pio run -e freenove_esp32_s3_wroom</div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="autotoc_md8819"></a>
Implementation Phases</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md8820"></a>
Phase 1: Core Protocol Infrastructure (Week 1-2)</h2>
<p><b>Priority</b>: P1 - Essential for basic communication</p>
<p><b>Components</b>:</p>
<ol type="1">
<li><span class="tt"><a class="el" href="scp__framer_8c.html" title="SCP Protocol Frame Processing - COBS Encoding/Decoding and Message Validation.">src/services/scp_framer.c</a></span> - COBS framing implementation</li>
<li><span class="tt"><a class="el" href="scp__crypto_8c.html" title="SCP Cryptographic Functions Implementation.">src/services/scp_crypto.c</a></span> - HMAC-SHA256 authentication <br  />
</li>
<li><span class="tt"><a class="el" href="scp__session_8c.html" title="SCP Session Management Implementation.">src/services/scp_session.c</a></span> - Session management</li>
<li><span class="tt"><a class="el" href="scp__protocol_8h.html" title="Secure Control Protocol (SCP) v1.1 Main Protocol Definitions.">include/scp_protocol.h</a></span> - Protocol definitions</li>
</ol>
<p><b>Validation</b>:</p>
<div class="fragment"><div class="line"># Run unit tests for protocol components</div>
<div class="line">pio test -e native -f test_scp_*</div>
<div class="line"> </div>
<div class="line"># Validate frame encoding/decoding</div>
<div class="line">./tests/unit/test_scp_framing</div>
<div class="line"> </div>
<div class="line"># Test authentication functions</div>
<div class="line">./tests/unit/test_scp_crypto</div>
</div><!-- fragment --><p><b>Acceptance Criteria</b>:</p>
<ul class="check">
<li class="unchecked">COBS encoding/decoding passes all test vectors</li>
</ul>
<ul class="check">
<li class="unchecked">HMAC-SHA256 authentication validates correctly</li>
</ul>
<ul class="check">
<li class="unchecked">Session management enforces timeouts and role authorization</li>
</ul>
<ul class="check">
<li class="unchecked">Protocol definitions compile without warnings</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md8821"></a>
Phase 2: GCS Gateway Service (Week 2-3)</h2>
<p><b>Priority</b>: P1 - Core command/telemetry functionality</p>
<p><b>Components</b>:</p>
<ol type="1">
<li><span class="tt"><a class="el" href="gcs__gateway_8c.html" title="GCS Gateway Service Implementation.">src/services/gcs_gateway.c</a></span> - Main protocol implementation</li>
<li>CLI integration for SCP configuration</li>
<li>Safety manager integration for command validation</li>
<li>Telemetry system integration for status reporting</li>
</ol>
<p><b>Integration Points</b>:</p>
<div class="fragment"><div class="line"><span class="comment">// Safety integration</span></div>
<div class="line"><span class="keywordtype">bool</span> safety_validate_gcs_command(scp_cmd_control_t* cmd, uint8_t operator_role);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Audit integration  </span></div>
<div class="line"><span class="keywordtype">void</span> audit_log_gcs_command(uint32_t session_id, uint8_t cmd_type, <span class="keywordtype">bool</span> accepted);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Telemetry integration</span></div>
<div class="line"><span class="keywordtype">void</span> telemetry_queue_scp_message(uint8_t msg_type, <span class="keywordtype">void</span>* payload, <span class="keywordtype">size_t</span> length);</div>
</div><!-- fragment --><p><b>Validation</b>:</p>
<div class="fragment"><div class="line"># Test basic command processing</div>
<div class="line">./tests/integration/test_gcs_gateway</div>
<div class="line"> </div>
<div class="line"># Validate safety integration</div>
<div class="line">./tests/integration/test_command_validation</div>
<div class="line"> </div>
<div class="line"># Check telemetry generation</div>
<div class="line">./tests/integration/test_telemetry_streaming</div>
</div><!-- fragment --><p><b>Acceptance Criteria</b>:</p>
<ul class="check">
<li class="unchecked">Commands route through safety validation</li>
</ul>
<ul class="check">
<li class="unchecked">Responses generated within 100ms</li>
</ul>
<ul class="check">
<li class="unchecked">Telemetry streams at configured rate</li>
</ul>
<ul class="check">
<li class="unchecked">All protocol events logged to audit system</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md8822"></a>
Phase 3: Multi-Operator Support (Week 3-4)</h2>
<p><b>Priority</b>: P2 - Enhanced operational capability</p>
<p><b>Components</b>:</p>
<ol type="1">
<li>Role-based command authorization</li>
<li>Conflict resolution for concurrent commands</li>
<li>Rate limiting per operator session</li>
<li>Priority-based message queuing</li>
</ol>
<p><b>Role Authorization Matrix</b>:</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">bool</span> role_permissions[4][5] = {</div>
<div class="line">    <span class="comment">// ARM, DISARM, MODE, GIMBAL, CONFIG</span></div>
<div class="line">    {<span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>}, <span class="comment">// Invalid role</span></div>
<div class="line">    {<span class="keyword">true</span>,  <span class="keyword">true</span>,  <span class="keyword">true</span>,  <span class="keyword">true</span>,  <span class="keyword">true</span>},  <span class="comment">// Mission Commander</span></div>
<div class="line">    {<span class="keyword">true</span>,  <span class="keyword">true</span>,  <span class="keyword">true</span>,  <span class="keyword">true</span>,  <span class="keyword">false</span>}, <span class="comment">// Pilot  </span></div>
<div class="line">    {<span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">true</span>,  <span class="keyword">false</span>}, <span class="comment">// Observer</span></div>
<div class="line">};</div>
</div><!-- fragment --><p><b>Validation</b>:</p>
<div class="fragment"><div class="line"># Test role-based access control</div>
<div class="line">./tests/integration/test_role_authorization</div>
<div class="line"> </div>
<div class="line"># Validate conflict resolution</div>
<div class="line">./tests/integration/test_command_conflicts</div>
<div class="line"> </div>
<div class="line"># Check rate limiting enforcement</div>
<div class="line">./tests/integration/test_rate_limiting</div>
</div><!-- fragment --><p><b>Acceptance Criteria</b>:</p>
<ul class="check">
<li class="unchecked">Role permissions enforced correctly</li>
</ul>
<ul class="check">
<li class="unchecked">Command conflicts resolved by operator priority</li>
</ul>
<ul class="check">
<li class="unchecked">Rate limiting prevents system overload</li>
</ul>
<ul class="check">
<li class="unchecked">Up to 3 concurrent sessions supported</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md8823"></a>
Phase 4: Security &amp; Hardening (Week 4-5)</h2>
<p><b>Priority</b>: P2 - Military-grade security requirements</p>
<p><b>Components</b>:</p>
<ol type="1">
<li>Anti-replay protection with sequence validation</li>
<li>Cryptographic key management in NVS</li>
<li>Anti-jamming and error recovery</li>
<li>Security event monitoring and alerting</li>
</ol>
<p><b>Security Validations</b>:</p>
<div class="fragment"><div class="line"># Test replay attack detection</div>
<div class="line">./tests/security/test_replay_protection</div>
<div class="line"> </div>
<div class="line"># Validate authentication bypass attempts</div>
<div class="line">./tests/security/test_auth_bypass</div>
<div class="line"> </div>
<div class="line"># Check key rotation support</div>
<div class="line">./tests/security/test_key_rotation</div>
</div><!-- fragment --><p><b>Acceptance Criteria</b>:</p>
<ul class="check">
<li class="unchecked">100% replay attack detection and blocking</li>
</ul>
<ul class="check">
<li class="unchecked">Authentication keys stored securely in NVS</li>
</ul>
<ul class="check">
<li class="unchecked">Security violations logged and reported</li>
</ul>
<ul class="check">
<li class="unchecked">Graceful degradation under jamming conditions</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md8824"></a>
Testing Strategy</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md8825"></a>
Unit Tests (Automated)</h2>
<div class="fragment"><div class="line"># Core protocol functions</div>
<div class="line">pio test -e native -f test_scp_framing</div>
<div class="line">pio test -e native -f test_scp_crypto  </div>
<div class="line">pio test -e native -f test_scp_session</div>
<div class="line"> </div>
<div class="line"># Message validation</div>
<div class="line">pio test -e native -f test_message_validation</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="autotoc_md8826"></a>
Integration Tests (Semi-Automated)</h2>
<div class="fragment"><div class="line"># Protocol integration with existing systems</div>
<div class="line">./tests/integration/run_protocol_tests.py</div>
<div class="line"> </div>
<div class="line"># Multi-operator scenarios</div>
<div class="line">./tests/integration/run_multi_operator_tests.py</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="autotoc_md8827"></a>
Hardware Validation (Manual)</h2>
<ol type="1">
<li>Connect GCS simulator via UART/USB</li>
<li>Execute command/telemetry test sequences</li>
<li>Monitor <span class="tt">stats</span> output for performance impact</li>
<li>Validate security with attack simulation tools</li>
</ol>
<h1 class="doxsection"><a class="anchor" id="autotoc_md8828"></a>
Configuration</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md8829"></a>
SCP Protocol Configuration</h2>
<div class="fragment"><div class="line"># Enable SCP protocol (default: disabled for safety)</div>
<div class="line">set scp_enabled = ON</div>
<div class="line"> </div>
<div class="line"># Configure telemetry rate (1-10 Hz)</div>
<div class="line">set scp_telemetry_rate = 5</div>
<div class="line"> </div>
<div class="line"># Set session timeout (seconds)</div>
<div class="line">set scp_session_timeout = 900</div>
<div class="line"> </div>
<div class="line"># Configure authentication requirement</div>
<div class="line">set scp_require_auth = ON</div>
<div class="line"> </div>
<div class="line"># Save configuration</div>
<div class="line">save</div>
<div class="line">reboot</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="autotoc_md8830"></a>
Security Configuration</h2>
<div class="fragment"><div class="line"># Generate and set HMAC keys (out-of-band process)</div>
<div class="line">scp_keygen --role commander --output commander.key</div>
<div class="line">scp_keygen --role pilot --output pilot.key</div>
<div class="line">scp_keygen --role observer --output observer.key</div>
<div class="line"> </div>
<div class="line"># Install keys to drone (secure process)</div>
<div class="line">scp_install_key --role commander --keyfile commander.key</div>
<div class="line">scp_install_key --role pilot --keyfile pilot.key  </div>
<div class="line">scp_install_key --role observer --observer.key</div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="autotoc_md8831"></a>
Monitoring &amp; Diagnostics</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md8832"></a>
Runtime Status</h2>
<div class="fragment"><div class="line"># Check SCP service status</div>
<div class="line">scp_status</div>
<div class="line"> </div>
<div class="line"># Monitor active sessions</div>
<div class="line">scp_sessions</div>
<div class="line"> </div>
<div class="line"># View protocol statistics</div>
<div class="line">scp_stats</div>
<div class="line"> </div>
<div class="line"># Check security events</div>
<div class="line">scp_audit</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="autotoc_md8833"></a>
Performance Monitoring</h2>
<div class="fragment"><div class="line"># Real-time performance impact</div>
<div class="line">stats</div>
<div class="line"> </div>
<div class="line"># Protocol-specific timing</div>
<div class="line">scp_timing</div>
<div class="line"> </div>
<div class="line"># Memory usage tracking</div>
<div class="line">status</div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="autotoc_md8834"></a>
Troubleshooting</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md8835"></a>
Common Issues</h2>
<p><b>Authentication Failures</b></p>
<ul>
<li>Verify HMAC keys are installed correctly</li>
<li>Check system clock synchronization</li>
<li>Validate message sequence numbers</li>
</ul>
<p><b>Performance Degradation</b> <br  />
</p>
<ul>
<li>Monitor CPU usage with <span class="tt">stats</span> command</li>
<li>Check for excessive command rates</li>
<li>Verify telemetry rate configuration</li>
</ul>
<p><b>Connection Issues</b></p>
<ul>
<li>Validate transport layer (UART/USB/SPI)</li>
<li>Check COBS framing synchronization</li>
<li>Monitor CRC error rates</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md8836"></a>
Debug Commands</h2>
<div class="fragment"><div class="line"># Enable protocol debug logging</div>
<div class="line">set debug_scp = ON</div>
<div class="line"> </div>
<div class="line"># Monitor message flow</div>
<div class="line">scp_monitor --verbose</div>
<div class="line"> </div>
<div class="line"># Dump protocol state</div>
<div class="line">scp_dump</div>
<div class="line"> </div>
<div class="line"># Reset protocol service</div>
<div class="line">scp_restart</div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="autotoc_md8837"></a>
Safety Considerations</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md8838"></a>
Pre-Flight Checklist</h2>
<ul class="check">
<li class="unchecked">SCP authentication keys installed and verified</li>
</ul>
<ul class="check">
<li class="unchecked">Operator roles configured correctly <br  />
</li>
</ul>
<ul class="check">
<li class="unchecked">Session timeouts set appropriately</li>
</ul>
<ul class="check">
<li class="unchecked">Security monitoring enabled</li>
</ul>
<ul class="check">
<li class="unchecked">Performance impact validated (<span class="tt">stats</span> output)</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md8839"></a>
Emergency Procedures</h2>
<ul>
<li>Physical safety switch overrides all GCS commands</li>
<li>Multiple authentication failures trigger automatic lockout</li>
<li>Session timeout automatically disarms if no valid commands received</li>
<li>Emergency stop commands bypass rate limiting and priority queues</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md8840"></a>
Success Validation</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md8841"></a>
Functional Tests</h2>
<ul class="check">
<li class="unchecked">Basic arm/disarm commands work reliably</li>
</ul>
<ul class="check">
<li class="unchecked">Telemetry streams at configured rates</li>
</ul>
<ul class="check">
<li class="unchecked">Multi-operator sessions function correctly</li>
</ul>
<ul class="check">
<li class="unchecked">Role-based permissions enforced</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md8842"></a>
Performance Tests</h2>
<ul class="check">
<li class="unchecked">Command acknowledgment &lt; 100ms</li>
</ul>
<ul class="check">
<li class="unchecked">CPU usage remains &lt; 70% during operation</li>
</ul>
<ul class="check">
<li class="unchecked">Memory usage within 8KB protocol budget</li>
</ul>
<ul class="check">
<li class="unchecked">Real-time control loops unaffected</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md8843"></a>
Security Tests</h2>
<ul class="check">
<li class="unchecked">Authentication bypass attempts blocked</li>
</ul>
<ul class="check">
<li class="unchecked">Replay attacks detected and rejected <br  />
</li>
</ul>
<ul class="check">
<li class="unchecked">Rate limiting prevents DoS conditions</li>
</ul>
<ul class="check">
<li class="unchecked">Security events logged completely </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on <span class="timestamp"></span> for ACP - Autonomous Command Protocol by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.15.0 </li>
  </ul>
</div>
</body>
</html>

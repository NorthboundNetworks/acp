<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.15.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ACP - Autonomous Command Protocol: Literature Worker — Process Review and Recommendations</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">ACP - Autonomous Command Protocol<span id="projectnumber">&#160;v0.3.0</span>
   </div>
   <div id="projectbrief">Portable C99 framing library with COBS, CRC16, and HMAC-SHA256 authentication</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.15.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('md__2_users_2paulzanna_2_github_2_eunice_2docs_2_workflows_2literature__worker__process.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Literature Worker — Process Review and Recommendations </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md2238"></a></p>
<p>This document summarizes the behavior, data shapes, flow, error modes, edge cases, and suggested improvements for <span class="tt">research-manager/src/literature_worker.py</span>.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md2239"></a>
Summary</h1>
<p><span class="tt">LiteratureWorker</span> is an async task worker that performs multi-source literature searches (PubMed, Semantic Scholar, arXiv), extracts and enriches content (abstracts), detects duplicates, scores relevance, optionally generates an LLM-based summary, and stores results via the base worker framework.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md2240"></a>
High-level flow</h1>
<ol type="1">
<li>initialize(): creates an <span class="tt">aiohttp.ClientSession</span> and an <span class="tt">LLMClient</span> (mock fallback available).</li>
<li>process_task(task_data): main entry point; validates input, reports progress, and orchestrates the pipeline.</li>
<li>search_all_sources(): dispatches per-source searches and aggregates results.</li>
<li>extract_content(): extracts/enhances abstracts and adds metadata.</li>
<li>detect_duplicates(): removes duplicates using title similarity (Jaccard-style word overlap).</li>
<li>score_relevance(): computes a relevance score per result and sorts results.</li>
<li>generate_summary(): builds a prompt from top results and calls the LLM client.</li>
<li>store_result(): stores the results artifact and the summary (if generated).</li>
<li>shutdown(): closes session and calls super().shutdown().</li>
</ol>
<h1 class="doxsection"><a class="anchor" id="autotoc_md2241"></a>
Inputs / Outputs (Contract)</h1>
<ul>
<li>Input (<span class="tt">task_data</span>):<ul>
<li><span class="tt">task_id</span> (str, uuid)</li>
<li><span class="tt">query</span> (str, required)</li>
<li><span class="tt">sources</span> (List[str], optional; default [<span class="tt">pubmed</span>])</li>
<li><span class="tt">filters</span> (dict): <span class="tt">max_results</span>, <span class="tt">date_range</span>, <span class="tt">study_types</span>, <span class="tt">languages</span></li>
<li><span class="tt">processing_options</span> (dict): <span class="tt">extract_abstracts</span>, <span class="tt">generate_summary</span>, <span class="tt">score_relevance</span>, <span class="tt">detect_duplicates</span></li>
</ul>
</li>
<li>Output (on success):<ul>
<li><span class="tt">{ status: "completed", total_results: int, summary: Optional[str], sources_searched: List[str], query: str }</span></li>
<li>Side effects: two calls to <span class="tt">store_result</span> (results and optional summary); several <span class="tt">update_progress</span> calls.</li>
</ul>
</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md2242"></a>
Result item schema (typical)</h1>
<ul>
<li><span class="tt">source</span>, <span class="tt">paper_id</span>/<span class="tt">id</span>, <span class="tt">title</span>, <span class="tt">abstract</span>, <span class="tt">authors</span> (List[str]), <span class="tt">year</span> (int), <span class="tt">journal</span>, <span class="tt">citation_count</span> (int), <span class="tt">url</span>, <span class="tt">doi</span>, <span class="tt">processed_at</span> (iso8601), <span class="tt">content_extracted</span> (bool), <span class="tt">abstract_length</span>, <span class="tt">abstract_word_count</span>, <span class="tt">relevance_score</span>.</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md2243"></a>
Key methods</h1>
<ul>
<li><span class="tt">process_task</span>: orchestrator with progress updates and storage.</li>
<li><span class="tt">search_pubmed</span>, <span class="tt">search_semantic_scholar</span>, <span class="tt">search_arxiv</span>: source-specific HTTP calls and parsers.</li>
<li><span class="tt">parse_pubmed_xml</span>, <span class="tt">parse_arxiv_xml</span>: currently TODO stubs.</li>
<li><span class="tt">format_semantic_scholar_result</span>: normalizes semantic scholar fields.</li>
<li><span class="tt">extract_content</span> / <span class="tt">extract_abstract_content</span>: enrich abstract data.</li>
<li><span class="tt">detect_duplicates</span> / <span class="tt">calculate_title_similarity</span>: simple title-based dedupe.</li>
<li><span class="tt">score_relevance</span> / <span class="tt">calculate_relevance_score</span>: scoring and ranking.</li>
<li><span class="tt">generate_summary</span>: creates LLM prompt and calls <span class="tt">self.llm_client.generate_response</span>.</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md2244"></a>
Error modes and current handling</h1>
<ul>
<li>Missing <span class="tt">query</span>: raises <span class="tt">LiteratureSearchError("Search query is required")</span>.</li>
<li>Non-200 HTTP responses: wrapped in <span class="tt">LiteratureSearchError</span> with status.</li>
<li>XML parsing for PubMed/arXiv: unimplemented; functions return empty lists with warnings.</li>
<li>LLM failures: caught in <span class="tt">generate_summary</span> and a fallback message is returned.</li>
<li>Any exception in <span class="tt">process_task</span>: logged and re-raised as <span class="tt">TaskExecutionError</span>.</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md2245"></a>
Edge cases and considerations</h1>
<ul>
<li>Empty or blank query -&gt; explicit error.</li>
<li>API rate limits and transient errors -&gt; currently no retry/backoff; consider adding exponential backoff with retries and 429 handling.</li>
<li>Large result sets -&gt; aggregation may be memory-heavy; consider streaming or pagination.</li>
<li>Duplicate detection threshold (0.9) is strict; consider fuzzy/token-set approaches and normalization.</li>
<li>Missing metadata (year, abstract) -&gt; scoring handles with defaults but could be further normalized.</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md2246"></a>
Implementation gaps &amp; recommended improvements</h1>
<ol type="1">
<li>Implement robust XML parsing for PubMed and arXiv (use <span class="tt">xml.etree.ElementTree</span> or <span class="tt">lxml</span>).</li>
<li>Add HTTP retry logic with exponential backoff for external API calls (handle 429/5xx).</li>
<li>Normalize output schema via a single formatter function to guarantee consistent fields.</li>
<li>Improve duplicate detection using fuzzy matching (e.g., token-set ratio, Levenshtein) and normalization (strip punctuation, stopwords).</li>
<li>Make LLM client pluggable and add timeouts/circuit breakers.</li>
<li>Add richer logging context (task_id, execution_id) on all log lines for traceability.</li>
<li>Add input validation (pydantic/dataclasses) for <span class="tt">task_data</span> to give clearer errors.</li>
<li>Consider streaming large result sets and limiting memory usage.</li>
</ol>
<h1 class="doxsection"><a class="anchor" id="autotoc_md2247"></a>
Tests to add</h1>
<ul>
<li>Unit tests:<ul>
<li><span class="tt">calculate_title_similarity</span> various cases</li>
<li><span class="tt">calculate_relevance_score</span> with multiple scoring components</li>
<li><span class="tt">detect_duplicates</span> with duplicates and near-duplicates</li>
<li><span class="tt">extract_abstract_content</span> for empty and long abstracts</li>
</ul>
</li>
<li>Integration tests (mocked HTTP + mocked LLM): verify <span class="tt">process_task</span> writes expected <span class="tt">store_result</span> artifacts and progress updates.</li>
<li>Parser tests: sample PubMed/arXiv XML files -&gt; assert parsed fields.</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md2248"></a>
Minimal smoke test (example)</h1>
<p>Create a test harness:</p>
<div class="fragment"><div class="line"><span class="comment"># conceptual example — use asyncio test harness and monkeypatch session and llm</span></div>
<div class="line">w = LiteratureWorker(...)</div>
<div class="line">await w.initialize()</div>
<div class="line"><span class="comment"># monkeypatch w.session.get to return canned responses</span></div>
<div class="line"><span class="comment"># monkeypatch w.llm_client.generate_response to return a short string</span></div>
<div class="line">await w.process_task(sample_task)</div>
<div class="line">await w.shutdown()</div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="autotoc_md2249"></a>
Small, low-risk next steps</h1>
<ul>
<li>Implement simple PubMed XML parsing to return at least <span class="tt">title</span>, <span class="tt">abstract</span>, <span class="tt">year</span>, and <span class="tt">authors</span>.</li>
<li>Add a retry wrapper for <span class="tt">self.session.get</span> with exponential backoff.</li>
<li>Add one unit test for <span class="tt">calculate_relevance_score</span>.</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md2250"></a>
Notes</h1>
<p>This review document was created from <span class="tt">research-manager/src/literature_worker.py</span> content you provided. If you want, I can implement one of the recommended code changes (parser, retry wrapper, or tests) now and run the tests.</p>
<hr  />
<p> Generated: review snapshot of <span class="tt">literature_worker.py</span> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on <span class="timestamp"></span> for ACP - Autonomous Command Protocol by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.15.0 </li>
  </ul>
</div>
</body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.15.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ACP - Autonomous Command Protocol: Feature Specification: Citadel Core CLI — Initial Implementation (v0.1)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">ACP - Autonomous Command Protocol<span id="projectnumber">&#160;v0.3.0</span>
   </div>
   <div id="projectbrief">Portable C99 framing library with COBS, CRC16, and HMAC-SHA256 authentication</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.15.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('md__2_users_2paulzanna_2_github_2_citadel_2specs_2001-_citadel-cli_2spec.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Feature Specification: Citadel Core CLI — Initial Implementation (v0.1) </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md568"></a></p>
<p><b>Feature Branch</b>: <span class="tt">001-Citadel-cli</span> <br  />
 <b>Created</b>: 2025-10-26 <br  />
 <b>Status</b>: Draft <br  />
 <b>Input</b>: User description: "Build the initial Citadel Core CLI to connect via serial using SCP v1.1, decode telemetry, display human-readable output (ASCII or optional TUI), recover from disconnects, support optional logging, and build cleanly on Linux/macOS with Makefile. Defaults: 115200 baud; minimal dependencies."</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md569"></a>
Clarifications</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md570"></a>
Session 2025-10-26</h2>
<ul>
<li>Q: What is the default disconnect recovery policy? → A: Auto-retry with backoff for up to 5 minutes, then exit non-zero.</li>
<li>Q: What timestamp format should the UI and logs use? → A: UTC ISO 8601 with Z (e.g., 2025-10-26T18:42:00Z).</li>
<li>Q: What logging format should optional telemetry logs use? → A: CSV with fixed columns (UTC ISO 8601 timestamp + fields).</li>
<li>Q: What is the default display mode on launch? → A: ASCII table by default; TUI only via flag/config.</li>
<li>Q: How are conflicts between config and CLI flags resolved? → A: Flags override config (flags &gt; config &gt; defaults).</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md571"></a>
User Scenarios &amp; Testing <em>(mandatory)</em></h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md572"></a>
User Story 1 - Connect and display telemetry (Priority: P1)</h2>
<p>An operator starts the CLI, connects to the specified serial port, and sees live telemetry values updating in the terminal.</p>
<p><b>Why this priority</b>: This is the core value proposition of the CLI MVP—turning serial telemetry into actionable on-screen information.</p>
<p><b>Independent Test</b>: With a mock or real device providing SCP frames, start the CLI and observe live updates for key metrics (CPU, temp, battery, IMU, GPS).</p>
<p><b>Acceptance Scenarios</b>:</p>
<ol type="1">
<li>Given a reachable serial device at 115200 baud, When the CLI is started with the device path, Then telemetry values appear and refresh continuously.</li>
<li>Given valid SCP frames, When decoding occurs, Then decoded fields match expected values from a known good sample.</li>
</ol>
<hr  />
<h2 class="doxsection"><a class="anchor" id="autotoc_md574"></a>
User Story 2 - Robust error handling and recovery (Priority: P1)</h2>
<p>If the serial connection drops or frames are corrupted, the CLI handles it gracefully, with retries or clean exit and clear operator feedback.</p>
<p><b>Why this priority</b>: Operational reliability is non-negotiable; the tool must be resilient in the field.</p>
<p><b>Independent Test</b>: Disconnect the cable or kill the mock source; verify retry/backoff up to 5 minutes then non-zero exit if still unavailable; resume immediately if reconnected within the window.</p>
<p><b>Acceptance Scenarios</b>:</p>
<ol type="1">
<li>Given an active session, When the serial device disappears, Then the CLI retries with exponential backoff for up to 5 minutes and exits with a non-zero code if the device does not return.</li>
<li>Given malformed SCP frames, When decoding attempts happen, Then errors are logged and the UI continues updating with next valid frames.</li>
</ol>
<hr  />
<h2 class="doxsection"><a class="anchor" id="autotoc_md576"></a>
User Story 3 - Logging for offline analysis (Priority: P2)</h2>
<p>An operator enables logging to capture telemetry for later review, without impacting live display.</p>
<p><b>Why this priority</b>: Enables audit and analysis, supporting compliance and debugging.</p>
<p><b>Independent Test</b>: Run the CLI with logging enabled; verify log file is created and contains timestamped telemetry entries.</p>
<p><b>Acceptance Scenarios</b>:</p>
<ol type="1">
<li>Given logging is enabled, When telemetry flows, Then the log file is written in CSV with a header row and fixed columns (including UTC ISO 8601 timestamp) and contains expected field values.</li>
<li>Given log rotation thresholds, When size/time thresholds are met (if configured), Then new logs are created without data loss.</li>
</ol>
<hr  />
<h2 class="doxsection"><a class="anchor" id="autotoc_md578"></a>
User Story 4 - Toggle ASCII/TUI display (Priority: P3)</h2>
<p>An operator can choose between a simple ASCII table or a basic ncurses TUI without changing the data content.</p>
<p><b>Why this priority</b>: Provides optional ergonomics without blocking MVP value.</p>
<p><b>Independent Test</b>: Launch with a flag or config; verify both modes render the same telemetry values and key status.</p>
<p><b>Acceptance Scenarios</b>:</p>
<ol type="1">
<li>Given the &ndash;mode=tui setting, When the app runs, Then the TUI shows headers, telemetry, and alerts areas.</li>
<li>Given the default mode, When the app runs, Then an ASCII table updates at the same cadence as the TUI.</li>
<li>Given no mode is provided, When the app runs, Then the ASCII display is used by default.</li>
</ol>
<hr  />
<p>[Add more user stories as needed, each with an assigned priority]</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md580"></a>
Edge Cases</h2>
<p><b>Serial Connection Issues</b>:</p>
<ul>
<li>No permission to open the serial device → Exit code 3 with actionable error message</li>
<li>Port path not found or already in use → Exit code 3 with device suggestions</li>
<li>Baud mismatch causing garbled frames → Log warnings, attempt frame resync</li>
<li>Extended disconnect &gt; 5 minutes → Exit code 4 after retry exhaustion</li>
</ul>
<p><b>Frame Processing Issues</b>:</p>
<ul>
<li>Burst traffic or partial frames at buffer boundaries → Buffer management with frame boundary detection</li>
<li>Corrupted frames (CRC failure) → Skip frame, log error, continue with next frame</li>
<li>Decoder resynchronization → Search for sync pattern, reset parser state</li>
</ul>
<p><b>Configuration Issues</b>:</p>
<ul>
<li>Config file missing or malformed → Fall back to defaults, warn user</li>
<li>Config value conflicts with CLI flag → CLI flag takes precedence, no error</li>
<li>Invalid flag values → Exit code 2 with usage help</li>
</ul>
<p><b>Display Issues</b>:</p>
<ul>
<li>Terminal too small to render TUI → Fall back to ASCII mode with warning</li>
<li>Insufficient terminal capabilities → Disable color/formatting, use plain text</li>
<li>Signal interruption (SIGINT/SIGTERM) → Graceful shutdown, close serial port</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md581"></a>
Requirements <em>(mandatory)</em></h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md582"></a>
Functional Requirements</h2>
<ul>
<li><b>FR-001</b>: The tool MUST connect to a specified serial port path with default baud 115200 and allow override via flag/config.</li>
<li><b>FR-002</b>: The tool MUST decode simplified SCP telemetry frames containing basic status data (CPU load/temp, battery, IMU, GPS) for MVP; full SCP v1.1 authentication deferred to v0.2.</li>
<li><b>FR-003</b>: The tool MUST render human-readable telemetry on the terminal with periodic refresh (target p95 ≤ 200 ms).</li>
<li><b>FR-004</b>: The tool MUST handle serial disconnects with exponential backoff for up to 5 minutes; if not reconnected within this window, exit cleanly with a non-zero status and actionable messaging.</li>
<li><b>FR-005</b>: The tool MUST support optional telemetry logging to a file (CSV) controlled by config/flag.</li>
<li><b>FR-006</b>: The tool MUST load settings from a configuration file (e.g., config/citadel.conf) with precedence: CLI flags &gt; config &gt; defaults.</li>
<li><b>FR-007</b>: The tool MUST build cleanly on supported platforms (Linux/macOS) without warnings.</li>
<li><b>FR-008</b>: The operator help output MUST document commands/flags, defaults, and examples.</li>
<li><b>FR-009</b>: The CLI/TUI output formats MUST remain stable to support scripting/operational checklists.</li>
<li><b>FR-010</b>: Release deliverables MUST include a changelog with known limitations and a checksum for artifacts per governance.</li>
<li><b>FR-011</b>: All timestamps in UI and logs MUST use UTC ISO 8601 with trailing 'Z' (e.g., 2025-10-26T18:42:00Z).</li>
<li><b>FR-012</b>: Default display mode MUST be ASCII. TUI mode MUST only activate when explicitly set via flag or config.</li>
<li><b>FR-013</b>: When logging is enabled, logs MUST be CSV with a header row and fixed columns (at minimum: timestamp_utc, cpu_load_pct, cpu_temp_c, battery_v, imu_gyro_z, gps_fix). Columns MAY be extended in later versions while preserving existing names.</li>
<li><b>FR-014</b>: For MVP, the tool MUST implement a simplified SCP decoder that extracts telemetry fields from <span class="tt">tlm_status_t</span> message type without authentication; sync pattern detection and basic CRC validation only.</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md583"></a>
Security Considerations <em>(mandatory)</em></h2>
<ul>
<li>Threat model summary: Assets (telemetry, logs, config); Entry points (serial port, config file); Mitigations (bounds checks, input validation, CRC verification when available, timeouts, log sanitization).</li>
<li>Cryptography usage (if any): None for MVP; if added, MUST be FIPS 140-3 validated modules.</li>
<li>SBOM: Will be generated for release artifacts (CycloneDX) and stored with provenance per governance.</li>
<li>Compliance touchpoints: NIST 800-53 control families (SA, CM, SC, SI) considerations and DISA STIG hardening guidance.</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md584"></a>
Performance Budget <em>(mandatory)</em></h2>
<ul>
<li>Telemetry update latency p95: ≤ 200 ms for refresh under typical SCP link rates at 115200 baud.</li>
<li>Throughput: Sustain SCP frame decode and display without frame drops at configured baud rates.</li>
<li>Memory footprint: ≤ 50 MB RSS during steady-state operation.</li>
<li>Startup time: ≤ 2 seconds to initial telemetry display (with available data).</li>
<li>Regression policy: &gt;5% degradation on any metric requires remediation or approval.</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md585"></a>
UX Conventions <em>(mandatory)</em></h2>
<ul>
<li>CLI flags: &ndash;port, &ndash;baud, &ndash;mode {ascii|tui}, &ndash;log [path], &ndash;config [path], &ndash;help.</li>
<li>Output format: stable ASCII table (fixed columns, predictable labels); optional TUI has consistent layout and content.</li>
<li>TUI layout: status header (connection, baud), telemetry panel (CPU, temp, battery, IMU, GPS), alerts area (errors, reconnects).</li>
<li>Accessibility: color-blind-safe palette and keyboard-first interaction; clear, actionable error messages.</li>
<li>Timestamps: Display and log timestamps in UTC ISO 8601 with 'Z' suffix.</li>
<li>Default mode: ASCII table unless &ndash;mode=tui (or config) is provided.</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md586"></a>
Quality Acceptance Bar <em>(mandatory)</em></h2>
<p><b>Build Configuration</b>:</p>
<ul>
<li><b>Compiler flags</b>: <span class="tt">-std=c11 -Wall -Wextra -Werror -Wpedantic -Wformat=2 -Wformat-security</span></li>
<li><b>Optimization</b>: <span class="tt">-O2 -g</span> (release), <span class="tt">-O0 -g3</span> (debug)</li>
<li><b>Hardening flags</b>: <span class="tt">-fstack-protector-strong -D_FORTIFY_SOURCE=2 -fPIE</span></li>
<li><b>Linker flags</b>: <span class="tt">-Wl,-z,relro,-z,now -pie</span> (Linux), <span class="tt">-Wl,-bind_at_load</span> (macOS)</li>
<li><b>Target platforms</b>: Linux (gcc ≥ 7.0, clang ≥ 6.0), macOS (clang ≥ 10.0)</li>
</ul>
<p><b>Static Analysis</b>:</p>
<ul>
<li><b>clang-tidy</b>: Enabled checks for <span class="tt">bugprone-*</span>, <span class="tt">cert-*</span>, <span class="tt">misc-*</span>, <span class="tt">readability-*</span></li>
<li><b>cppcheck</b>: <span class="tt">--enable=warning,style,performance,portability --error-exitcode=1</span></li>
<li><b>Acceptance threshold</b>: Zero new high/critical findings; warnings require justification</li>
<li><b>Integration</b>: Static analysis must pass before merge</li>
</ul>
<p><b>Testing Requirements</b>:</p>
<ul>
<li><b>Unit tests</b>: Decoder functions, utility functions (ISO 8601, config parsing)</li>
<li><b>Integration tests</b>: Serial connection simulation, end-to-end frame processing</li>
<li><b>Memory safety</b>: Valgrind (Linux) or AddressSanitizer clean execution for full test suite</li>
<li><b>Coverage</b>: ≥80% line coverage for core decoder and serial handling functions</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md587"></a>
Key Entities <em>(include if feature involves data)</em></h2>
<ul>
<li><b>TelemetryFrame</b>: A structured representation of SCP telemetry values (timestamp, CPU load/temp, battery, IMU, GPS fix).</li>
<li><b>SerialSession</b>: A connection context including port, baud, buffers, and state for recoveries.</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md588"></a>
Success Criteria <em>(mandatory)</em></h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md589"></a>
Measurable Outcomes</h2>
<ul>
<li><b>SC-001</b>: Operators can connect to a serial device and see first telemetry within 2 seconds.</li>
<li><b>SC-002</b>: Live display refresh meets p95 ≤ 200 ms during sustained telemetry at 115200 baud.</li>
<li><b>SC-003</b>: The tool handles a simulated disconnect and recovers or exits cleanly with actionable guidance 100% of attempts in test.</li>
<li><b>SC-004</b>: A simplified SCP telemetry frame is correctly decoded with 100% field accuracy against a known-good sample.</li>
<li><b>SC-005</b>: Optional logging produces a CSV file with timestamped entries for ≥ 10 minutes without data loss.</li>
<li><b>SC-006</b>: Build system produces clean compilation on Linux and macOS with zero warnings.</li>
<li><b>SC-007</b>: Static analysis passes with zero high/critical findings on all source files.</li>
<li><b>SC-008</b>: Memory safety validation passes under Valgrind/AddressSanitizer for all test scenarios. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on <span class="timestamp"></span> for ACP - Autonomous Command Protocol by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.15.0 </li>
  </ul>
</div>
</body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.15.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ACP - Autonomous Command Protocol: Research Plan Templates and Schemas Documentation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">ACP - Autonomous Command Protocol<span id="projectnumber">&#160;v0.3.0</span>
   </div>
   <div id="projectbrief">Portable C99 framing library with COBS, CRC16, and HMAC-SHA256 authentication</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.15.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('md__2_users_2paulzanna_2_github_2_eunice_2docs_2_workflows_2_research_01_plan_01_templates_01and_01_schemas.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Research Plan Templates and Schemas Documentation </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md2280"></a></p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md2281"></a>
Overview</h1>
<p>This document describes the location, structure, and usage of templates and schemas for research plans in the Eunice research management system. The system uses multiple layers of templates and schemas to ensure consistent and comprehensive research plan generation.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md2282"></a>
📋 Schema Definitions</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md2283"></a>
1. Plan Brief v1 Schema</h2>
<p><b>Location</b>: <span class="tt">/api-gateway/config/plan_brief_v1.schema.json</span></p>
<p><b>Purpose</b>: Defines the JSON schema for the PlanBrief v1 format used by the API Gateway for research plan validation and structure.</p>
<p><b>Required Fields</b>:</p>
<ul>
<li><span class="tt">sources</span> - Array of research data sources (databases, repositories, etc.)</li>
<li><span class="tt">outcomes</span> - Array of expected deliverables and research outputs</li>
<li><span class="tt">timeline</span> - Object containing phases and total duration</li>
<li><span class="tt">key_areas</span> - Array of main research focus areas</li>
<li><span class="tt">questions</span> - Array of specific research questions to investigate</li>
<li><span class="tt">objectives</span> - Array of clear, measurable research goals</li>
</ul>
<p><b>Optional Fields</b>:</p>
<ul>
<li><span class="tt">title</span> - Research plan title</li>
<li><span class="tt">primary_question</span> - Main research question</li>
<li><span class="tt">methodology_text</span> - Detailed methodology description</li>
<li><span class="tt">constraints</span> - Research limitations and constraints</li>
<li><span class="tt">risk_factors</span> - Potential risks and mitigation strategies</li>
<li><span class="tt">assumptions</span> - Research assumptions and prerequisites</li>
<li><span class="tt">environment</span> - Environmental and technical requirements</li>
<li><span class="tt">metrics</span> - Success metrics and evaluation criteria</li>
<li><span class="tt">cost_estimates</span> - Budget breakdown and cost projections</li>
<li><span class="tt">expected_impact</span> - Anticipated research impact and applications</li>
<li><span class="tt">agent_config</span> - AI agent configuration for plan execution</li>
</ul>
<p><b>Timeline Structure</b>:</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  &quot;timeline&quot;: {</div>
<div class="line">    &quot;phases&quot;: {</div>
<div class="line">      &quot;Phase Name&quot;: &quot;&lt;days_integer&gt;&quot;,</div>
<div class="line">      &quot;Another Phase&quot;: &quot;&lt;days_integer&gt;&quot;</div>
<div class="line">    },</div>
<div class="line">    &quot;total_days&quot;: &quot;&lt;total_duration_integer&gt;&quot;</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="autotoc_md2284"></a>
2. Database Resource Schema</h2>
<p><b>Location</b>: <span class="tt">/database/schemas/resources/research_plan.resource.json</span></p>
<p><b>Purpose</b>: Database-level schema for storing research plan entities in the PostgreSQL database.</p>
<p><b>Structure</b>:</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  &quot;id&quot;: &quot;UUID&quot;,</div>
<div class="line">  &quot;topic_id&quot;: &quot;UUID&quot;, </div>
<div class="line">  &quot;objectives&quot;: [&quot;string&quot;],</div>
<div class="line">  &quot;status&quot;: &quot;draft|active|complete&quot;</div>
<div class="line">}</div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="autotoc_md2285"></a>
🤖 Prompt Templates</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md2286"></a>
1. API Gateway AI Generation (Current Implementation)</h2>
<p><b>Location</b>: <span class="tt">/api-gateway/src/v2_hierarchical_api.py</span> (inline)</p>
<p><b>Purpose</b>: Direct AI model prompting for immediate research plan generation via the <span class="tt">/topics/{topic_id}/ai-plans</span> endpoint (legacy: <span class="tt">/v2/...</span>).</p>
<p><b>Model</b>: OpenAI GPT-4 <b>Temperature</b>: 0.4 (configurable) <b>Max Tokens</b>: 3000</p>
<p><b>System Prompt Structure</b>:</p>
<div class="fragment"><div class="line">You are an expert research planning assistant. Generate a comprehensive, detailed research plan in JSON format.</div>
<div class="line"> </div>
<div class="line">CRITICAL REQUIREMENTS:</div>
<div class="line">1. Return ONLY valid JSON - no markdown fences, no explanations, no commentary</div>
<div class="line">2. The JSON must match this exact schema: {schema_structure}</div>
<div class="line">3. Provide 5-8 specific, actionable objectives</div>
<div class="line">4. Include 6-10 detailed research questions</div>
<div class="line">5. List 6-8 key research areas specific to the topic</div>
<div class="line">6. Create realistic timeline with 4-6 phases</div>
<div class="line">7. Suggest 5-8 relevant academic databases/sources</div>
<div class="line">8. Define 4-6 concrete deliverable outcomes</div>
<div class="line"> </div>
<div class="line">Make the plan comprehensive, specific, and actionable for the given research topic.</div>
</div><!-- fragment --><p><b>User Prompt Template</b>:</p>
<div class="fragment"><div class="line">Research Topic: {plan_request.name}</div>
<div class="line">Description: {plan_request.description}</div>
<div class="line">Topic Details: {existing_topic.description}</div>
<div class="line">Plan Type: {plan_request.plan_type}</div>
<div class="line"> </div>
<div class="line">Generate a detailed research plan that:</div>
<div class="line">- Addresses the specific research topic comprehensively</div>
<div class="line">- Includes methodology-specific research questions</div>
<div class="line">- Proposes realistic timelines and milestones</div>
<div class="line">- Identifies relevant data sources and databases</div>
<div class="line">- Defines clear, measurable outcomes</div>
<div class="line">- Considers ethical and practical constraints</div>
<div class="line"> </div>
<div class="line">Return only the JSON object matching the required schema.</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="autotoc_md2287"></a>
2. Research Manager Template</h2>
<p><b>Location</b>: <span class="tt">/research-manager/prompts/create_research_plan.json</span></p>
<p><b>Purpose</b>: Background research plan generation for the Research Manager service using the prompt registry system.</p>
<p><b>Generated By</b>: <span class="tt">/research-manager/prompt_create_functions/create_research_plan.py</span></p>
<p><b>Configuration</b>:</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  &quot;id&quot;: &quot;create_research_plan&quot;,</div>
<div class="line">  &quot;description&quot;: &quot;Generate a PlanBrief v1 research plan&quot;,</div>
<div class="line">  &quot;agent_type&quot;: &quot;ai_service&quot;,</div>
<div class="line">  &quot;model&quot;: &quot;gpt-4&quot;,</div>
<div class="line">  &quot;system_prompt&quot;: &quot;You are a research planning assistant. Output ONLY valid PlanBrief v1 JSON. No markdown, no commentary, no code fences.&quot;,</div>
<div class="line">  &quot;user_prompt_template&quot;: &quot;Title: {topic_title}\nDescription: {topic_description}\n\nReturn ONLY a JSON object with exactly these required fields: sources[], outcomes[], timeline{phases{phase:days}, total_days}, key_areas[], questions[], objectives[]. Arrays must not be empty. timeline.phases keys are short phase labels. No extra top-level keys.&quot;,</div>
<div class="line">  &quot;max_tokens&quot;: 3000,</div>
<div class="line">  &quot;temperature&quot;: 0.4</div>
<div class="line">}</div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="autotoc_md2288"></a>
⚙️ Configuration Management</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md2289"></a>
1. Prompt Registry</h2>
<p><b>Location</b>: <span class="tt">/research-manager/src/prompt_registry.py</span></p>
<p><b>Features</b>:</p>
<ul>
<li><b>Hot-reload</b>: Automatically reloads templates when files change</li>
<li><b>Caching</b>: In-memory caching with mtime invalidation</li>
<li><b>TTL</b>: Configurable cache timeout (default: 60 seconds)</li>
<li><b>Thread-safe</b>: Uses threading locks for concurrent access</li>
</ul>
<p><b>Environment Variables</b>:</p>
<ul>
<li><span class="tt">PROMPTS_DIR</span> - Directory containing prompt templates (default: "research-manager/prompts")</li>
<li><span class="tt">PROMPTS_CACHE_TTL_SECONDS</span> - Cache timeout in seconds (default: 60)</li>
<li><span class="tt">PROMPTS_HOTRELOAD</span> - Enable/disable hot-reload (default: "true")</li>
</ul>
<p><b>Usage</b>:</p>
<div class="fragment"><div class="line"><span class="keyword">from</span> prompt_registry <span class="keyword">import</span> get_registry</div>
<div class="line"> </div>
<div class="line">registry = get_registry()</div>
<div class="line">prompt_config = registry.get(<span class="stringliteral">&quot;create_research_plan&quot;</span>)</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="autotoc_md2290"></a>
2. Schema Validation</h2>
<p><b>Location</b>: <span class="tt">/api-gateway/src/v2_hierarchical_api.py</span></p>
<p><b>Validation Process</b>:</p>
<ol type="1">
<li>AI generates JSON response</li>
<li>Extract JSON from response (handle markdown fences)</li>
<li>Validate required fields exist (<span class="tt">title</span>, <span class="tt">objectives</span>, <span class="tt">key_areas</span>, <span class="tt">questions</span>)</li>
<li>Check minimum content requirements (3+ objectives, 3+ questions)</li>
<li>Optional: JSON Schema validation using <span class="tt">fastjsonschema</span></li>
</ol>
<h1 class="doxsection"><a class="anchor" id="autotoc_md2291"></a>
🔄 Template Usage Flow</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md2292"></a>
API Gateway Direct Generation</h2>
<div class="fragment"><div class="line">User Request → v2_hierarchical_api.py</div>
<div class="line">             ↓</div>
<div class="line">          Built-in prompts → AI Model (GPT-4)</div>
<div class="line">             ↓</div>
<div class="line">          JSON Response → Schema Validation</div>
<div class="line">             ↓</div>
<div class="line">          Database Storage → plan_structure field</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="autotoc_md2293"></a>
Research Manager Background Processing</h2>
<div class="fragment"><div class="line">Enqueue Job → Research Manager</div>
<div class="line">             ↓</div>
<div class="line">          Prompt Registry → Load Template</div>
<div class="line">             ↓</div>
<div class="line">          AI Model Generation → PlanBrief v1</div>
<div class="line">             ↓</div>
<div class="line">          Database Storage → Complete Plan Record</div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="autotoc_md2294"></a>
📊 Generated Plan Quality Metrics</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md2295"></a>
Current API Gateway Implementation Results</h2>
<ul>
<li><b>Objectives</b>: 8+ detailed, specific goals</li>
<li><b>Research Questions</b>: 10+ comprehensive questions</li>
<li><b>Key Areas</b>: 6-8 focused research domains</li>
<li><b>Timeline</b>: Realistic multi-phase approach (150-200 days typical)</li>
<li><b>Sources</b>: 7-8 relevant academic databases and repositories</li>
<li><b>Outcomes</b>: 6+ concrete deliverables</li>
<li><b>Cost Tracking</b>: Token usage and generation costs ($0.50-0.60 typical)</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md2296"></a>
Example Generated Content Quality</h2>
<p>For "AI for Medical Diagnosis" topic:</p>
<ul>
<li>✅ 8 specific objectives including effectiveness analysis</li>
<li>✅ 10 detailed questions covering ethics, implementation, accuracy</li>
<li>✅ 6 focused areas like "Current Applications" and "Ethical Considerations"</li>
<li>✅ 5-phase timeline with realistic duration estimates</li>
<li>✅ 8 relevant sources including PubMed, IEEE Xplore</li>
<li>✅ 6 concrete outcomes including framework and reports</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md2297"></a>
🔧 Configuration Options</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md2298"></a>
AI Model Parameters</h2>
<ul>
<li><b>Provider</b>: OpenAI (configurable: openai, anthropic, xai)</li>
<li><b>Model</b>: gpt-4 (configurable via metadata)</li>
<li><b>Temperature</b>: 0.4 (configurable via metadata, range: 0-2)</li>
<li><b>Max Tokens</b>: 3000 (sufficient for comprehensive plans)</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md2299"></a>
Metadata Configuration</h2>
<div class="fragment"><div class="line">{</div>
<div class="line">  &quot;ai_provider&quot;: &quot;openai&quot;,</div>
<div class="line">  &quot;ai_model&quot;: &quot;gpt-4&quot;, </div>
<div class="line">  &quot;temperature&quot;: 0.4</div>
<div class="line">}</div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="autotoc_md2300"></a>
🛠️ Development and Testing</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md2301"></a>
Schema Validation Testing</h2>
<ul>
<li>Location: <span class="tt">/api-gateway/tests/test_plan_brief_v1.py</span></li>
<li>Tests: Round-trip validation, update workflows, validation failures</li>
<li>Coverage: Create, read, update operations with PlanBrief v1 format</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md2302"></a>
Integration Testing</h2>
<ul>
<li>Location: <span class="tt">/api-gateway/tests/test_single_plan_per_topic.py</span></li>
<li>Validates: One plan per topic enforcement</li>
<li>Ensures: Proper conflict handling for duplicate plan creation</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md2303"></a>
🔍 Troubleshooting</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md2304"></a>
Common Issues</h2>
<ol type="1">
<li><b>Empty AI Response</b>: Check API keys in environment variables</li>
<li><b>Schema Validation Failure</b>: Ensure AI response contains required fields</li>
<li><b>Prompt Registry Issues</b>: Verify PROMPTS_DIR path and file permissions</li>
<li><b>Cost Calculation Errors</b>: Check token usage extraction from AI response</li>
</ol>
<h2 class="doxsection"><a class="anchor" id="autotoc_md2305"></a>
Debug Logging</h2>
<ul>
<li>AI response structure logging available in development mode</li>
<li>Prompt registry includes file watching and cache invalidation logs</li>
<li>Schema validation errors include specific missing field information</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md2306"></a>
📝 Future Enhancements</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md2307"></a>
Planned Improvements</h2>
<ol type="1">
<li><b>Schema Evolution</b>: Support for multiple schema versions</li>
<li><b>Template Versioning</b>: Version-controlled prompt templates</li>
<li><b>A/B Testing</b>: Multiple prompt variants for optimization</li>
<li><b>Custom Schemas</b>: User-defined research plan structures</li>
<li><b>Template Editor</b>: Web-based template management interface</li>
</ol>
<hr  />
<p><em>Last Updated: August 11, 2025</em> <em>Version: 1.0</em> <em>Author: System Documentation</em> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on <span class="timestamp"></span> for ACP - Autonomous Command Protocol by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.15.0 </li>
  </ul>
</div>
</body>
</html>

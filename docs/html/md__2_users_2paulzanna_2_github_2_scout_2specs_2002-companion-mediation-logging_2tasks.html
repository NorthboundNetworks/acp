<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.15.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ACP - Autonomous Command Protocol: tasks</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">ACP - Autonomous Command Protocol<span id="projectnumber">&#160;v0.3.0</span>
   </div>
   <div id="projectbrief">Portable C99 framing library with COBS, CRC16, and HMAC-SHA256 authentication</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.15.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('md__2_users_2paulzanna_2_github_2_scout_2specs_2002-companion-mediation-logging_2tasks.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">tasks </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2 class="doxsection"><a class="anchor" id="autotoc_md8709"></a>
autotoc_md8709</h2>
<h2 class="doxsection"><a class="anchor" id="autotoc_md8710"></a>
description: "Executable task list for Companion Mediation, Blackbox Logging, and Gimbal Control"</h2>
<h1 class="doxsection"><a class="anchor" id="autotoc_md8711"></a>
Tasks: Companion Mediation, Blackbox Logging, and Gimbal Control</h1>
<p><b>Input</b>: Design documents from <span class="tt">/specs/002-companion-mediation-logging/</span> <br  />
 <b>Prerequisites</b>: plan.md (required), spec.md (required), research.md, data-model.md, contracts/</p>
<p><b>Tests</b>: Golden CLI transcripts and telemetry burst evidence are required by the Constitution (observability/testability). Parser-like logic (NDJSON replay) should have deterministic outputs captured via transcripts. Hardware-dependent tests use manual acceptance steps from quickstart.md.</p>
<p><b>Organization</b>: Tasks are grouped by user story to enable independent implementation and testing of each story.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md8712"></a>
Format: <span class="tt">[ID] [P?] [Story] Description</span></h2>
<ul>
<li>[P]: Can run in parallel (different files, no dependencies)</li>
<li>[Story]: Which user story this task belongs to (US1, US2, US3)</li>
<li>Include exact file paths in descriptions</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md8713"></a>
Phase 1: Setup (Shared Infrastructure)</h2>
<p><b>Purpose</b>: Repo scaffolding and base wiring per implementation plan</p>
<ul class="check">
<li class="checked">T001 Update implementation plan structure path to <span class="tt">specs/002-...</span> in specs/002-companion-mediation-logging/plan.md</li>
</ul>
<ul class="check">
<li class="checked">T002 Create service modules directories per plan in src/services/ and src/telemetry/</li>
</ul>
<ul class="check">
<li class="checked">T003 [P] Add feature compile-time flag(s) in src/main.c (e.g., <span class="tt">FEATURE_COMPANION_Mediation</span>, <span class="tt">FEATURE_BLACKBOX</span>, <span class="tt">FEATURE_GIMBAL</span>)</li>
</ul>
<ul class="check">
<li class="checked">T004 [P] Create header for shared constants in <a class="el" href="feature__config_8h_source.html">src/lib/feature_config.h</a> (e.g., <span class="tt">SCHEMA_VERSION</span>, telemetry limits)</li>
</ul>
<ul class="check">
<li class="checked">T005 [P] Add NDJSON schema version constant and event type enums in <a class="el" href="blackbox__defs_8h_source.html">src/lib/blackbox_defs.h</a></li>
</ul>
<hr  />
<h2 class="doxsection"><a class="anchor" id="autotoc_md8715"></a>
Phase 2: Foundational (Blocking Prerequisites)</h2>
<p><b>Purpose</b>: Core infrastructure that MUST be complete before ANY user story can be implemented</p>
<ul class="check">
<li class="checked">T006 Initialize FATFS mount check and mission logs directory creation in <a class="el" href="src_2services_2blackbox_8c.html" title="Mission blackbox logging service implementation.">src/services/blackbox.c</a></li>
</ul>
<ul class="check">
<li class="checked">T007 [P] Implement bounded ring buffer queue for events in <a class="el" href="ringbuf_8c_source.html">src/lib/ringbuf.c</a> and <a class="el" href="src_2lib_2_ring_buf_8h_source.html">src/lib/ringbuf.h</a></li>
</ul>
<ul class="check">
<li class="checked">T008 [P] Create background writer task skeleton in <a class="el" href="src_2services_2blackbox_8c.html" title="Mission blackbox logging service implementation.">src/services/blackbox.c</a> (no-op write impl yet)</li>
</ul>
<ul class="check">
<li class="checked">T009 [P] Create MAVLink bridge skeleton in src/telemetry/mavlink_bridge.c and src/telemetry/mavlink_bridge.h</li>
</ul>
<ul class="check">
<li class="checked">T010 Wire service/task init from app startup in src/main.c (start writer task, init MAVLink bridge)</li>
</ul>
<ul class="check">
<li class="checked">T011 Setup NVS namespace and helpers for HMAC key label/value in <a class="el" href="hmac__kv_8c_source.html">src/lib/hmac_kv.c</a> and <a class="el" href="hmac__kv_8h_source.html">src/lib/hmac_kv.h</a></li>
</ul>
<ul class="check">
<li class="checked">T012 [P] Implement HMAC-SHA256 utility (wrapper around ESP-IDF mbedTLS) in <a class="el" href="hmac_8c_source.html">src/lib/hmac.c</a> and <a class="el" href="hmac_8h_source.html">src/lib/hmac.h</a></li>
</ul>
<ul class="check">
<li class="checked">T013 Create CLI module folder and registration entry points in src/cli/cli_init.c and src/cli/cli_init.h</li>
</ul>
<ul class="check">
<li class="checked">T014 Add documentation markers for golden transcripts structure in tests/contract/README.md</li>
</ul>
<p><b>Checkpoint</b>: Foundation ready - user story implementation can now begin in parallel</p>
<hr  />
<h2 class="doxsection"><a class="anchor" id="autotoc_md8717"></a>
Phase 3: User Story 1 - Companion Commands Are Always Safety-Gated (Priority: P1) ðŸŽ¯ MVP</h2>
<p><b>Goal</b>: Mediate all companion inputs via safety gates; log decisions; operator-visible audit; telemetry summaries with rate limiting.</p>
<p><b>Independent Test</b>: Inject companion inputs; verify vehicle behavior conforms to decisions; audit visible within 1s; summaries rate-limited.</p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md8718"></a>
Implementation for User Story 1</h3>
<ul class="check">
<li class="checked">T015 [P] [US1] Implement companion input gateway and source whitelist in <a class="el" href="audit_8c.html" title="Companion input mediation and audit trail service.">src/services/audit.c</a> and <a class="el" href="audit_8h_source.html">src/services/audit.h</a></li>
</ul>
<ul class="check">
<li class="checked">T016 [P] [US1] Implement classification (command/suggestion) and parse summary in <a class="el" href="audit_8c.html" title="Companion input mediation and audit trail service.">src/services/audit.c</a></li>
</ul>
<ul class="check">
<li class="checked">T017 [US1] Implement safety evaluation (arming/mode/geofence/alt/slew/failsafe/lockouts) in <a class="el" href="audit_8c.html" title="Companion input mediation and audit trail service.">src/services/audit.c</a></li>
</ul>
<ul class="check">
<li class="checked">T018 [US1] Produce audit events into ring buffer (CompanionInput + SafetyEvaluation) in <a class="el" href="audit_8c.html" title="Companion input mediation and audit trail service.">src/services/audit.c</a></li>
</ul>
<ul class="check">
<li class="checked">T019 [P] [US1] Implement telemetry audit summary coalescer (500 ms windows) and 2 msg/s limiter in src/telemetry/mavlink_bridge.c</li>
</ul>
<ul class="check">
<li class="checked">T020 [US1] Emit STATUSTEXT for rejections and arming/mode changes in src/telemetry/mavlink_bridge.c</li>
</ul>
<ul class="check">
<li class="checked">T021 [P] [US1] Implement CLI <span class="tt">audit show [--recent N]</span> in <a class="el" href="cli__audit_8c_source.html">src/cli/cli_audit.c</a></li>
</ul>
<ul class="check">
<li class="checked">T022 [US1] Wire audit CLI into registration in src/cli/cli_init.c</li>
</ul>
<ul class="check">
<li class="checked">T023 [US1] Update src/main.c to pass companion messages through audit gateway (no direct actuation paths remain)</li>
</ul>
<h3 class="doxsection"><a class="anchor" id="autotoc_md8719"></a>
Evidence (US1)</h3>
<ul class="check">
<li class="checked">T024 [US1] Record golden CLI transcript for <span class="tt">audit show</span> in tests/contract/audit_show.txt</li>
</ul>
<ul class="check">
<li class="checked">T025 [US1] Capture telemetry burst test output (â‰¥20 events/s; expect â‰¤2 msgs/s) in tests/contract/telemetry_burst.txt</li>
</ul>
<p><b>Checkpoint</b>: US1 independently demoable (blocked commands rejected; summaries visible; logs created)</p>
<hr  />
<h2 class="doxsection"><a class="anchor" id="autotoc_md8721"></a>
Phase 4: User Story 2 - Field Blackbox Logging &amp; Post-Flight Mission Replay (Priority: P2)</h2>
<p><b>Goal</b>: Per-flight NDJSON logs; listing; replay timeline; export with HMAC; keep-last-1 rotation.</p>
<p><b>Independent Test</b>: Run short bench mission; list/replay/export; validate NDJSON schema; verify HMAC.</p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md8722"></a>
Implementation for User Story 2</h3>
<ul class="check">
<li class="checked">T026 [P] [US2] Implement event serialization to NDJSON (ts, type, attrs, schema_version) in <a class="el" href="src_2services_2blackbox_8c.html" title="Mission blackbox logging service implementation.">src/services/blackbox.c</a></li>
</ul>
<ul class="check">
<li class="checked">T027 [US2] Implement periodic sensor summaries (2s) and enqueue in <a class="el" href="src_2services_2blackbox_8c.html" title="Mission blackbox logging service implementation.">src/services/blackbox.c</a></li>
</ul>
<ul class="check">
<li class="checked">T028 [P] [US2] Implement rotation policy (keep-last-1) on mission start/stop in <a class="el" href="src_2services_2blackbox_8c.html" title="Mission blackbox logging service implementation.">src/services/blackbox.c</a></li>
</ul>
<ul class="check">
<li class="checked">T029 [US2] Implement <span class="tt">mission list</span> CLI in <a class="el" href="cli__mission_8c_source.html">src/cli/cli_mission.c</a></li>
</ul>
<ul class="check">
<li class="checked">T030 [US2] Implement NDJSON replay reader and <span class="tt">mission replay &lt;id&gt; [--summary]</span> in <a class="el" href="cli__mission_8c_source.html">src/cli/cli_mission.c</a></li>
</ul>
<ul class="check">
<li class="checked">T031 [P] [US2] Implement <span class="tt">mission export &lt;id&gt;</span> streaming and footer metadata {algo, keyLabel, signature} in <a class="el" href="cli__mission_8c_source.html">src/cli/cli_mission.c</a></li>
</ul>
<ul class="check">
<li class="checked">T032 [US2] Integrate HMAC signing using <a class="el" href="hmac_8c_source.html">src/lib/hmac.c</a> and key from <a class="el" href="hmac__kv_8c_source.html">src/lib/hmac_kv.c</a></li>
</ul>
<ul class="check">
<li class="checked">T033 [P] [US2] Implement <span class="tt">hmac set KEY_LABEL HEX_KEY</span> and <span class="tt">hmac show</span> in src/cli/cli_hmac.c</li>
</ul>
<ul class="check">
<li class="checked">T034 [US2] Handle corrupted/partial logs defensively in list/replay/export paths in <a class="el" href="cli__mission_8c_source.html">src/cli/cli_mission.c</a></li>
</ul>
<h3 class="doxsection"><a class="anchor" id="autotoc_md8723"></a>
Evidence (US2)</h3>
<ul class="check">
<li class="checked">T035 [US2] Record golden transcript for <span class="tt">mission list</span> in tests/contract/mission_list.txt</li>
</ul>
<ul class="check">
<li class="checked">T036 [US2] Record golden transcript for <span class="tt">mission replay --summary</span> in tests/contract/mission_replay_summary.txt</li>
</ul>
<ul class="check">
<li class="checked">T037 [US2] Record export and external HMAC verification steps in tests/contract/mission_export_verify.txt</li>
</ul>
<p><b>Checkpoint</b>: US2 independently demoable (list/replay/export works without US3)</p>
<hr  />
<h2 class="doxsection"><a class="anchor" id="autotoc_md8725"></a>
Phase 5: User Story 3 - Basic Gimbal &amp; Camera Coordination (Priority: P3)</h2>
<p><b>Goal</b>: Fixed, follow-heading, and search-sweep modes via CLI/MAVLink; status feedback.</p>
<p><b>Independent Test</b>: Bench checks for each mode; verify angles, latency, and sweep.</p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md8726"></a>
Implementation for User Story 3</h3>
<ul class="check">
<li class="checked">T038 [P] [US3] Implement gimbal service with modes {fixed, follow_heading, search_sweep} in <a class="el" href="gimbal_8c.html" title="Two-axis gimbal control service implementation.">src/services/gimbal.c</a> and <a class="el" href="gimbal_8h_source.html">src/services/gimbal.h</a></li>
</ul>
<ul class="check">
<li class="checked">T039 [US3] Implement default sweep (Â±135Â°, 10Â°/s) with bounds/rate config in <a class="el" href="gimbal_8c.html" title="Two-axis gimbal control service implementation.">src/services/gimbal.c</a></li>
</ul>
<ul class="check">
<li class="checked">T040 [P] [US3] Map CLI <span class="tt">gimbal mode/set/sweep/status</span> in <a class="el" href="cli__gimbal_8c_source.html">src/cli/cli_gimbal.c</a></li>
</ul>
<ul class="check">
<li class="checked">T041 [US3] Integrate MAV_CMD_DO_MOUNT_CONTROL in <a class="el" href="cmd__mount__control_8c_source.html">src/telemetry/cmd_mount_control.c</a></li>
</ul>
<ul class="check">
<li class="checked">T042 [US3] Report gimbal status updates (angles, mode, faults) in <a class="el" href="gimbal_8c.html" title="Two-axis gimbal control service implementation.">src/services/gimbal.c</a></li>
</ul>
<h3 class="doxsection"><a class="anchor" id="autotoc_md8727"></a>
Evidence (US3)</h3>
<ul class="check">
<li class="checked">T043 [US3] Record golden transcript for gimbal CLI in tests/contract/gimbal_cli.txt</li>
</ul>
<ul class="check">
<li class="checked">T044 [US3] Capture bench measurements for SC-006 (latency, angle errors) in tests/contract/gimbal_bench_notes.txt</li>
</ul>
<p><b>Checkpoint</b>: US3 independently demoable (gimbal control functional)</p>
<hr  />
<h2 class="doxsection"><a class="anchor" id="autotoc_md8729"></a>
Phase 6: Integration &amp; Validation (COMPLETED)</h2>
<p><b>Goal</b>: Validate all user stories working together end-to-end with comprehensive integration testing.</p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md8730"></a>
Integration Testing</h3>
<ul class="check">
<li class="checked">T045 [Integration] Create comprehensive end-to-end integration test suite in test_integration_complete.py</li>
</ul>
<ul class="check">
<li class="checked">T046 [Integration] Validate User Story 1 (companion mediation &amp; audit trail) end-to-end</li>
</ul>
<ul class="check">
<li class="checked">T047 [Integration] Validate User Story 2 (blackbox logging &amp; mission replay) end-to-end <br  />
</li>
</ul>
<ul class="check">
<li class="checked">T048 [Integration] Validate User Story 3 (gimbal control &amp; MAVLink integration) end-to-end</li>
</ul>
<ul class="check">
<li class="checked">T049 [Integration] Test integrated workflows (blackbox + gimbal, system health during multi-service operation)</li>
</ul>
<ul class="check">
<li class="checked">T050 [Integration] Create integration test validation documentation in docs/integration_test_validation.md</li>
</ul>
<p><b>Checkpoint</b>: ALL USER STORIES VALIDATED - Complete system integration confirmed</p>
<hr  />
<h2 class="doxsection"><a class="anchor" id="autotoc_md8732"></a>
Phase N: Polish &amp; Cross-Cutting Concerns</h2>
<ul class="check">
<li class="checked">T051 [P] Update docs: specs/002-companion-mediation-logging/contracts/cli.md and mavlink.md</li>
</ul>
<ul class="check">
<li class="checked">T052 [P] Update docs: specs/002-companion-mediation-logging/quickstart.md with final commands/examples</li>
</ul>
<ul class="check">
<li class="checked">T053 Refine rate limits and queue sizes based on <span class="tt">stats</span>/<span class="tt">status</span> measurements in <a class="el" href="feature__config_8h_source.html">src/lib/feature_config.h</a></li>
</ul>
<ul class="check">
<li class="checked">T054 Performance validation evidence (CPU &lt;70%, loop timing) in tests/contract/perf_snapshots.txt</li>
</ul>
<ul class="check">
<li class="checked">T055 Security review of HMAC key handling and unauthorized-source logs in <a class="el" href="hmac__kv_8c_source.html">src/lib/hmac_kv.c</a> and <a class="el" href="audit_8c.html" title="Companion input mediation and audit trail service.">src/services/audit.c</a></li>
</ul>
<ul class="check">
<li class="checked">T056 Code cleanup and comments across new modules in src/services/ and src/telemetry/</li>
</ul>
<hr  />
<h2 class="doxsection"><a class="anchor" id="autotoc_md8734"></a>
Dependencies &amp; Execution Order</h2>
<h3 class="doxsection"><a class="anchor" id="autotoc_md8735"></a>
Phase Dependencies</h3>
<ul>
<li>Setup (Phase 1): none</li>
<li>Foundational (Phase 2): depends on Setup; BLOCKS all user stories</li>
<li>US1 (Phase 3): depends on Foundational</li>
<li>US2 (Phase 4): depends on Foundational; independent of US1 (can run in parallel)</li>
<li>US3 (Phase 5): depends on Foundational; independent of US1/US2 (can run in parallel)</li>
<li>Polish: after desired stories are complete</li>
</ul>
<h3 class="doxsection"><a class="anchor" id="autotoc_md8736"></a>
User Story Dependencies</h3>
<ul>
<li>US1: none (after Phase 2)</li>
<li>US2: none (after Phase 2); may read gimbal events if present but not required</li>
<li>US3: none (after Phase 2)</li>
</ul>
<h3 class="doxsection"><a class="anchor" id="autotoc_md8737"></a>
Parallel Opportunities</h3>
<ul>
<li>[P] tasks across different files within a phase can proceed concurrently</li>
<li>After Phase 2, teams can split by story: US1, US2, and US3 in parallel</li>
<li>Within stories, [P] tasks (e.g., CLI vs service code in different files) can run parallel</li>
</ul>
<hr  />
<h2 class="doxsection"><a class="anchor" id="autotoc_md8739"></a>
Implementation Strategy</h2>
<h3 class="doxsection"><a class="anchor" id="autotoc_md8740"></a>
MVP First (US1)</h3>
<p>1) Complete Phases 1â€“2 <br  />
 2) Implement US1 (audit + summaries + CLI) <br  />
 3) Validate with golden transcripts and telemetry burst <br  />
 4) Demo (reject unsafe commands; audit visibility)</p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md8741"></a>
Incremental Delivery</h3>
<ul>
<li>Add US2: logging + replay + export (HMAC) <br  />
</li>
<li>Add US3: gimbal modes + status <br  />
</li>
<li>Polish: performance, docs, security review</li>
</ul>
<hr  />
<h2 class="doxsection"><a class="anchor" id="autotoc_md8743"></a>
Format validation</h2>
<ul>
<li>All tasks follow <span class="tt">- [ ] T### [P?] [US?] Description with file path</span> <br  />
</li>
<li>Story labels used only in story phases (US1/US2/US3) <br  />
</li>
<li>Parallel markers [P] used only when safe (different files, no direct dependency) </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on <span class="timestamp"></span> for ACP - Autonomous Command Protocol by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.15.0 </li>
  </ul>
</div>
</body>
</html>

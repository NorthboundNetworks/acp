<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.15.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ACP - Autonomous Command Protocol: Citadel Core CLI - API Documentation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">ACP - Autonomous Command Protocol<span id="projectnumber">&#160;v0.3.0</span>
   </div>
   <div id="projectbrief">Portable C99 framing library with COBS, CRC16, and HMAC-SHA256 authentication</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.15.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('md__2_users_2paulzanna_2_github_2_citadel_2docs_2_a_p_i.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Citadel Core CLI - API Documentation </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md249"></a></p>
<p><b>Version</b>: 0.1.0 <br  />
 <b>Date</b>: 2025-10-26 <br  />
 <b>Language</b>: C11 (ANSI C)</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md250"></a>
Overview</h1>
<p>This document provides comprehensive API documentation for the Citadel Core CLI components. The CLI is designed as a modular system with clear interfaces between components.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md251"></a>
Core Modules</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md252"></a>
1. Serial Communication (<span class="tt">serial.h</span>)</h2>
<p>Cross-platform serial port interface for drone communication.</p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md253"></a>
Data Structures</h3>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line">    <span class="keywordtype">int</span> fd;                    <span class="comment">/* File descriptor (Unix) or HANDLE (Windows) */</span></div>
<div class="line">    <span class="keywordtype">char</span> port_name[256];       <span class="comment">/* Port device name */</span></div>
<div class="line">    uint32_t baud_rate;        <span class="comment">/* Communication baud rate */</span></div>
<div class="line">    <span class="keywordtype">bool</span> is_open;              <span class="comment">/* Connection status */</span></div>
<div class="line">    <span class="keyword">struct </span>termios old_config; <span class="comment">/* Saved port configuration (Unix) */</span></div>
<div class="line">} serial_port_t;</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="autotoc_md254"></a>
Core Functions</h3>
<div class="fragment"><div class="line"></div>
<div class="line"><span class="keywordtype">int</span> serial_init(serial_port_t *port, <span class="keyword">const</span> <span class="keywordtype">char</span> *device_name, uint32_t baud_rate);</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> serial_open(serial_port_t *port);</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> serial_read(serial_port_t *port, uint8_t *buffer, <span class="keywordtype">size_t</span> size);</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> serial_write(serial_port_t *port, <span class="keyword">const</span> uint8_t *data, <span class="keywordtype">size_t</span> size);</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> serial_close(serial_port_t *port);</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="autotoc_md255"></a>
Error Codes</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Code  </th><th class="markdownTableHeadNone">Constant  </th><th class="markdownTableHeadNone">Description  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">-1  </td><td class="markdownTableBodyNone"><span class="tt">SERIAL_ERR_INVALID_PARAM</span>  </td><td class="markdownTableBodyNone">Invalid parameter  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">-2  </td><td class="markdownTableBodyNone"><span class="tt">SERIAL_ERR_OPEN_FAILED</span>  </td><td class="markdownTableBodyNone">Failed to open device  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">-3  </td><td class="markdownTableBodyNone"><span class="tt">SERIAL_ERR_CONFIG_FAILED</span>  </td><td class="markdownTableBodyNone">Configuration error  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">-4  </td><td class="markdownTableBodyNone"><span class="tt">SERIAL_ERR_READ_FAILED</span>  </td><td class="markdownTableBodyNone">Read operation failed  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">-5  </td><td class="markdownTableBodyNone"><span class="tt">SERIAL_ERR_WRITE_FAILED</span>  </td><td class="markdownTableBodyNone">Write operation failed  </td></tr>
</table>
<h2 class="doxsection"><a class="anchor" id="autotoc_md256"></a>
2. SCP Protocol (<span class="tt">scp.h</span>)</h2>
<p>Implementation of Scout Communication Protocol v1.1 for frame encoding/decoding.</p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md257"></a>
Data Structures</h3>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line">    uint8_t sync;      <span class="comment">/* Sync byte (0x7E) */</span></div>
<div class="line">    uint8_t type;      <span class="comment">/* Frame type */</span></div>
<div class="line">    uint16_t sequence; <span class="comment">/* Sequence number */</span></div>
<div class="line">    uint16_t length;   <span class="comment">/* Payload length */</span></div>
<div class="line">} <a class="code hl_struct" href="struct____attribute____.html">__attribute__</a>((packed)) scp_header_t;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line">    scp_header_t header;</div>
<div class="line">    uint8_t payload[SCP_MAX_PAYLOAD_SIZE];</div>
<div class="line">    uint16_t crc;</div>
<div class="line">    <span class="keywordtype">size_t</span> total_length;</div>
<div class="line">} <a class="code hl_struct" href="structscp__frame__t.html">scp_frame_t</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line">    <span class="keywordtype">char</span> timestamp_utc[32]; <span class="comment">/* ISO 8601 Z format */</span></div>
<div class="line">    <span class="keywordtype">float</span> cpu_load_pct;     <span class="comment">/* CPU load percentage (0-100) */</span></div>
<div class="line">    <span class="keywordtype">float</span> cpu_temp_c;       <span class="comment">/* CPU temperature in Celsius */</span></div>
<div class="line">    <span class="keywordtype">float</span> battery_v;        <span class="comment">/* Battery voltage */</span></div>
<div class="line">    <span class="keywordtype">float</span> imu_gyro_z;       <span class="comment">/* Z-axis gyro (rad/s) */</span></div>
<div class="line">    <span class="keywordtype">char</span> gps_fix[8];        <span class="comment">/* GPS fix type: &quot;NONE&quot;, &quot;2D&quot;, &quot;3D&quot; */</span></div>
<div class="line">} <a class="code hl_struct" href="structtelemetry__frame__t.html">telemetry_frame_t</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> {</div>
<div class="line">    SCP_STATE_SYNC,    <span class="comment">/* Looking for sync byte */</span></div>
<div class="line">    SCP_STATE_HEADER,  <span class="comment">/* Reading header */</span></div>
<div class="line">    SCP_STATE_PAYLOAD, <span class="comment">/* Reading payload data */</span></div>
<div class="line">    SCP_STATE_CRC,     <span class="comment">/* Reading CRC */</span></div>
<div class="line">    SCP_STATE_COMPLETE <span class="comment">/* Frame complete */</span></div>
<div class="line">} scp_decoder_state_t;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line">    scp_decoder_state_t state;</div>
<div class="line">    <a class="code hl_struct" href="structscp__frame__t.html">scp_frame_t</a> frame;</div>
<div class="line">    <span class="keywordtype">size_t</span> bytes_received;</div>
<div class="line">    <span class="keywordtype">size_t</span> expected_length;</div>
<div class="line">    uint8_t buffer[SCP_MAX_FRAME_SIZE];</div>
<div class="line">} <a class="code hl_struct" href="structscp__decoder__t.html">scp_decoder_t</a>;</div>
<div class="ttc" id="astruct____attribute_____html"><div class="ttname"><a href="struct____attribute____.html">__attribute__</a></div><div class="ttdef"><b>Definition</b> <a href="scp_8h_source.html#l00045">scp.h:46</a></div></div>
<div class="ttc" id="astructscp__decoder__t_html"><div class="ttname"><a href="structscp__decoder__t.html">scp_decoder_t</a></div><div class="ttdef"><b>Definition</b> <a href="scp_8h_source.html#l00073">scp.h:74</a></div></div>
<div class="ttc" id="astructscp__frame__t_html"><div class="ttname"><a href="structscp__frame__t.html">scp_frame_t</a></div><div class="ttdef"><b>Definition</b> <a href="scp_8h_source.html#l00054">scp.h:55</a></div></div>
<div class="ttc" id="astructtelemetry__frame__t_html"><div class="ttname"><a href="structtelemetry__frame__t.html">telemetry_frame_t</a></div><div class="ttdef"><b>Definition</b> <a href="scp_8h_source.html#l00098">scp.h:99</a></div></div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="autotoc_md258"></a>
Core Functions</h3>
<div class="fragment"><div class="line"></div>
<div class="line"><span class="keywordtype">int</span> scp_decoder_init(<a class="code hl_struct" href="structscp__decoder__t.html">scp_decoder_t</a> *decoder);</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> scp_decode_bytes(<a class="code hl_struct" href="structscp__decoder__t.html">scp_decoder_t</a> *decoder, <span class="keyword">const</span> uint8_t *data, <span class="keywordtype">size_t</span> len, <a class="code hl_struct" href="structscp__frame__t.html">scp_frame_t</a> *frame);</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">bool</span> scp_validate_frame(<span class="keyword">const</span> <a class="code hl_struct" href="structscp__frame__t.html">scp_frame_t</a> *frame);</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> scp_encode_frame(<span class="keyword">const</span> <a class="code hl_struct" href="structscp__frame__t.html">scp_frame_t</a> *frame, uint8_t *output, <span class="keywordtype">size_t</span> output_size);</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> scp_extract_telemetry(<span class="keyword">const</span> <a class="code hl_struct" href="structscp__frame__t.html">scp_frame_t</a> *frame, <a class="code hl_struct" href="structtelemetry__frame__t.html">telemetry_frame_t</a> *telemetry);</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> scp_decoder_reset(<a class="code hl_struct" href="structscp__decoder__t.html">scp_decoder_t</a> *decoder);</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="autotoc_md259"></a>
Frame Types</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type  </th><th class="markdownTableHeadNone">Constant  </th><th class="markdownTableHeadNone">Description  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0x01  </td><td class="markdownTableBodyNone"><span class="tt">SCP_TYPE_TELEMETRY</span>  </td><td class="markdownTableBodyNone">Telemetry data frame  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0x02  </td><td class="markdownTableBodyNone"><span class="tt">SCP_TYPE_HEARTBEAT</span>  </td><td class="markdownTableBodyNone">Keep-alive frame  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0x03  </td><td class="markdownTableBodyNone"><span class="tt">SCP_TYPE_ACK</span>  </td><td class="markdownTableBodyNone">Acknowledgment frame  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0x04  </td><td class="markdownTableBodyNone"><span class="tt">SCP_TYPE_COMMAND</span>  </td><td class="markdownTableBodyNone">Command frame  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0xFF  </td><td class="markdownTableBodyNone"><span class="tt">SCP_TYPE_ERROR</span>  </td><td class="markdownTableBodyNone">Error frame  </td></tr>
</table>
<h2 class="doxsection"><a class="anchor" id="autotoc_md260"></a>
3. Display Engine (<span class="tt">display_ascii.h</span>, <span class="tt">display_tui.h</span>)</h2>
<p>Multi-mode display system supporting both ASCII text and full-featured TUI.</p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md261"></a>
ASCII Display (<span class="tt">display_ascii.h</span>)</h3>
<p>Simple text-based output for maximum compatibility.</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line">    <span class="keywordtype">char</span> title[256];</div>
<div class="line">    <span class="keywordtype">size_t</span> max_rows;</div>
<div class="line">    display_mode_t mode;</div>
<div class="line">    <span class="keywordtype">bool</span> show_timestamps;</div>
<div class="line">    <span class="keywordtype">char</span> **rows;</div>
<div class="line">    <span class="keywordtype">size_t</span> row_count;</div>
<div class="line">    time_t last_update;</div>
<div class="line">} <a class="code hl_struct" href="structascii__display__t.html">ascii_display_t</a>;</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> ascii_display_init(<a class="code hl_struct" href="structascii__display__t.html">ascii_display_t</a> *display, <span class="keyword">const</span> <span class="keywordtype">char</span> *title);</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> ascii_display_config(<a class="code hl_struct" href="structascii__display__t.html">ascii_display_t</a> *display, <span class="keywordtype">size_t</span> max_rows, </div>
<div class="line">                        display_mode_t mode, <span class="keywordtype">bool</span> show_timestamps);</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> ascii_display_add_row(<a class="code hl_struct" href="structascii__display__t.html">ascii_display_t</a> *display, <span class="keyword">const</span> <a class="code hl_struct" href="structtelemetry__frame__t.html">telemetry_frame_t</a> *telemetry);</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> ascii_display_render(<a class="code hl_struct" href="structascii__display__t.html">ascii_display_t</a> *display);</div>
<div class="ttc" id="astructascii__display__t_html"><div class="ttname"><a href="structascii__display__t.html">ascii_display_t</a></div><div class="ttdef"><b>Definition</b> <a href="display__ascii_8h_source.html#l00065">display_ascii.h:66</a></div></div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="autotoc_md262"></a>
TUI Display (<span class="tt">display_tui.h</span>)</h3>
<p>Full-featured ncurses interface with real-time updates.</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line">    WINDOW *main_win;</div>
<div class="line">    WINDOW *header_win;</div>
<div class="line">    WINDOW *telemetry_win;</div>
<div class="line">    WINDOW *status_win;</div>
<div class="line">    <span class="keywordtype">int</span> max_x, max_y;</div>
<div class="line">    <span class="keywordtype">bool</span> colors_enabled;</div>
<div class="line">    time_t start_time;</div>
<div class="line">    uint32_t frame_count;</div>
<div class="line">    uint32_t error_count;</div>
<div class="line">} <a class="code hl_struct" href="structtui__display__t.html">tui_display_t</a>;</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> tui_display_init(<a class="code hl_struct" href="structtui__display__t.html">tui_display_t</a> *display);</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> tui_display_render(<a class="code hl_struct" href="structtui__display__t.html">tui_display_t</a> *display, <span class="keyword">const</span> <a class="code hl_struct" href="structtelemetry__frame__t.html">telemetry_frame_t</a> *telemetry, </div>
<div class="line">                      <span class="keyword">const</span> connection_stats_t *stats);</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> tui_display_handle_input(<a class="code hl_struct" href="structtui__display__t.html">tui_display_t</a> *display);</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> tui_display_close(<a class="code hl_struct" href="structtui__display__t.html">tui_display_t</a> *display);</div>
<div class="ttc" id="astructtui__display__t_html"><div class="ttname"><a href="structtui__display__t.html">tui_display_t</a></div><div class="ttdef"><b>Definition</b> <a href="display__tui_8h_source.html#l00059">display_tui.h:60</a></div></div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="autotoc_md263"></a>
4. CSV Logger (<span class="tt">log.h</span>)</h2>
<p>Structured data logging with automatic rotation and replay capabilities.</p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md264"></a>
Data Structures</h3>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> {</div>
<div class="line">    LOG_MODE_CREATE,    <span class="comment">/* Create new file (overwrite existing) */</span></div>
<div class="line">    LOG_MODE_APPEND,    <span class="comment">/* Append to existing file */</span></div>
<div class="line">    LOG_MODE_ROTATE     <span class="comment">/* Auto-rotate when size limit reached */</span></div>
<div class="line">} log_mode_t;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line">    FILE *file;</div>
<div class="line">    <span class="keywordtype">char</span> filename[512];</div>
<div class="line">    log_mode_t mode;</div>
<div class="line">    <span class="keywordtype">size_t</span> max_file_size;</div>
<div class="line">    <span class="keywordtype">bool</span> header_written;</div>
<div class="line">    <span class="keywordtype">char</span> **column_names;</div>
<div class="line">    <span class="keywordtype">char</span> **column_formats;</div>
<div class="line">    <span class="keywordtype">size_t</span> column_count;</div>
<div class="line">    <span class="keywordtype">size_t</span> bytes_written;</div>
<div class="line">} <a class="code hl_struct" href="structcsv__logger__t.html">csv_logger_t</a>;</div>
<div class="ttc" id="astructcsv__logger__t_html"><div class="ttname"><a href="structcsv__logger__t.html">csv_logger_t</a></div><div class="ttdef"><b>Definition</b> <a href="log_8h_source.html#l00068">log.h:69</a></div></div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="autotoc_md265"></a>
Core Functions</h3>
<div class="fragment"><div class="line"></div>
<div class="line"><span class="keywordtype">int</span> csv_logger_init(<a class="code hl_struct" href="structcsv__logger__t.html">csv_logger_t</a> *logger, <span class="keyword">const</span> <span class="keywordtype">char</span> *filename, log_mode_t mode);</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> csv_logger_add_column(<a class="code hl_struct" href="structcsv__logger__t.html">csv_logger_t</a> *logger, <span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keyword">const</span> <span class="keywordtype">char</span> *format);</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> csv_logger_log_telemetry(<a class="code hl_struct" href="structcsv__logger__t.html">csv_logger_t</a> *logger, <span class="keyword">const</span> <a class="code hl_struct" href="structtelemetry__frame__t.html">telemetry_frame_t</a> *telemetry);</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> csv_logger_flush(<a class="code hl_struct" href="structcsv__logger__t.html">csv_logger_t</a> *logger);</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> csv_logger_close(<a class="code hl_struct" href="structcsv__logger__t.html">csv_logger_t</a> *logger);</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="autotoc_md266"></a>
5. Configuration Management (<span class="tt">config.h</span>)</h2>
<p>INI-style configuration file parsing and management.</p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md267"></a>
Data Structures</h3>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line">    <span class="keywordtype">char</span> port[256];</div>
<div class="line">    uint32_t baud_rate;</div>
<div class="line">    uint32_t timeout_ms;</div>
<div class="line">} config_serial_t;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line">    display_mode_t mode;</div>
<div class="line">    uint32_t update_rate_hz;</div>
<div class="line">    <span class="keywordtype">bool</span> colors_enabled;</div>
<div class="line">    <span class="keywordtype">bool</span> show_timestamps;</div>
<div class="line">} config_display_t;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line">    <span class="keywordtype">bool</span> enabled;</div>
<div class="line">    <span class="keywordtype">char</span> filename[512];</div>
<div class="line">    <span class="keywordtype">size_t</span> max_file_size;</div>
<div class="line">    <span class="keywordtype">bool</span> auto_rotate;</div>
<div class="line">} config_logging_t;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line">    <span class="keywordtype">bool</span> validate_crc;</div>
<div class="line">    uint32_t sync_timeout_ms;</div>
<div class="line">    uint8_t max_retries;</div>
<div class="line">} config_scp_t;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line">    config_serial_t serial;</div>
<div class="line">    config_display_t display;</div>
<div class="line">    config_logging_t logging;</div>
<div class="line">    config_scp_t scp;</div>
<div class="line">} citadel_config_t;</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="autotoc_md268"></a>
Core Functions</h3>
<div class="fragment"><div class="line"></div>
<div class="line"><span class="keywordtype">int</span> config_load(citadel_config_t *config, <span class="keyword">const</span> <span class="keywordtype">char</span> *filename);</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> config_save(<span class="keyword">const</span> citadel_config_t *config, <span class="keyword">const</span> <span class="keywordtype">char</span> *filename);</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> config_init_defaults(citadel_config_t *config);</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> config_validate(<span class="keyword">const</span> citadel_config_t *config);</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="autotoc_md269"></a>
6. Utility Functions (<span class="tt">util.h</span>)</h2>
<p>Cross-platform utility functions for string handling, time management, and data conversion.</p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md270"></a>
String Operations</h3>
<div class="fragment"><div class="line"></div>
<div class="line"><span class="keywordtype">int</span> util_safe_strcpy(<span class="keywordtype">char</span> *dest, <span class="keyword">const</span> <span class="keywordtype">char</span> *src, <span class="keywordtype">size_t</span> dest_size);</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">char</span> *util_trim_string(<span class="keywordtype">char</span> *str);</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="autotoc_md271"></a>
Time Functions</h3>
<div class="fragment"><div class="line"></div>
<div class="line">uint64_t util_get_time_ms(<span class="keywordtype">void</span>);</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> util_get_timestamp_string(<span class="keywordtype">char</span> *buffer, <span class="keywordtype">size_t</span> size);</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="autotoc_md272"></a>
Data Conversion</h3>
<div class="fragment"><div class="line"></div>
<div class="line"><span class="keywordtype">int</span> util_bytes_to_hex(<span class="keyword">const</span> uint8_t *data, <span class="keywordtype">size_t</span> data_len,</div>
<div class="line">                     <span class="keywordtype">char</span> *hex_str, <span class="keywordtype">size_t</span> hex_str_size, <span class="keywordtype">bool</span> uppercase);</div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="autotoc_md273"></a>
Error Handling</h1>
<p>All API functions follow consistent error reporting conventions:</p>
<ul>
<li><b>Success</b>: Return <span class="tt">0</span> or positive value (bytes processed, etc.)</li>
<li><b>Error</b>: Return negative error code</li>
<li><b>Boolean</b>: Return <span class="tt">true</span>/<span class="tt">false</span> for validation functions</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md274"></a>
Global Error Codes</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Code  </th><th class="markdownTableHeadNone">Constant  </th><th class="markdownTableHeadNone">Description  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">-1  </td><td class="markdownTableBodyNone"><span class="tt">ERR_INVALID_PARAM</span>  </td><td class="markdownTableBodyNone">Invalid function parameter  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">-2  </td><td class="markdownTableBodyNone"><span class="tt">ERR_OUT_OF_MEMORY</span>  </td><td class="markdownTableBodyNone">Memory allocation failed  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">-3  </td><td class="markdownTableBodyNone"><span class="tt">ERR_IO_ERROR</span>  </td><td class="markdownTableBodyNone">Input/output operation failed  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">-4  </td><td class="markdownTableBodyNone"><span class="tt">ERR_TIMEOUT</span>  </td><td class="markdownTableBodyNone">Operation timed out  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">-5  </td><td class="markdownTableBodyNone"><span class="tt">ERR_NOT_SUPPORTED</span>  </td><td class="markdownTableBodyNone">Feature not supported  </td></tr>
</table>
<h1 class="doxsection"><a class="anchor" id="autotoc_md275"></a>
Thread Safety</h1>
<p>The current implementation is <b>not thread-safe</b>. All API calls should be made from a single thread or protected with appropriate synchronization mechanisms.</p>
<p>For multi-threaded usage:</p>
<ul>
<li>Use mutex locks around API calls</li>
<li>Consider separate instances for different threads</li>
<li>Be aware of shared state in display and logging components</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md276"></a>
Memory Management</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md277"></a>
Allocation Strategy</h2>
<ul>
<li><b>Stack Allocation</b>: Preferred for small, temporary structures</li>
<li><b>Static Allocation</b>: Used for configuration and global state</li>
<li><b>Dynamic Allocation</b>: Minimal usage, primarily for buffers and data structures</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md278"></a>
Resource Cleanup</h2>
<p>All allocated resources must be explicitly freed:</p>
<div class="fragment"><div class="line"><span class="comment">// Initialize</span></div>
<div class="line">serial_port_t port;</div>
<div class="line">serial_init(&amp;port, <span class="stringliteral">&quot;/dev/ttyUSB0&quot;</span>, 115200);</div>
<div class="line">serial_open(&amp;port);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Use port...</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Cleanup (required)</span></div>
<div class="line">serial_close(&amp;port);</div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="autotoc_md279"></a>
Performance Considerations</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md280"></a>
Optimization Guidelines</h2>
<ol type="1">
<li><b>Buffer Management</b>: Pre-allocate buffers when possible</li>
<li><b>String Operations</b>: Use safe utility functions for performance</li>
<li><b>Display Updates</b>: Limit refresh rates to avoid CPU overhead</li>
<li><b>I/O Operations</b>: Use non-blocking reads for responsiveness</li>
</ol>
<h2 class="doxsection"><a class="anchor" id="autotoc_md281"></a>
Performance Targets</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Operation  </th><th class="markdownTableHeadNone">Target Latency (p95)  </th><th class="markdownTableHeadNone">Measured (Apple M1)  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">SCP Decode  </td><td class="markdownTableBodyNone">&lt; 200μs  </td><td class="markdownTableBodyNone">0μs ✓  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Display Render  </td><td class="markdownTableBodyNone">&lt; 1000μs  </td><td class="markdownTableBodyNone">0μs ✓  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">CSV Logging  </td><td class="markdownTableBodyNone">&lt; 500μs  </td><td class="markdownTableBodyNone">0μs ✓  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Utility Functions  </td><td class="markdownTableBodyNone">&lt; 100μs  </td><td class="markdownTableBodyNone">0μs ✓  </td></tr>
</table>
<h1 class="doxsection"><a class="anchor" id="autotoc_md282"></a>
Example Usage</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md283"></a>
Complete Integration Example</h2>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;citadel.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code hl_function" href="acp__client_8c.html#a840291bc02cba5474a4cb46a9b9566fe">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Initialize configuration</span></div>
<div class="line">    citadel_config_t config;</div>
<div class="line">    config_init_defaults(&amp;config);</div>
<div class="line">    config_load(&amp;config, <span class="stringliteral">&quot;citadel.conf&quot;</span>);</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Initialize serial port</span></div>
<div class="line">    serial_port_t port;</div>
<div class="line">    <span class="keywordflow">if</span> (serial_init(&amp;port, config.serial.port, config.serial.baud_rate) != 0) {</div>
<div class="line">        fprintf(stderr, <span class="stringliteral">&quot;Failed to initialize serial port\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">if</span> (serial_open(&amp;port) != 0) {</div>
<div class="line">        fprintf(stderr, <span class="stringliteral">&quot;Failed to open serial connection\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Initialize SCP decoder</span></div>
<div class="line">    <a class="code hl_struct" href="structscp__decoder__t.html">scp_decoder_t</a> decoder;</div>
<div class="line">    scp_decoder_init(&amp;decoder);</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Initialize display</span></div>
<div class="line">    <a class="code hl_struct" href="structascii__display__t.html">ascii_display_t</a> display;</div>
<div class="line">    ascii_display_init(&amp;display, <span class="stringliteral">&quot;Citadel Core CLI&quot;</span>);</div>
<div class="line">    ascii_display_config(&amp;display, 100, DISPLAY_MODE_STREAMING, <span class="keyword">true</span>);</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Initialize logger</span></div>
<div class="line">    <a class="code hl_struct" href="structcsv__logger__t.html">csv_logger_t</a> logger;</div>
<div class="line">    <span class="keywordflow">if</span> (config.logging.enabled) {</div>
<div class="line">        csv_logger_init(&amp;logger, config.logging.filename, LOG_MODE_APPEND);</div>
<div class="line">        csv_logger_add_column(&amp;logger, <span class="stringliteral">&quot;timestamp&quot;</span>, <span class="stringliteral">&quot;%s&quot;</span>);</div>
<div class="line">        csv_logger_add_column(&amp;logger, <span class="stringliteral">&quot;cpu_temp&quot;</span>, <span class="stringliteral">&quot;%.1f&quot;</span>);</div>
<div class="line">        csv_logger_add_column(&amp;logger, <span class="stringliteral">&quot;battery_v&quot;</span>, <span class="stringliteral">&quot;%.2f&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Main processing loop</span></div>
<div class="line">    uint8_t buffer[1024];</div>
<div class="line">    <a class="code hl_struct" href="structscp__frame__t.html">scp_frame_t</a> frame;</div>
<div class="line">    <a class="code hl_struct" href="structtelemetry__frame__t.html">telemetry_frame_t</a> telemetry;</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">while</span> (running) {</div>
<div class="line">        <span class="comment">// Read serial data</span></div>
<div class="line">        <span class="keywordtype">int</span> bytes_read = serial_read(&amp;port, buffer, <span class="keyword">sizeof</span>(buffer));</div>
<div class="line">        <span class="keywordflow">if</span> (bytes_read &gt; 0) {</div>
<div class="line">            <span class="comment">// Process SCP frames</span></div>
<div class="line">            <span class="keywordflow">if</span> (scp_decode_bytes(&amp;decoder, buffer, bytes_read, &amp;frame) == 1) {</div>
<div class="line">                <span class="comment">// Frame complete - extract telemetry</span></div>
<div class="line">                <span class="keywordflow">if</span> (scp_extract_telemetry(&amp;frame, &amp;telemetry) == 0) {</div>
<div class="line">                    <span class="comment">// Update display</span></div>
<div class="line">                    ascii_display_add_row(&amp;display, &amp;telemetry);</div>
<div class="line">                    ascii_display_render(&amp;display);</div>
<div class="line">                    </div>
<div class="line">                    <span class="comment">// Log data</span></div>
<div class="line">                    <span class="keywordflow">if</span> (config.logging.enabled) {</div>
<div class="line">                        csv_logger_log_telemetry(&amp;logger, &amp;telemetry);</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// Small delay to prevent CPU spinning</span></div>
<div class="line">        usleep(1000);</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Cleanup</span></div>
<div class="line">    <span class="keywordflow">if</span> (config.logging.enabled) {</div>
<div class="line">        csv_logger_close(&amp;logger);</div>
<div class="line">    }</div>
<div class="line">    serial_close(&amp;port);</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="aacp__client_8c_html_a840291bc02cba5474a4cb46a9b9566fe"><div class="ttname"><a href="acp__client_8c.html#a840291bc02cba5474a4cb46a9b9566fe">main</a></div><div class="ttdeci">int main(void)</div><div class="ttdoc">Main example program.</div><div class="ttdef"><b>Definition</b> <a href="acp__client_8c_source.html#l00257">acp_client.c:257</a></div></div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="autotoc_md284"></a>
Version History</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Version  </th><th class="markdownTableHeadNone">Date  </th><th class="markdownTableHeadNone">Changes  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0.1.0  </td><td class="markdownTableBodyNone">2025-10-26  </td><td class="markdownTableBodyNone">Initial release with core functionality  </td></tr>
</table>
<hr  />
<p>This API documentation is maintained alongside the source code. For the most up-to-date information, refer to the header files in the <span class="tt">src/</span> directory. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on <span class="timestamp"></span> for ACP - Autonomous Command Protocol by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.15.0 </li>
  </ul>
</div>
</body>
</html>

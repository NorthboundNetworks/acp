<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.15.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ACP - Autonomous Command Protocol: üß† Eunice Research Platform - Architecture Documentation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">ACP - Autonomous Command Protocol<span id="projectnumber">&#160;v0.3.0</span>
   </div>
   <div id="projectbrief">Portable C99 framing library with COBS, CRC16, and HMAC-SHA256 authentication</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.15.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('md__2_users_2paulzanna_2_github_2_eunice_2docs_2_architecture_2_version_01_history_2_eunice___architecture__v0_85_80.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">üß† Eunice Research Platform - Architecture Documentation </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md1065"></a></p>
<blockquote class="doxtable">
<p>[ARCHIVED] This pre-0.6.0 document is retained for historical reference only. Current architecture and user-facing documentation exclude versions earlier than 0.6.0. For full historical changes consult <span class="tt">CHANGELOG.md</span>. </p>
</blockquote>
<p><b>Version</b>: v0.5.0 (MCP-Standard Compliant) <br  />
 <b>Status</b>: Production Ready <br  />
 <b>Last Updated</b>: August 10, 2025 <br  />
 <b>Target Audience</b>: Developers, DevOps Engineers, System Architects <br  />
</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md1066"></a>
üìã Executive Summary</h1>
<p>The Eunice Research Platform is a modernized, microservices-based research automation system built around the Model Context Protocol (MCP) for agent coordination. The platform provides comprehensive literature review capabilities, AI-driven research planning, and systematic academic research workflows through a fully standardized, containerized architecture that is <b>MCP-standard compliant</b>.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md1067"></a>
üéØ Key Achievements (v0.5.0)</h2>
<ul>
<li>‚úÖ <b>MCP-Standard Compliant</b>: Direct client-server sessions, no non-standard hub/broker pattern</li>
<li>‚úÖ <b>Client-Side Multiplexing</b>: API Gateway maintains direct sessions to multiple MCP servers</li>
<li>‚úÖ <b>Fully Standardized Architecture</b>: All services follow identical structure patterns</li>
<li>‚úÖ <b>Comprehensive API Layer</b>: FastAPI-based gateway with direct DB reads and MCP-routed writes</li>
<li>‚úÖ <b>Production-Ready Security</b>: JWT authentication with RBAC and container hardening</li>
<li>‚úÖ <b>Complete Test Coverage</b>: Standardized pytest frameworks across all services</li>
<li>‚úÖ <b>Container-First Design</b>: Multi-stage Docker builds with optimized production images</li>
<li>‚úÖ <b>Hierarchical Research Structure</b>: Projects ‚Üí Topics ‚Üí Plans ‚Üí Tasks workflow</li>
<li>‚úÖ <b>Unified Database Tooling</b>: Consolidated <span class="tt">db_mutate</span> / <span class="tt">db_query</span> tools (transactions, variable substitution, includes, idempotency)</li>
<li>‚úÖ <b>Streaming Compatibility</b>: Dual Accept header (JSON + SSE) with automatic event-stream parsing</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md1068"></a>
üèóÔ∏è System Architecture Overview</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md1069"></a>
Design Philosophy</h2>
<p>The platform implements a <b>MCP-compliant microservices architecture</b> with:</p>
<ol type="1">
<li><b>Direct MCP Sessions</b>: Point-to-point client-server connections per MCP specification</li>
<li><b>Client-Side Multiplexing</b>: API Gateway as sole MCP client maintaining multiple server sessions</li>
<li><b>Uniform Service Structure</b>: All services follow identical directory layouts and patterns</li>
<li><b>Hybrid Database Access</b>: Direct PostgreSQL for reads, MCP-routed tools for writes</li>
<li><b>Security-First Design</b>: Multi-stage container builds with proper secret management</li>
<li><b>Comprehensive Observability</b>: Health monitoring, structured logging, and metrics collection</li>
<li><b>Developer Experience</b>: Consistent startup scripts, testing frameworks, and documentation</li>
</ol>
<h2 class="doxsection"><a class="anchor" id="autotoc_md1070"></a>
Why This Update?</h2>
<p>The previous v0.4.1 architecture used an <b>MCP hub pattern</b> that is <b>not part of the MCP specification</b>. MCP defines <b>point-to-point client ‚Üî server sessions</b> (stdio/socket/WebSocket). Each client connects directly to one or more servers; there is no broker defined by the standard.</p>
<p>This revision removes the hub and replaces it with <b>client-side multiplexing</b> and <b>server composition</b> that remain compliant with the MCP standard.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md1071"></a>
System Architecture Diagram</h2>
<div class="fragment"><div class="line">graph TB</div>
<div class="line">    subgraph &quot;Frontend Layer&quot;</div>
<div class="line">        UI[React + Vite Frontend&lt;br/&gt;:3000&lt;br/&gt;shadcn/ui components]</div>
<div class="line">    end</div>
<div class="line"> </div>
<div class="line">    subgraph &quot;API Layer (MCP Client Multiplexer)&quot;</div>
<div class="line">        Gateway[API Gateway Service&lt;br/&gt;:8000&lt;br/&gt;FastAPI + Pydantic]:::client</div>
<div class="line">        Auth[Authentication Service&lt;br/&gt;:8005&lt;br/&gt;JWT + RBAC]</div>
<div class="line">    end</div>
<div class="line"> </div>
<div class="line">    subgraph &quot;Agents (run inside GW workers)&quot;</div>
<div class="line">        ResearchMgr[Research Manager Agent&lt;br/&gt;:8001&lt;br/&gt;Workflow Orchestration]:::agent</div>
<div class="line">        LitAgent[Literature Agent&lt;br/&gt;Academic Search &amp; Analysis]:::agent</div>
<div class="line">    end</div>
<div class="line"> </div>
<div class="line">    subgraph &quot;MCP Servers (Direct Sessions)&quot;</div>
<div class="line">        DBService[Database Service&lt;br/&gt;:8004&lt;br/&gt;PostgreSQL Tools]:::server</div>
<div class="line">        NetworkSvc[Network Service&lt;br/&gt;:8002&lt;br/&gt;External APIs]:::server</div>
<div class="line">        MemorySvc[Memory Service&lt;br/&gt;:8003&lt;br/&gt;Context &amp; State]:::server</div>
<div class="line">    end</div>
<div class="line"> </div>
<div class="line">    subgraph &quot;Infrastructure&quot;</div>
<div class="line">        DB[(PostgreSQL Database&lt;br/&gt;Hierarchical Schema)]</div>
<div class="line">        Nginx[Nginx Load Balancer&lt;br/&gt;Reverse Proxy]</div>
<div class="line">        DockerProxy[Docker Socket Proxy&lt;br/&gt;Security Layer]</div>
<div class="line">    end</div>
<div class="line"> </div>
<div class="line">    UI --&gt; Nginx</div>
<div class="line">    Nginx --&gt; Gateway</div>
<div class="line">    Gateway --&gt;|Direct Reads| DB</div>
<div class="line">    Auth --&gt; DB</div>
<div class="line">    Auth --&gt; DockerProxy</div>
<div class="line">    </div>
<div class="line">    Gateway --&gt; ResearchMgr</div>
<div class="line">    Gateway --&gt; LitAgent</div>
<div class="line"> </div>
<div class="line">    %% Direct client-&gt;server sessions (no hub):</div>
<div class="line">    Gateway -. stdio/ws sessions .-&gt; DBService</div>
<div class="line">    Gateway -. stdio/ws sessions .-&gt; NetworkSvc</div>
<div class="line">    Gateway -. stdio/ws sessions .-&gt; MemorySvc</div>
<div class="line">    </div>
<div class="line">    DBService --&gt; DB</div>
<div class="line"> </div>
<div class="line">    classDef client fill:#e8f7ff,stroke:#1e90ff;</div>
<div class="line">    classDef server fill:#f0f5e6,stroke:#5f8a00;</div>
<div class="line">    classDef agent fill:#fff3e6,stroke:#f59e0b;</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="autotoc_md1072"></a>
What Changed from v0.4.1</h2>
<ul>
<li><b>Removed the "MCP Hub"</b>: No longer using a non-standard broker pattern</li>
<li><b>Gateway is the sole MCP client</b>: Maintaining N independent sessions, one per server</li>
<li><b>Agents execute inside the Gateway</b>: Or separate worker entrypoint, calling tools via the Gateway's client API</li>
<li><b>Direct Sessions</b>: Each MCP server has its own transport, following MCP specification</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md1073"></a>
üß© Service Components</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md1074"></a>
1. üåê API Gateway Service</h2>
<p><b>Purpose</b>: Central API hub providing RESTful endpoints for the frontend</p>
<p><b>Key Features</b>:</p>
<ul>
<li><b>V2 Hierarchical API</b>: Complete CRUD operations for research workflows</li>
<li><b>Hybrid Database Access</b>: Direct reads for performance, MCP writes for consistency</li>
<li><b>FastAPI Framework</b>: Type-safe APIs with automatic documentation</li>
<li><b>Authentication Integration</b>: JWT token validation and RBAC enforcement</li>
</ul>
<p><b>Endpoints</b> (API version prefix removed in v0.5.0+):</p>
<ul>
<li>Projects: <span class="tt">/projects</span> - Top-level research containers</li>
<li>Research Topics: <span class="tt">/topics</span> - Specific investigation areas <br  />
</li>
<li>Research Plans: <span class="tt">/plans</span> - Structured methodological approaches</li>
<li>Tasks: <span class="tt">/tasks</span> - Individual executable work units</li>
<li>Literature: <span class="tt">/literature</span> - Academic papers and publications</li>
<li>Statistics: <span class="tt">/stats</span> - Analytics and progress tracking</li>
</ul>
<blockquote class="doxtable">
<p>NOTE: Previous documentation referenced <span class="tt">/v2/...</span> paths. Versioning has been removed; clients must update to unversioned paths. No backward compatibility shim is provided. </p>
</blockquote>
<p><b>Technology Stack</b>:</p>
<ul>
<li>FastAPI with Pydantic models</li>
<li>Async PostgreSQL connections</li>
<li>MCP client integration</li>
<li>Comprehensive health monitoring</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md1075"></a>
2. üîê Authentication Service</h2>
<p><b>Purpose</b>: Secure user authentication and authorization management</p>
<p><b>Key Features</b>:</p>
<ul>
<li><b>JWT Token System</b>: Access tokens (30 min) + refresh tokens (7 days)</li>
<li><b>RBAC Implementation</b>: Admin, Researcher, Collaborator roles</li>
<li><b>2FA Support</b>: TOTP with Google/Microsoft Authenticator</li>
<li><b>Security Hardening</b>: bcrypt hashing, rate limiting, brute force protection</li>
</ul>
<p><b>Capabilities</b>:</p>
<ul>
<li>Email and username-based login</li>
<li>Password strength validation</li>
<li>Backup codes for 2FA recovery</li>
<li>CORS configuration for frontend</li>
<li>Container security with non-root execution</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md1076"></a>
3. üîÑ Connection Manager (MCP Client Multiplexer)</h2>
<p><b>Purpose</b>: API Gateway acts as a multiplexing MCP client maintaining direct sessions with multiple MCP servers</p>
<p><b>Key Features</b>:</p>
<ul>
<li><b>Session Management</b>: Maintains N independent stdio/WebSocket sessions, one per MCP server</li>
<li><b>Capability Discovery</b>: Discovers available tools from each server during initialization <br  />
</li>
<li><b>Tool Routing</b>: Intelligent routing of tool calls to appropriate servers based on capabilities</li>
<li><b>Transport Layer</b>: Supports both stdio pipes and WebSocket connections for MCP servers</li>
</ul>
<p><b>MCP Compliance Benefits</b>:</p>
<ul>
<li><b>Standards Adherence</b>: Full compliance with MCP JSON-RPC 2.0 specification</li>
<li><b>Direct Communication</b>: No intermediate broker - clean client-server protocol</li>
<li><b>Resource Discovery</b>: Dynamic capability discovery following MCP standard patterns</li>
<li><b>Session Isolation</b>: Each server session is independent, improving reliability and debugging</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md1077"></a>
4. üß† Research Manager Agent</h2>
<p><b>Purpose</b>: Coordinates complex research workflows and task orchestration (runs inside API Gateway workers)</p>
<p><b>Key Features</b>:</p>
<ul>
<li><b>Prompt-Driven Logic</b>: JSON-configured AI prompts for decision making</li>
<li><b>Multi-Step Execution</b>: Complex tool-chain orchestration via Gateway's MCP client</li>
<li><b>Research Planning</b>: AI-generated research plans and methodologies</li>
<li><b>Progress Tracking</b>: Execution monitoring and status reporting</li>
</ul>
<p><b>Capabilities</b>:</p>
<ul>
<li>Literature review coordination</li>
<li>Research plan generation and execution</li>
<li>Task decomposition and scheduling</li>
<li>Tool calls via Gateway's multiplexed MCP sessions</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md1078"></a>
5. üìö Literature Agent (Planned v0.5.2)</h2>
<p>Status: Planned (NOT part of v0.5.0 deployed runtime). This section previews forthcoming Literature Review capabilities to be introduced in v0.5.2.</p>
<p>Planned Purpose: Specialized agent / service for academic literature processing (search, fetch, deduplicate, screen, extract, synthesize) integrated with research plans &amp; tasks.</p>
<p>Planned Key Features:</p>
<ul>
<li>Multi-source academic search (PubMed, Semantic Scholar, CrossRef, arXiv, OpenAlex) via Network Service tools</li>
<li>Query strategy generation &amp; iterative refinement (AI-assisted)</li>
<li>Canonical record resolution &amp; deduplication (DOI / PMID / arXiv ID normalization)</li>
<li>PRISMA-style screening pipeline (identification ‚Üí screening ‚Üí eligibility ‚Üí included) with metrics</li>
<li>Structured evidence extraction (method, sample, outcomes, key findings) stored as JSONB</li>
<li>Summarization &amp; synthesis (objective / methodology grouped summaries)</li>
<li>Bibliography export (BibTeX, CSL JSON) and citation graph enrichment (planned follow-on)</li>
</ul>
<p>Planned Functions:</p>
<ul>
<li>Systematic search execution &amp; rate‚Äëlimited batching</li>
<li>Screening queue management with inclusion/exclusion reasons &amp; audit trail</li>
<li>Auto-generation of follow‚Äëup research tasks from gaps identified in literature</li>
<li>Bibliographic record management &amp; export utilities</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md1079"></a>
6. üóÑÔ∏è Database Service (MCP Server)</h2>
<p><b>Purpose</b>: MCP-standard compliant server exposing validated database operations</p>
<p><b>Key Features</b>:</p>
<ul>
<li><b>MCP Server Implementation</b>: Standard JSON-RPC 2.0 protocol over stdio/WebSocket</li>
<li><b>Predefined Tools</b>: Type-safe database operations exposed as MCP tools</li>
<li><b>Security First</b>: Parameterized queries only, no dynamic SQL</li>
<li><b>Hierarchical Support</b>: Projects ‚Üí Topics ‚Üí Plans ‚Üí Tasks relationships</li>
<li><b>Connection Pooling</b>: Optimized PostgreSQL connections</li>
</ul>
<p><b>Available MCP Tools (Unified Interface)</b>:</p>
<ul>
<li><span class="tt">db_query</span> ‚Äì Structured, param-safe read access with filtering, ordering, pagination, and relationship include expansion.</li>
<li><span class="tt">db_mutate</span> ‚Äì Multi-operation mutation tool supporting create/update/delete (and planned upsert), transactional batches, variable capture &amp; substitution, and idempotency keys.</li>
</ul>
<p><b>db_query Capabilities</b>:</p>
<ol type="1">
<li>Filtering: Equality filters per field (future: operators &amp; compound logic)</li>
<li>Ordering: Asc/desc multi-field ordering (stable deterministic ordering)</li>
<li>Pagination: Limit/offset with deterministic ordering requirements</li>
<li>Includes: Relationship expansion via predefined RELATIONSHIPS map (e.g. include <span class="tt">tasks</span> on <span class="tt">research_plan</span>)</li>
<li>Consistent Shape: Returns <span class="tt">{ status, results: [...], includes?: { rel: [...] } }</span></li>
</ol>
<p><b>db_mutate Capabilities</b>:</p>
<ol type="1">
<li>Single or Batch Operations: Accepts a top-level mutation plus nested <span class="tt">operations</span> list</li>
<li>Transaction Control: <span class="tt">options.tx = true</span> wraps all operations in a single DB transaction (rollback on failure)</li>
<li>Variable Substitution: Automatically exposes IDs of successful creates as <span class="tt">$PROJECT_ID</span>, <span class="tt">$TOPIC_ID</span>, <span class="tt">$PLAN_ID</span>, <span class="tt">$TASK_ID</span> for subsequent operations in the same batch</li>
<li>Idempotency: <span class="tt">options.idempotency_key</span> enables deterministic caching of successful responses (in-memory with TTL; roadmap to Redis)</li>
<li>Partial Failure Reporting: Returns <span class="tt">status</span> of <span class="tt">ok</span>, <span class="tt">partial</span>, or <span class="tt">error</span> with per-operation result metadata</li>
<li>Legacy Wrapper Compatibility: Existing granular tool names retained temporarily as thin delegates emitting deprecation warnings</li>
</ol>
<p><b>Legacy Tool Names (Deprecated)</b>: <span class="tt">create_project</span>, <span class="tt">update_project</span>, <span class="tt">delete_project</span>, <span class="tt">create_research_topic</span>, <span class="tt">update_research_topic</span>, <span class="tt">delete_research_topic</span>, <span class="tt">create_research_plan</span>, <span class="tt">update_research_plan</span>, <span class="tt">delete_research_plan</span>, <span class="tt">create_task</span>, <span class="tt">update_task</span>, <span class="tt">delete_task</span>, <span class="tt">create_literature_record</span>, <span class="tt">update_literature_record</span> ‚Üí All internally call <span class="tt">db_mutate</span>.</p>
<p>Deprecation Plan:</p>
<ul>
<li>Phase 1 (v0.5.x): Log deprecation usage</li>
<li>Phase 2 (v0.6.x): Optional feature flag to disable legacy names</li>
<li>Phase 3 (v0.7.0): Removal after published migration guide</li>
</ul>
<p><b>Idempotency Implementation (Current State)</b>:</p>
<ul>
<li>In-memory LRU+TTL cache (bounded, periodic eviction)</li>
<li>Canonical serialization for key hashing</li>
<li>Response replay including <span class="tt">cached: true</span> marker</li>
</ul>
<p><b>Planned Enhancements</b> (See Roadmap):</p>
<ul>
<li>Redis-backed distributed cache (cross-instance coherence)</li>
<li>Prometheus metrics (hits, misses, evictions, collisions)</li>
<li>Reservation / write-ahead keys for exactly-once semantics</li>
</ul>
<p><b>Transport / Streaming Note</b>:</p>
<ul>
<li>Clients SHOULD send: <span class="tt">Accept: application/json, text/event-stream</span></li>
<li>Server may stream intermediate events via SSE; final JSON payload emitted as the last <span class="tt">data:</span> event</li>
<li>FastMCP wrapper places tool output inside <span class="tt">result.content[0].text</span>; client libraries must unwrap</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md1080"></a>
7. üåç Network Service (MCP Server)</h2>
<p><b>Purpose</b>: MCP-standard compliant server providing external API integration and web access</p>
<p><b>Key Features</b>:</p>
<ul>
<li><b>MCP Server Implementation</b>: Standard JSON-RPC 2.0 protocol over stdio/WebSocket</li>
<li><b>Academic APIs</b>: Integration with scholarly databases and repositories via MCP tools</li>
<li><b>Web Search</b>: Google Custom Search, DuckDuckGo capabilities exposed as tools <br  />
</li>
<li><b>AI Service Integration</b>: OpenAI, Anthropic, HuggingFace connections</li>
<li><b>Rate Limiting</b>: Intelligent throttling and caching mechanisms</li>
</ul>
<p><b>Available MCP Tools</b>:</p>
<ul>
<li>Literature databases: PubMed, Semantic Scholar, CrossRef, OpenAlex</li>
<li>Search engines: Google Custom Search, DuckDuckGo</li>
<li>AI services: OpenAI GPT, Anthropic Claude, HuggingFace models</li>
<li>Research tools: arXiv, CORE, ResearchGate</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md1081"></a>
8. üß† Memory Service (MCP Server)</h2>
<p><b>Purpose</b>: MCP-standard compliant server providing persistent memory and context management</p>
<p><b>Key Features</b>:</p>
<ul>
<li><b>MCP Server Implementation</b>: Standard JSON-RPC 2.0 protocol over stdio/WebSocket</li>
<li><b>Session Persistence</b>: Maintains conversation history across interactions via MCP tools</li>
<li><b>Agent State</b>: Stores agent context and decision history</li>
<li><b>Context Retrieval</b>: Efficient lookup of relevant historical information</li>
<li><b>Memory Optimization</b>: Automatic cleanup and compression strategies</li>
</ul>
<p><b>Available MCP Tools</b>:</p>
<ul>
<li>Conversation history storage</li>
<li>Agent state persistence</li>
<li>Context-aware retrieval</li>
<li>Memory lifecycle management</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md1082"></a>
üóÇÔ∏è Database Schema</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md1083"></a>
Hierarchical Research Structure</h2>
<p>The platform implements a clear four-level hierarchy for organizing research work:</p>
<p><b>Projects</b> ‚Üí <b>Research Topics</b> ‚Üí <b>Research Plans</b> ‚Üí <b>Tasks</b></p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md1084"></a>
Core Tables</h3>
<ol type="1">
<li><b>projects</b> - Top-level research initiatives<ul>
<li><span class="tt">id</span>, <span class="tt">name</span>, <span class="tt">description</span>, <span class="tt">status</span>, <span class="tt">metadata</span></li>
<li>Container for multiple research topics</li>
</ul>
</li>
<li><b>research_topics</b> - Specific areas of investigation <br  />
<ul>
<li><span class="tt">id</span>, <span class="tt">project_id</span>, <span class="tt">name</span>, <span class="tt">description</span>, <span class="tt">status</span></li>
<li>Contains multiple research plans</li>
</ul>
</li>
<li><b>research_plans</b> - Structured methodological approaches<ul>
<li><span class="tt">id</span>, <span class="tt">topic_id</span>, <span class="tt">name</span>, <span class="tt">methodology</span>, <span class="tt">status</span>, <span class="tt">approval_status</span></li>
<li>Made up of individual tasks</li>
</ul>
</li>
<li><b>research_tasks</b> - Individual executable work units<ul>
<li><span class="tt">id</span>, <span class="tt">plan_id</span>, <span class="tt">name</span>, <span class="tt">type</span>, <span class="tt">status</span>, <span class="tt">execution_details</span></li>
<li>Atomic units of work</li>
</ul>
</li>
</ol>
<h3 class="doxsection"><a class="anchor" id="autotoc_md1085"></a>
Supporting Tables</h3>
<ul>
<li><b>literature_records</b> - Academic papers and publications</li>
<li><b>search_term_optimizations</b> - Enhanced search strategies <br  />
</li>
<li><b>users</b> - Authentication and user management</li>
<li><b>user_roles</b> - RBAC implementation</li>
<li><b>audit_logs</b> - Change tracking and compliance</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md1086"></a>
üîÑ Data Flow Patterns</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md1087"></a>
Standard Request Flow</h2>
<ol type="1">
<li><b>Frontend Request</b>: React UI sends structured request to API Gateway</li>
<li><b>Authentication</b>: JWT token validation and RBAC check</li>
<li><b>Read Operations</b>: Either direct PostgreSQL query (Gateway optimization path) or <span class="tt">db_query</span> (when uniform abstraction or includes needed)</li>
<li><b>Write Operations</b>: Single or batched mutation via <span class="tt">db_mutate</span> (transactional if <span class="tt">tx=true</span>, idempotent if key provided)</li>
<li><b>Agent Processing</b>: Agents may chain <span class="tt">db_query</span> / <span class="tt">db_mutate</span> calls with variable substitution inside batches for dependent creates</li>
<li><b>Response</b>: Structured JSON including potential <span class="tt">includes</span> maps and <span class="tt">cached</span> markers for idempotent replays</li>
</ol>
<h2 class="doxsection"><a class="anchor" id="autotoc_md1088"></a>
Example: AI Research Plan Generation</h2>
<div class="fragment"><div class="line">1. UI ‚Üí POST /topics/{topic_id}/ai-plans (formerly /v2/...)</div>
<div class="line">2. Gateway ‚Üí Validates request, checks topic exists</div>
<div class="line">3. Gateway ‚Üí Invokes Research Manager Agent (internal worker)</div>
<div class="line">4. Research Manager ‚Üí Calls `db_query` to fetch topic (with optional includes)</div>
<div class="line">5. Research Manager ‚Üí Loads AI prompt configuration</div>
<div class="line">6. Research Manager ‚Üí Processes AI response</div>
<div class="line">7. Research Manager ‚Üí Calls `db_mutate` (possibly batching plan + initial tasks with variable substitution `$PLAN_ID`)</div>
<div class="line">8. Database Service ‚Üí Executes validated insert</div>
<div class="line">9. Gateway ‚Üí Returns ResearchPlanResponse</div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="autotoc_md1089"></a>
üõ°Ô∏è Security Architecture</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md1090"></a>
Container Security</h2>
<ul>
<li><b>Multi-stage Docker builds</b> for minimal attack surface</li>
<li><b>Non-root user execution</b> across all containers</li>
<li><b>Read-only filesystems</b> where possible</li>
<li><b>Resource limits</b> and health check monitoring</li>
<li><b>Secret management</b> via environment variables</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md1091"></a>
Authentication &amp; Authorization</h2>
<ul>
<li><b>JWT tokens</b> with HMAC SHA-256 signing (RFC 7519 compliant)</li>
<li><b>Role-Based Access Control</b> (Admin, Researcher, Collaborator)</li>
<li><b>Two-Factor Authentication</b> with TOTP support</li>
<li><b>Password security</b> with bcrypt hashing and salt generation</li>
<li><b>Rate limiting</b> and brute force protection</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md1092"></a>
Network Security</h2>
<ul>
<li><b>CORS configuration</b> for frontend integration</li>
<li><b>HTTPS enforcement</b> via Nginx reverse proxy</li>
<li><b>Internal service communication</b> via Docker networks</li>
<li><b>Database connection security</b> with connection pooling</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md1093"></a>
üìä Service Standards</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md1094"></a>
Directory Structure (All Services)</h2>
<div class="fragment"><div class="line">service/</div>
<div class="line">‚îú‚îÄ‚îÄ src/                     # Python source code</div>
<div class="line">‚îÇ   ‚îú‚îÄ‚îÄ main.py             # FastAPI application entry</div>
<div class="line">‚îÇ   ‚îú‚îÄ‚îÄ config.py           # Pydantic configuration</div>
<div class="line">‚îÇ   ‚îú‚îÄ‚îÄ models.py           # Data models and schemas</div>
<div class="line">‚îÇ   ‚îî‚îÄ‚îÄ utils.py            # Common utilities</div>
<div class="line">‚îú‚îÄ‚îÄ config/                  # Configuration files</div>
<div class="line">‚îÇ   ‚îú‚îÄ‚îÄ config.json         # Service configuration</div>
<div class="line">‚îÇ   ‚îî‚îÄ‚îÄ logging.json        # Logging setup</div>
<div class="line">‚îú‚îÄ‚îÄ tests/                   # Test suite</div>
<div class="line">‚îÇ   ‚îú‚îÄ‚îÄ conftest.py         # Test configuration</div>
<div class="line">‚îÇ   ‚îú‚îÄ‚îÄ test_config.py      # Configuration tests</div>
<div class="line">‚îÇ   ‚îî‚îÄ‚îÄ test_health_check.py # Health monitoring tests</div>
<div class="line">‚îú‚îÄ‚îÄ logs/                    # Runtime logs</div>
<div class="line">‚îú‚îÄ‚îÄ Dockerfile              # Multi-stage container build</div>
<div class="line">‚îú‚îÄ‚îÄ requirements.txt         # Production dependencies</div>
<div class="line">‚îú‚îÄ‚îÄ requirements-dev.txt     # Development dependencies</div>
<div class="line">‚îú‚îÄ‚îÄ start.sh                # Production startup</div>
<div class="line">‚îú‚îÄ‚îÄ start-dev.sh            # Development startup</div>
<div class="line">‚îú‚îÄ‚îÄ .env.example            # Environment template</div>
<div class="line">‚îú‚îÄ‚îÄ pytest.ini             # Test configuration</div>
<div class="line">‚îî‚îÄ‚îÄ .gitignore             # Git ignore rules</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="autotoc_md1095"></a>
Configuration Management</h2>
<ul>
<li><b>Pydantic models</b> for type-safe configuration</li>
<li><b>Environment variable</b> override support</li>
<li><b>JSON configuration files</b> for complex settings</li>
<li><b>Validation and defaults</b> for all parameters</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md1096"></a>
Health Monitoring</h2>
<ul>
<li><b>System metrics</b>: CPU, memory, disk usage monitoring</li>
<li><b>Service health</b>: Connection status and response times</li>
<li><b>Application metrics</b>: Request counts and error rates</li>
<li><b>Custom checks</b>: Service-specific health indicators</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md1097"></a>
Testing Framework</h2>
<ul>
<li><b>Pytest with async support</b> for all services</li>
<li><b>Comprehensive fixtures</b> for mocking dependencies</li>
<li><b>Coverage targeting</b> &gt;80% for all modules</li>
<li><b>Integration tests</b> for critical workflows</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md1098"></a>
üöÄ Deployment Architecture</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md1099"></a>
Container Orchestration</h2>
<div class="fragment"><div class="line"># Docker Compose Services</div>
<div class="line">services:</div>
<div class="line">  - frontend (React + Vite)</div>
<div class="line">  - api-gateway (FastAPI)</div>
<div class="line">  - auth-service (FastAPI)</div>
<div class="line">  - database-service (MCP Server)</div>
<div class="line">  - network-service (MCP Server)</div>
<div class="line">  - memory-service (MCP Server)</div>
<div class="line">  - research-manager (Independent Agent)</div>
<div class="line">  - postgresql (Database)</div>
<div class="line">  - nginx (Load Balancer)</div>
<div class="line">  - docker-socket-proxy (Security)</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="autotoc_md1100"></a>
Environment Configuration</h2>
<ul>
<li><b>Development</b>: Docker Compose with hot reload</li>
<li><b>Staging</b>: Kubernetes with horizontal scaling</li>
<li><b>Production</b>: Kubernetes with high availability</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md1101"></a>
Monitoring &amp; Observability</h2>
<ul>
<li><b>Structured Logging</b>: JSON format with configurable levels</li>
<li><b>Health Endpoints</b>: <span class="tt">/health</span> on all services</li>
<li><b>Metrics Collection</b>: Prometheus-compatible endpoints</li>
<li><b>Distributed Tracing</b>: Request tracking across services</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md1102"></a>
üîÆ Architecture Benefits</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md1103"></a>
MCP Standards Compliance</h2>
<ul>
<li><b>Protocol Adherence</b>: Full compliance with Model Context Protocol specification</li>
<li><b>Interoperability</b>: Standard client-server interface for tool integration</li>
<li><b>Tool Discovery</b>: Dynamic capability discovery following MCP patterns</li>
<li><b>Session Management</b>: Clean point-to-point sessions without proprietary broker patterns</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md1104"></a>
Consistency &amp; Maintainability</h2>
<ul>
<li><b>Identical Patterns</b>: All services follow same structure and conventions</li>
<li><b>Predictable Layouts</b>: Developers can navigate any service intuitively</li>
<li><b>Shared Tooling</b>: Common testing, building, and deployment patterns</li>
<li><b>Code Reusability</b>: Standard utilities and configurations across services</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md1105"></a>
Scalability &amp; Performance</h2>
<ul>
<li><b>Microservices Design</b>: Independent scaling of components</li>
<li><b>Async Processing</b>: Non-blocking operations throughout</li>
<li><b>Database Optimization</b>: Direct reads with controlled writes</li>
<li><b>Caching Strategies</b>: Multiple levels of caching for performance</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md1106"></a>
Security &amp; Reliability</h2>
<ul>
<li><b>Defense in Depth</b>: Multiple security layers and validation points</li>
<li><b>Container Hardening</b>: Security-first container design</li>
<li><b>Input Validation</b>: Type-safe APIs with comprehensive validation</li>
<li><b>Error Handling</b>: Graceful degradation and recovery patterns</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md1107"></a>
Developer Experience</h2>
<ul>
<li><b>Clear Documentation</b>: Comprehensive guides and examples</li>
<li><b>Consistent Tooling</b>: Same development patterns across services</li>
<li><b>Testing Infrastructure</b>: Complete test frameworks with mocking</li>
<li><b>Local Development</b>: Easy setup with Docker Compose</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md1108"></a>
üìà Performance Characteristics</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md1109"></a>
API Performance</h2>
<ul>
<li><b>Response Times</b>: &lt;100ms for read operations, &lt;500ms for write operations</li>
<li>**Throughput**: 1000+ requests/second per service instance</li>
<li>**Concurrent Users**: 100+ simultaneous research sessions</li>
<li>**Database Performance**: Optimized queries with proper indexing</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md1110"></a>
Resource Utilization</h2>
<ul>
<li>**Memory Usage**: &lt;512MB per service container</li>
<li>**CPU Usage**: &lt;50% under normal load</li>
<li>**Storage**: Efficient data structures and cleanup processes</li>
<li>**Network**: Optimized WebSocket connections for MCP</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md1111"></a>
üîß Development Workflow</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md1112"></a>
Service Creation</h2>
<ol type="1">
<li>Copy template from `templates/standard-service/`</li>
<li>Customize placeholders for service name</li>
<li>Implement service-specific logic</li>
<li>Add comprehensive tests</li>
<li>Update documentation</li>
</ol>
<h2 class="doxsection"><a class="anchor" id="autotoc_md1113"></a>
Testing Strategy</h2>
<ul>
<li>**Unit Tests**: Individual component testing</li>
<li>**Integration Tests**: Service interaction testing <br  />
</li>
<li><b>End-to-End Tests</b>: Full workflow validation</li>
<li><b>Performance Tests</b>: Load and stress testing</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md1114"></a>
Deployment Process</h2>
<ol type="1">
<li><b>Local Development</b>: Docker Compose environment</li>
<li><b>Continuous Integration</b>: Automated testing and building</li>
<li><b>Staging Deployment</b>: Kubernetes staging environment</li>
<li><b>Production Deployment</b>: Blue-green deployment strategy</li>
</ol>
<hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md1116"></a>
üìö Related Documentation</h1>
<ul>
<li>Standardization Plan - Details of the standardization process</li>
<li>Hierarchical Research Structure - Research data organization</li>
<li>Function Map - Complete API function reference</li>
<li>Development Roadmap - Future development plans</li>
</ul>
<hr  />
 </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on <span class="timestamp"></span> for ACP - Autonomous Command Protocol by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.15.0 </li>
  </ul>
</div>
</body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.15.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ACP - Autonomous Command Protocol: AI Coder Fix Prompt — Eunice Web UI (Post-Approval Flow)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">ACP - Autonomous Command Protocol<span id="projectnumber">&#160;v0.3.0</span>
   </div>
   <div id="projectbrief">Portable C99 framing library with COBS, CRC16, and HMAC-SHA256 authentication</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.15.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('md__2_users_2paulzanna_2_github_2_eunice_2docs_2_architecture_2coder__prompts_2_eunice-_web-_u_i-_fix-_prompt.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">AI Coder Fix Prompt — Eunice Web UI (Post-Approval Flow) </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md756"></a></p>
<p><b>Repo:</b> <a href="https://github.com/pzanna/Eunice">https://github.com/pzanna/Eunice</a> <br  />
 <b>Date:</b> 13-08-2025 (Australia/Melbourne) <br  />
 <b>Goal:</b> Make all <b>post-approval</b> Web UI features fully <b>functional</b> against the <b>current Eunice backend</b>. Focus on correct API wiring, state management, accessibility, and test coverage. Avoid visual polish work unless it blocks function.</p>
<hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md758"></a>
0) Context &amp; Constraints</h1>
<ul>
<li>You already have a design doc (“Eunice Web UI — Post-Approval Design (v0.6.1+)”) and an AI coder build prompt. The UI exists but <b>new features are nonfunctional</b>.</li>
<li>The backend exposes a REST API via the API Gateway (port typically <b>8000</b>). <b>Do not assume path prefixes</b>. <b>Discover them</b> from the running stack.</li>
<li>The UI must support: <b>Plan approval → Kickoff Wizard → create downstream jobs → Progress view</b>; <b>Plan Details tabs</b>; basic <b>Literature/Synthesis/Experiments/Materials/Equipment/Protocols/Execution/Data/Reporting/Automations</b> stubs wired where possible.</li>
</ul>
<p><b>Non-goals for this PR:</b> deep styling overhauls, adding new backend endpoints, RBAC enforcement beyond hiding actions.</p>
<hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md760"></a>
1) Discover &amp; Align (blocking)</h1>
<ol type="1">
<li><b>Start the stack</b> <div class="fragment"><div class="line">docker compose up -d</div>
</div><!-- fragment --></li>
<li><b>Detect API base &amp; schema</b><ul>
<li>Probe <span class="tt"><a href="http://localhost:8000/health">http://localhost:8000/health</a></span> (or service health endpoint).</li>
<li>Download OpenAPI if exposed: <span class="tt">/openapi.json</span> or check README/service docs in repo.</li>
<li>Record the confirmed base URL in <span class="tt">.env.local</span> as: <div class="fragment"><div class="line">VITE_API_BASE_URL=http://localhost:8000</div>
</div><!-- fragment --></li>
</ul>
</li>
<li><b>Catalogue endpoints actually available</b> (Projects, Topics, Plans, Tasks, Stats, etc.). Write a short <span class="tt">docs/webui-api-alignment.md</span> table mapping <b>UI needs → real endpoints</b>.</li>
</ol>
<blockquote class="doxtable">
<p><b>Output of this step:</b> A typed <span class="tt">src/app/api/types.ts</span> that reflects the <em>real</em> DTOs, plus <span class="tt">schemas.ts</span> (Zod) and <span class="tt">adapters.ts</span> (DTO⇄UI). </p>
</blockquote>
<hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md762"></a>
2) Replace Placeholder Calls &amp; Centralise API</h1>
<p><b>Problem:</b> UI is likely using placeholder endpoints (e.g., <span class="tt">/api/...</span>) and ad‑hoc fetches.</p>
<p><b>Fix:</b></p><ul>
<li>Create <span class="tt">src/app/api/</span>:<ul>
<li><span class="tt">client.ts</span>: fetch/axios wrapper, baseURL from <span class="tt">VITE_API_BASE_URL</span>, JSON, timeouts, retry, 401 hook.</li>
<li><span class="tt">types.ts</span>: DTOs for Project, Topic, Plan, Task, Stats, Artifact (align to OpenAPI).</li>
<li><span class="tt">schemas.ts</span>: Zod validators for each DTO.</li>
<li><span class="tt">adapters.ts</span>: pure functions to map DTO → UI model and vice versa.</li>
</ul>
</li>
<li>Replace <b>all</b> direct fetches with typed calls in <span class="tt">client.ts</span>.</li>
<li>Add <b>unit tests</b> for adapters and schema parsing (reject malformed data).</li>
</ul>
<p><b>Definition of done:</b> No fetch to <span class="tt">/api/*</span>. All network calls use <span class="tt">client.ts</span> and pass schema validation.</p>
<hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md764"></a>
3) Make Plan Approval Functional</h1>
<p><b>UI flow:</b></p><ul>
<li>On “Approve Plan” confirm → call the <b>real plan update endpoint</b> (usually <span class="tt">PUT/PATCH /plans/:id</span>) with:<ul>
<li><span class="tt">status: "approved"</span></li>
<li><span class="tt">approved_at: ISO timestamp</span></li>
<li><span class="tt">approved_by: current user id or name (stub if RBAC not wired)</span></li>
</ul>
</li>
</ul>
<p><b>Acceptance:</b></p><ul>
<li>Status badge updates to “Approved”.</li>
<li>A banner or toast confirms approval with the timestamp.</li>
<li>The <b>Kickoff Wizard</b> opens.</li>
</ul>
<hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md766"></a>
4) Make the Kickoff Wizard Create Real Work</h1>
<p><b>Wizard submit → create jobs.</b> If there is no single “kickoff” endpoint:</p><ul>
<li>For each selected automation, <b>create a Task</b> under the Plan (e.g., <span class="tt">POST /plans/:planId/tasks</span>) with: <div class="fragment"><div class="line">{</div>
<div class="line">  &quot;type&quot;: &quot;literature_run&quot; | &quot;experiment_design&quot; | &quot;materials_build&quot;,</div>
<div class="line">  &quot;payload&quot;: {</div>
<div class="line">    &quot;literature&quot;: { &quot;sources&quot;: [...], &quot;filters&quot;: {...}, &quot;criteria_template_id&quot;: &quot;...&quot; },</div>
<div class="line">    &quot;experiment&quot;: { &quot;template&quot;: &quot;factorial|rsm_ccd|screening&quot;, &quot;factors&quot;: [...], &quot;responses&quot;: [...], &quot;random_seed&quot;: 42 },</div>
<div class="line">    &quot;materials&quot;: { &quot;budget_cap_aud&quot;: 1000, &quot;enable_substitutions&quot;: true }</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li>If tasks must be created elsewhere, adapt to the available endpoint(s). Persist the wizard state if the network fails.</li>
</ul>
<p><b>Progress view:</b></p><ul>
<li>After submission, <b>redirect</b> to a <b>Progress screen</b> that <b>polls</b> <span class="tt">GET /plans/:planId/tasks</span> every 5 s.</li>
<li>Map backend status to UI chips: <span class="tt">queued | running | needs_review | blocked | complete | failed</span>.</li>
<li>Each task row opens a detail drawer showing <span class="tt">payload</span> and any <span class="tt">result</span>/logs.</li>
</ul>
<p><b>Acceptance:</b></p><ul>
<li>Submitting the wizard <b>creates one task per selected automation</b> and they appear in the Progress view.</li>
<li>Progress view updates as task state changes.</li>
</ul>
<hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md768"></a>
5) Wire Plan Details Tabs</h1>
<ul>
<li><b>Overview:</b> render synopsis; show KPIs via <span class="tt">GET /plans/:id</span> and/or <span class="tt">GET /plans/:id/stats</span> if available.</li>
<li><b>Workflows:</b> <span class="tt">GET /plans/:id/tasks</span> table with type, status, updatedAt. Include a “View details” action (drawer).</li>
<li><b>Deliverables:</b> show links/placeholders for Experimental Design doc, Protocols, Materials list. If an artifact URL/id is returned in <span class="tt">task.result</span>, render a “Download” icon.</li>
<li><b>Activity:</b> Render audit trail using available timestamps/fields; if none, show recent changes derived from <span class="tt">updated_at</span>.</li>
</ul>
<p><b>Acceptance:</b> All tabs load data from real endpoints without console errors.</p>
<hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md770"></a>
6) Minimal Functional Stubs for Other Modules</h1>
<p>Until their endpoints exist, ensure pages mount and do something useful:</p><ul>
<li><b>Literature:</b> strategies list (local JSON), triage controls that persist to localStorage; PRISMA card reads counts from <span class="tt">/plans/:id/stats</span> when present.</li>
<li><b>Synthesis:</b> claims board stub; link at least one evidence item (local).</li>
<li><b>Experiment Designer:</b> factor editor + matrix preview; export stub (Markdown).</li>
<li><b>Materials:</b> picklist table with currency formatting (AUD); unit helpers (SI).</li>
<li><b>Equipment:</b> reservations calendar (mocked data); conflict highlighting.</li>
<li><b>Protocols:</b> step builder; run view with timers; print stylesheet.</li>
<li><b>Execution:</b> schedules (list/calendar); run state chips.</li>
<li><b>Data/Reporting:</b> ingest wizard (checksum), dataset browser (sample CSV), report blocks (export Markdown).</li>
<li><b>Automations:</b> jobs list with streaming/polling; reconnection logic.</li>
</ul>
<p><b>Acceptance:</b> Routes render, no fatal errors, and save local state where server support is missing.</p>
<hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md772"></a>
7) Fix Known UI Bugs</h1>
<ul>
<li><b>Layout overflow/spacing</b> on Task/Workflows pages → wrap with max-width container, responsive padding, and fix flex overflow.</li>
<li><b>Dropdowns stuck open</b> → ensure controlled <span class="tt">open</span> state; close on blur/selection; add RTL tests.</li>
</ul>
<hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md774"></a>
8) Accessibility &amp; Internationalisation</h1>
<ul>
<li>Keyboard access through Wizard and drawers; focus trapping in modals.</li>
<li>Axe checks on Plan pages and Wizard.</li>
<li>AU date format <b>DD‑MM‑YYYY</b> in UI (store ISO internally). SI units throughout.</li>
</ul>
<hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md776"></a>
9) Tests &amp; CI</h1>
<ul>
<li><b>Unit:</b> adapters and schema parsing (invalid payload paths).</li>
<li><b>Component:</b> Wizard steps, Workflows table, Task detail drawer.</li>
<li><b>E2E (Playwright):</b> create or select a plan → approve → wizard → submit → tasks visible in Progress → statuses update (simulate via test hook or mock).</li>
<li>Add CI job: lint, typecheck, unit, Storybook build, Playwright smoke.</li>
</ul>
<hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md778"></a>
10) Implementation Checklist (copy into PR)</h1>
<ul class="check">
<li class="unchecked">Detect API base &amp; schema; write <span class="tt">docs/webui-api-alignment.md</span>.</li>
</ul>
<ul class="check">
<li class="unchecked">Central API client; replace all direct fetches; remove <span class="tt">/api/*</span> calls.</li>
</ul>
<ul class="check">
<li class="unchecked">Plan approval wired to real endpoint; status persisted.</li>
</ul>
<ul class="check">
<li class="unchecked">Kickoff Wizard → creates tasks under plan; progress polling view implemented.</li>
</ul>
<ul class="check">
<li class="unchecked">Plan Details tabs wired (Overview/Workflows/Deliverables/Activity).</li>
</ul>
<ul class="check">
<li class="unchecked">Minimal stubs for other modules; no console errors.</li>
</ul>
<ul class="check">
<li class="unchecked">UI bug fixes: layout overflow; dropdown control.</li>
</ul>
<ul class="check">
<li class="unchecked">Tests (unit/component/E2E) + CI updated.</li>
</ul>
<ul class="check">
<li class="unchecked">README: Web UI run instructions; <span class="tt">.env.local</span> example.</li>
</ul>
<hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md780"></a>
11) PR Title &amp; Notes</h1>
<p><b>Title:</b> <span class="tt">feat(web): functional post-approval flow (approve→kickoff→tasks) + API alignment + UI fixes</span> <br  />
 <b>Notes:</b> Describe endpoint mappings, any deviations from the design doc, and follow-ups (RBAC, SSE, real triage/evidence APIs).</p>
<p>Proceed now. Align to the <b>existing backend</b>; do not introduce new endpoints. Where uncertain, prefer adapter logic on the client and document the mapping. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on <span class="timestamp"></span> for ACP - Autonomous Command Protocol by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.15.0 </li>
  </ul>
</div>
</body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.15.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ACP - Autonomous Command Protocol: Tasks: 001-scout-firmware</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">ACP - Autonomous Command Protocol<span id="projectnumber">&#160;v0.3.0</span>
   </div>
   <div id="projectbrief">Portable C99 framing library with COBS, CRC16, and HMAC-SHA256 authentication</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.15.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('md__2_users_2paulzanna_2_github_2_scout_2specs_2001-scout-firmware_2tasks.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Tasks: 001-scout-firmware </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md8629"></a></p>
<ul>
<li>Branch: <span class="tt">001-scout-firmware</span></li>
<li>Spec: <span class="tt">/specs/001-scout-firmware/spec.md</span></li>
<li>Plan: <span class="tt">/specs/001-scout-firmware/plan.md</span></li>
<li>Data Model: <span class="tt">/specs/001-scout-firmware/data-model.md</span></li>
<li>Contracts: <span class="tt">/specs/001-scout-firmware/contracts/</span></li>
<li>Research: <span class="tt">/specs/001-scout-firmware/research.md</span></li>
<li>Quickstart: <span class="tt">/specs/001-scout-firmware/quickstart.md</span></li>
</ul>
<p>Note: All tasks use strict checklist format: <span class="tt">- [ ] T### [P] [US#] Description with file path</span></p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md8630"></a>
Phase 1 — Setup</h1>
<ul class="check">
<li class="checked">T001 Verify PlatformIO env and board in platformio.ini matches ESP32‑S3 freenove target (/platformio.ini)</li>
</ul>
<ul class="check">
<li class="checked">T002 Add default monitor_speed and upload_speed settings for reliable flashing (/platformio.ini)</li>
</ul>
<ul class="check">
<li class="checked">T003 Ensure ESP‑IDF project structure and CMake are valid (/CMakeLists.txt, /src/CMakeLists.txt)</li>
</ul>
<ul class="check">
<li class="checked">T004 Create initial FreeRTOS main loop skeleton with task scaffolding (/src/main.c)</li>
</ul>
<ul class="check">
<li class="checked">T005 Create domain folders with README purpose statements (sensors/control/cli/telemetry) (/src/)</li>
</ul>
<ul class="check">
<li class="checked">T006 Add docs placeholders for CLI and wiring updates (/docs/cli.md, /docs/wiring.md, /docs/connections.md)</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md8631"></a>
Phase 2 — Foundational (blocking for all stories)</h1>
<ul class="check">
<li class="checked">T007 Implement system mode manager: CONFIG vs FLIGHT state with getters/setters (/src/control/mode_manager.c)</li>
</ul>
<ul class="check">
<li class="checked">T008 Implement safety gate aggregator API and data types (/src/control/safety_manager.c)</li>
</ul>
<ul class="check">
<li class="checked">T009 Implement failsafe manager (link‑loss disarm orchestration) (/src/control/failsafe.c)</li>
</ul>
<ul class="check">
<li class="checked">T010 Implement CPU budget/loop timing measurement utilities (/src/control/rt_metrics.c)</li>
</ul>
<ul class="check">
<li class="checked">T011 Implement serial CLI transport over UART/USB (no network exposure per FR‑021) (/src/cli/cli_transport.c)</li>
</ul>
<ul class="check">
<li class="checked">T012 Implement CLI command registry/dispatcher core (/src/cli/cli_core.c)</li>
</ul>
<ul class="check">
<li class="checked">T013 Implement telemetry scheduler base at ≥1 Hz (/src/telemetry/telemetry_core.c)</li>
</ul>
<ul class="check">
<li class="checked">T014 Wire status snapshot composition (safety state + sensor health) (/src/control/status_snapshot.c)</li>
</ul>
<ul class="check">
<li class="checked">T015 Provide build config flags for feature toggles and safe defaults (/src/CMakeLists.txt)</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md8632"></a>
Phase 3 — User Story 5: Sensor Integration, Calibration &amp; Health (P1)</h1>
<ul class="check">
<li class="checked">T016 [P] [US5] Implement I2C/SPI bus init helper for sensors (/src/sensors/bus_io.c)</li>
</ul>
<ul class="check">
<li class="checked">T017 [US5] Implement IMU (MPU‑6050) driver and health checks (/src/sensors/mpu6050.c)</li>
</ul>
<ul class="check">
<li class="checked">T018 [P] [US5] Implement MAG (HMC5883L) driver with calibration and health (/src/sensors/hmc5883l.c)</li>
</ul>
<ul class="check">
<li class="checked">T019 [P] [US5] Implement BARO (BMP388) driver and drift filter (/src/sensors/bmp388.c)</li>
</ul>
<ul class="check">
<li class="checked">T020 [P] [US5] Implement GPS (NEO‑6M) UART parser and fix state (/src/sensors/neo6m.c)</li>
</ul>
<ul class="check">
<li class="checked">T021 [US5] Implement sensor health aggregation into status (/src/sensors/health_aggregate.c)</li>
</ul>
<ul class="check">
<li class="checked">T022 [US5] Expose CLI calibration workflows for applicable sensors (/src/cli/cmd_calibrate.c)</li>
<li class="checked">T023 [US5] Add integration of sensor readings into status packet (/src/telemetry/telemetry_core.c)</li>
</ul>
<ul class="check">
<li class="checked">T024 [P] [US5] Bench functional tests for sensors (scripts and notes) (/tests/integration/README.md)</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md8633"></a>
Phase 4 — User Story 1: Safe Vehicle‑Launch Preflight and Arming (P1)</h1>
<ul class="check">
<li class="checked">T025 [US1] Enforce arming block in CONFIG mode with clear reason text (/src/control/safety_manager.c)</li>
</ul>
<ul class="check">
<li class="checked">T026 [US1] Implement preflight checklist evaluation and reporting (/src/control/preflight_checklist.c)</li>
</ul>
<ul class="check">
<li class="checked">T027 [US1] Implement enhanced vehicle‑launch arming checks (≤80 km/h, ±15°, link quality, sensors OK, CPU budget) (/src/control/vehicle_launch_checks.c)</li>
</ul>
<ul class="check">
<li class="checked">T028 [US1] Implement disarm on link‑loss ≤1s in failsafe manager (/src/control/failsafe.c)</li>
</ul>
<ul class="check">
<li class="checked">T029 [P] [US1] Unity tests: safety gate logic and preflight outcomes (/tests/unit/test_safety_manager.c)</li>
</ul>
<ul class="check">
<li class="checked">T030 [US1] Integration script: preflight/arming attempts via CLI (/tests/integration/arming_scenarios.md)</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md8634"></a>
Phase 5 — User Story 2: Command &amp; Telemetry Interoperability (P1)</h1>
<ul class="check">
<li class="checked">T031 [US2] Implement MAVLink HEARTBEAT/SYS_STATUS mapping and scheduler (≥1 Hz) (/src/telemetry/telemetry_core.c)</li>
</ul>
<ul class="check">
<li class="checked">T032 [US2] Implement arm/disarm command handling via MAV_CMD_COMPONENT_ARM_DISARM with COMMAND_ACK (/src/telemetry/cmd_arm_disarm.c)</li>
</ul>
<ul class="check">
<li class="checked">T033 [P] [US2] Integration test: 10‑minute heartbeat + arm/disarm bench session (/tests/integration/heartbeat_arm.md)</li>
</ul>
<ul class="check">
<li class="checked">T034 [P] [US2] SITL/host mock for MAVLink message exchange (/tests/integration/sitl_mock.md)</li>
</ul>
<ul class="check">
<li class="checked">T056 [US2] Implement flight mode state machine (hover/loiter/forward) in mode manager (/src/control/mode_manager.c)</li>
</ul>
<ul class="check">
<li class="checked">T057 [US2] Implement mode change command handling (/src/telemetry/cmd_mode.c)</li>
</ul>
<ul class="check">
<li class="checked">T058 [P] [US2] Integration test: mode switching via ground control (/tests/integration/mode_switching.md)</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md8635"></a>
Phase 6 — User Story 3: Configuration via CLI with Persistence &amp; Audit (P2)</h1>
<ul class="check">
<li class="checked">T059 [US5] Implement degrade policy for sensor faults (restrict modes/increase stability margins) (/src/control/degrade_policy.c)</li>
</ul>
<ul class="check">
<li class="checked">T060 [US5] Wire degrade policy to safety gates and record faults in status (/src/control/safety_manager.c)</li>
</ul>
<ul class="check">
<li class="checked">T061 [P] [US5] Integration test: simulate mid‑flight sensor failure; verify degrade/disarm (/tests/integration/sensor_fault_degrade.md)</li>
</ul>
<ul class="check">
<li class="checked">T037 [US3] Implement <span class="tt">get</span>, <span class="tt">set</span> with schema validation and errors (/src/cli/cmd_get_set.c)</li>
</ul>
<ul class="check">
<li class="checked">T038 [US3] Implement <span class="tt">dump</span> (stable order, checksum) (/src/cli/cmd_dump.c)</li>
</ul>
<ul class="check">
<li class="checked">T039 [US3] Implement <span class="tt">save</span> using NVS persistence (/src/cli/cmd_save.c)</li>
</ul>
<ul class="check">
<li class="checked">T035 [US3] Implement <span class="tt">version</span> command with firmware API semver (/src/cli/cmd_version.c)</li>
</ul>
<ul class="check">
<li class="checked">T036 [US3] Implement <span class="tt">reboot</span> command (/src/cli/cmd_reboot.c)</li>
</ul>
<ul class="check">
<li class="checked">T062 [US1] Disarm on critical sensor fault while armed (policy enforcement) (/src/control/failsafe.c)</li>
</ul>
<ul class="check">
<li class="checked">T041 [P] [US3] Golden transcript tests for CLI round‑trip + invalid inputs (/tests/integration/cli_transcripts.md)</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md8636"></a>
Phase 7 — User Story 4: Observability &amp; Performance Budgeting (P2)</h1>
<ul class="check">
<li class="checked">T063 Add preflight timing validation (≤2 minutes) evidence script (/tests/integration/preflight_timing.md)</li>
</ul>
<ul class="check">
<li class="checked">T064 [US5] GPS TTFF (≤90 s) bench test documentation (/tests/integration/gps_ttff.md)</li>
</ul>
<ul class="check">
<li class="checked">T042 [US4] Implement <span class="tt">stats</span> with loop rates and total CPU utilization (/src/cli/cmd_stats.c)</li>
</ul>
<ul class="check">
<li class="checked">T043 [US4] Add guardrails: prevent arming or degrade features when CPU budget exceeded (/src/control/rt_guardrails.c)</li>
</ul>
<ul class="check">
<li class="checked">T044 [P] [US4] 10‑minute bench run script capturing <span class="tt">status</span>/<span class="tt">stats</span> snapshots (/tests/integration/bench_run.sh)</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md8637"></a>
Phase 8 — Security Posture per Clarification (FR‑021)</h1>
<ul class="check">
<li class="checked">T045 Enforce serial‑only CLI; disable any network CLI exposure (/src/cli/cli_transport.c)</li>
</ul>
<ul class="check">
<li class="checked">T046 Disable WiFi/AP in flight mode; ensure no CLI over network at any time (/src/control/mode_manager.c)</li>
</ul>
<ul class="check">
<li class="checked">T047 Update docs with security posture and procedures (/docs/cli.md)</li>
</ul>
<ul class="check">
<li class="checked">T048 Add integration check: network CLI attempts fail; USB/UART succeeds (/tests/integration/cli_security.md)</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md8638"></a>
Phase 9 — Companion Input Mediation (FR‑011)</h1>
<ul class="check">
<li class="checked">T065 [US2] Enforce companion input mediation policy so companion cannot bypass safety gates (/src/control/companion_policy.c)</li>
</ul>
<ul class="check">
<li class="checked">T066 [P] Integration test: companion input attempts blocked when gates fail (/tests/integration/companion_policy.md)</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md8639"></a>
Final Phase — Polish &amp; Cross‑Cutting</h1>
<ul class="check">
<li class="checked">T049 Constitution Gate: Safety evidence (preflight/arming/failsafe logs) (/specs/001-scout-firmware/checklists/requirements.md)</li>
</ul>
<ul class="check">
<li class="checked">T050 Constitution Gate: Real‑time evidence (<span class="tt">stats</span> p95 + CPU ≤70%) (/tests/integration/bench_run.sh)</li>
</ul>
<ul class="check">
<li class="checked">T051 Constitution Gate: CLI contracts + versioning docs (/specs/001-scout-firmware/contracts/cli-contracts.md)</li>
</ul>
<ul class="check">
<li class="checked">T052 Constitution Gate: External Interfaces 10‑minute bench logs (/specs/001-scout-firmware/contracts/telemetry-contracts.md)</li>
</ul>
<ul class="check">
<li class="checked">T053 Update docs wiring/pinouts for sensors (/docs/wiring.md)</li>
</ul>
<ul class="check">
<li class="checked">T054 Update quickstart with exact steps and pitfalls (/specs/001-scout-firmware/quickstart.md)</li>
</ul>
<ul class="check">
<li class="checked">T055 PR checklist and evidence collation (/specs/001-scout-firmware/plan.md)</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md8640"></a>
Dependencies</h1>
<ul>
<li>Story order: US5 (Sensors) → US1 (Safe arming) → US2 (Cmd/Telemetry) → US3 (CLI persistence) → US4 (Observability)</li>
<li>Foundational (Phase 2) must precede all user stories.</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md8641"></a>
Parallel execution examples</h1>
<ul>
<li>US5: Drivers for MAG/BARO/GPS can proceed in parallel with IMU once bus_io is ready (T018/T019/T020 marked [P]).</li>
<li>US1: Unit tests for safety gates (T029) can run in parallel with preflight checklist implementation (T026).</li>
<li>US2: SITL mock (T034) can be developed in parallel with heartbeat implementation (T031).</li>
<li>US3: Golden transcripts (T041) can be prepared in parallel with <span class="tt">dump/save</span> (T038/T039).</li>
<li>US4: Bench script (T044) can be authored while <span class="tt">stats</span> (T042) lands.</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md8642"></a>
Implementation strategy</h1>
<ul>
<li>MVP focus: Complete Phases 1–5 to achieve safe arming with heartbeat/status and core sensors; demonstrate link‑loss disarm.</li>
<li>Incremental delivery: Land US5 drivers with health first, then US1 arming logic, then minimal US2 heartbeat/arm.</li>
<li>Hardening: Add CLI persistence and <span class="tt">stats</span> in P2, followed by guardrails and final Constitution evidence. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on <span class="timestamp"></span> for ACP - Autonomous Command Protocol by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.15.0 </li>
  </ul>
</div>
</body>
</html>
